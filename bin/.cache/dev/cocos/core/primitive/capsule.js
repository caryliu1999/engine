(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../math/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../math/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index);
    global.capsule = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.default = capsule;

  /**
   * @category 3d/primitive
   */
  var temp1 = new _index.Vec3(0, 0, 0);
  var temp2 = new _index.Vec3(0, 0, 0);
  /**
   * Generate a capsule with radiusTop radiusBottom 0.5, height 2, centered at origin,
   * but may be repositioned through the `center` option.
   * @zh
   * 生成一个胶囊体。
   * @param radiusTop 顶部半径。
   * @param radiusBottom 底部半径。
   * @param opts 胶囊体参数选项。
   */

  function capsule() {
    var radiusTop = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0.5;
    var radiusBottom = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0.5;
    var height = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 2;
    var opts = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
    var torsoHeight = height - radiusTop - radiusBottom;
    var sides = opts.sides || 32;
    var heightSegments = opts.heightSegments || 32;
    var bottomProp = radiusBottom / height;
    var torProp = torsoHeight / height;
    var topProp = radiusTop / height;
    var bottomSegments = Math.floor(heightSegments * bottomProp);
    var topSegments = Math.floor(heightSegments * topProp);
    var torSegments = Math.floor(heightSegments * torProp);
    var topOffset = torsoHeight + radiusBottom - height / 2;
    var torOffset = radiusBottom - height / 2;
    var bottomOffset = radiusBottom - height / 2;
    var arc = opts.arc || 2.0 * Math.PI; // calculate vertex count

    var positions = [];
    var normals = [];
    var uvs = [];
    var indices = [];
    var maxRadius = Math.max(radiusTop, radiusBottom);
    var minPos = new _index.Vec3(-maxRadius, -height / 2, -maxRadius);
    var maxPos = new _index.Vec3(maxRadius, height / 2, maxRadius);
    var boundingRadius = height / 2;
    var index = 0;
    var indexArray = [];
    generateBottom();
    generateTorso();
    generateTop();
    return {
      positions: positions,
      normals: normals,
      uvs: uvs,
      indices: indices,
      minPos: minPos,
      maxPos: maxPos,
      boundingRadius: boundingRadius
    }; // =======================
    // internal fucntions
    // =======================

    function generateTorso() {
      // this will be used to calculate the normal
      var slope = (radiusTop - radiusBottom) / torsoHeight; // generate positions, normals and uvs

      for (var y = 0; y <= torSegments; y++) {
        var indexRow = [];
        var lat = y / torSegments;
        var radius = lat * (radiusTop - radiusBottom) + radiusBottom;

        for (var x = 0; x <= sides; ++x) {
          var u = x / sides;
          var v = lat * torProp + bottomProp;
          var theta = u * arc - arc / 4;
          var sinTheta = Math.sin(theta);
          var cosTheta = Math.cos(theta); // vertex

          positions.push(radius * sinTheta);
          positions.push(lat * torsoHeight + torOffset);
          positions.push(radius * cosTheta); // normal

          _index.Vec3.normalize(temp1, _index.Vec3.set(temp2, sinTheta, -slope, cosTheta));

          normals.push(temp1.x);
          normals.push(temp1.y);
          normals.push(temp1.z); // uv

          uvs.push(u, v); // save index of vertex in respective row

          indexRow.push(index); // increase index

          ++index;
        } // now save positions of the row in our index array


        indexArray.push(indexRow);
      } // generate indices


      for (var _y = 0; _y < torSegments; ++_y) {
        for (var _x = 0; _x < sides; ++_x) {
          // we use the index array to access the correct indices
          var i1 = indexArray[_y][_x];
          var i2 = indexArray[_y + 1][_x];
          var i3 = indexArray[_y + 1][_x + 1];
          var i4 = indexArray[_y][_x + 1]; // face one

          indices.push(i1);
          indices.push(i4);
          indices.push(i2); // face two

          indices.push(i4);
          indices.push(i3);
          indices.push(i2);
        }
      }
    }

    function generateBottom() {
      for (var lat = 0; lat <= bottomSegments; ++lat) {
        var theta = lat * Math.PI / bottomSegments / 2;
        var sinTheta = Math.sin(theta);
        var cosTheta = -Math.cos(theta);

        for (var lon = 0; lon <= sides; ++lon) {
          var phi = lon * 2 * Math.PI / sides - Math.PI / 2.0;
          var sinPhi = Math.sin(phi);
          var cosPhi = Math.cos(phi);
          var x = sinPhi * sinTheta;
          var y = cosTheta;
          var z = cosPhi * sinTheta;
          var u = lon / sides;
          var v = lat / heightSegments;
          positions.push(x * radiusBottom, y * radiusBottom + bottomOffset, z * radiusBottom);
          normals.push(x, y, z);
          uvs.push(u, v);

          if (lat < bottomSegments && lon < sides) {
            var seg1 = sides + 1;
            var a = seg1 * lat + lon;
            var b = seg1 * (lat + 1) + lon;
            var c = seg1 * (lat + 1) + lon + 1;
            var d = seg1 * lat + lon + 1;
            indices.push(a, d, b);
            indices.push(d, c, b);
          }

          ++index;
        }
      }
    }

    function generateTop() {
      for (var lat = 0; lat <= topSegments; ++lat) {
        var theta = lat * Math.PI / topSegments / 2 + Math.PI / 2;
        var sinTheta = Math.sin(theta);
        var cosTheta = -Math.cos(theta);

        for (var lon = 0; lon <= sides; ++lon) {
          var phi = lon * 2 * Math.PI / sides - Math.PI / 2.0;
          var sinPhi = Math.sin(phi);
          var cosPhi = Math.cos(phi);
          var x = sinPhi * sinTheta;
          var y = cosTheta;
          var z = cosPhi * sinTheta;
          var u = lon / sides;
          var v = lat / heightSegments + (1 - topProp);
          positions.push(x * radiusTop, y * radiusTop + topOffset, z * radiusTop);
          normals.push(x, y, z);
          uvs.push(u, v);

          if (lat < topSegments && lon < sides) {
            var seg1 = sides + 1;
            var a = seg1 * lat + lon + indexArray[torSegments][sides] + 1;
            var b = seg1 * (lat + 1) + lon + indexArray[torSegments][sides] + 1;
            var c = seg1 * (lat + 1) + lon + 1 + indexArray[torSegments][sides] + 1;
            var d = seg1 * lat + lon + 1 + indexArray[torSegments][sides] + 1;
            indices.push(a, d, b);
            indices.push(d, c, b);
          }
        }
      }
    }
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL2NvcmUvcHJpbWl0aXZlL2NhcHN1bGUudHMiXSwibmFtZXMiOlsidGVtcDEiLCJWZWMzIiwidGVtcDIiLCJjYXBzdWxlIiwicmFkaXVzVG9wIiwicmFkaXVzQm90dG9tIiwiaGVpZ2h0Iiwib3B0cyIsInRvcnNvSGVpZ2h0Iiwic2lkZXMiLCJoZWlnaHRTZWdtZW50cyIsImJvdHRvbVByb3AiLCJ0b3JQcm9wIiwidG9wUHJvcCIsImJvdHRvbVNlZ21lbnRzIiwiTWF0aCIsImZsb29yIiwidG9wU2VnbWVudHMiLCJ0b3JTZWdtZW50cyIsInRvcE9mZnNldCIsInRvck9mZnNldCIsImJvdHRvbU9mZnNldCIsImFyYyIsIlBJIiwicG9zaXRpb25zIiwibm9ybWFscyIsInV2cyIsImluZGljZXMiLCJtYXhSYWRpdXMiLCJtYXgiLCJtaW5Qb3MiLCJtYXhQb3MiLCJib3VuZGluZ1JhZGl1cyIsImluZGV4IiwiaW5kZXhBcnJheSIsImdlbmVyYXRlQm90dG9tIiwiZ2VuZXJhdGVUb3JzbyIsImdlbmVyYXRlVG9wIiwic2xvcGUiLCJ5IiwiaW5kZXhSb3ciLCJsYXQiLCJyYWRpdXMiLCJ4IiwidSIsInYiLCJ0aGV0YSIsInNpblRoZXRhIiwic2luIiwiY29zVGhldGEiLCJjb3MiLCJwdXNoIiwibm9ybWFsaXplIiwic2V0IiwieiIsImkxIiwiaTIiLCJpMyIsImk0IiwibG9uIiwicGhpIiwic2luUGhpIiwiY29zUGhpIiwic2VnMSIsImEiLCJiIiwiYyIsImQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7OztBQW1CQSxNQUFNQSxLQUFLLEdBQUcsSUFBSUMsV0FBSixDQUFTLENBQVQsRUFBWSxDQUFaLEVBQWUsQ0FBZixDQUFkO0FBQ0EsTUFBTUMsS0FBSyxHQUFHLElBQUlELFdBQUosQ0FBUyxDQUFULEVBQVksQ0FBWixFQUFlLENBQWYsQ0FBZDtBQUVBOzs7Ozs7Ozs7O0FBU2Us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cnkgM2QvcHJpbWl0aXZlXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgVmVjMyB9IGZyb20gJy4uL21hdGgnO1xyXG5cclxuLyoqXHJcbiAqIEBlblxyXG4gKiBUaGUgZGVmaW5pdGlvbiBvZiB0aGUgcGFyYW1ldGVyIGZvciBidWlsZGluZyBhIGNhcHN1bGUuXHJcbiAqIEB6aFxyXG4gKiDog7blm4rkvZPlj4LmlbDpgInpobnjgIJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUNhcHN1dGVPcHRpb25zIHtcclxuICAgIHNpZGVzOiBudW1iZXI7XHJcbiAgICBoZWlnaHRTZWdtZW50czogbnVtYmVyO1xyXG4gICAgY2FwcGVkOiBib29sZWFuO1xyXG4gICAgYXJjOiBudW1iZXI7XHJcbn1cclxuXHJcbmNvbnN0IHRlbXAxID0gbmV3IFZlYzMoMCwgMCwgMCk7XHJcbmNvbnN0IHRlbXAyID0gbmV3IFZlYzMoMCwgMCwgMCk7XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgYSBjYXBzdWxlIHdpdGggcmFkaXVzVG9wIHJhZGl1c0JvdHRvbSAwLjUsIGhlaWdodCAyLCBjZW50ZXJlZCBhdCBvcmlnaW4sXHJcbiAqIGJ1dCBtYXkgYmUgcmVwb3NpdGlvbmVkIHRocm91Z2ggdGhlIGBjZW50ZXJgIG9wdGlvbi5cclxuICogQHpoXHJcbiAqIOeUn+aIkOS4gOS4quiDtuWbiuS9k+OAglxyXG4gKiBAcGFyYW0gcmFkaXVzVG9wIOmhtumDqOWNiuW+hOOAglxyXG4gKiBAcGFyYW0gcmFkaXVzQm90dG9tIOW6lemDqOWNiuW+hOOAglxyXG4gKiBAcGFyYW0gb3B0cyDog7blm4rkvZPlj4LmlbDpgInpobnjgIJcclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNhcHN1bGUocmFkaXVzVG9wID0gMC41LCByYWRpdXNCb3R0b20gPSAwLjUsIGhlaWdodCA9IDIsIG9wdHM6IFJlY3Vyc2l2ZVBhcnRpYWw8SUNhcHN1dGVPcHRpb25zPiA9IHt9KSB7XHJcbiAgY29uc3QgdG9yc29IZWlnaHQgPSBoZWlnaHQgLSByYWRpdXNUb3AgLSByYWRpdXNCb3R0b207XHJcbiAgY29uc3Qgc2lkZXMgPSBvcHRzLnNpZGVzIHx8IDMyO1xyXG4gIGNvbnN0IGhlaWdodFNlZ21lbnRzID0gb3B0cy5oZWlnaHRTZWdtZW50cyB8fCAzMjtcclxuICBjb25zdCBib3R0b21Qcm9wID0gcmFkaXVzQm90dG9tIC8gaGVpZ2h0O1xyXG4gIGNvbnN0IHRvclByb3AgPSB0b3Jzb0hlaWdodCAvIGhlaWdodDtcclxuICBjb25zdCB0b3BQcm9wID0gcmFkaXVzVG9wIC8gaGVpZ2h0O1xyXG4gIGNvbnN0IGJvdHRvbVNlZ21lbnRzID0gTWF0aC5mbG9vcihoZWlnaHRTZWdtZW50cyAqIGJvdHRvbVByb3ApO1xyXG4gIGNvbnN0IHRvcFNlZ21lbnRzID0gTWF0aC5mbG9vcihoZWlnaHRTZWdtZW50cyAqIHRvcFByb3ApO1xyXG4gIGNvbnN0IHRvclNlZ21lbnRzID0gTWF0aC5mbG9vcihoZWlnaHRTZWdtZW50cyAqIHRvclByb3ApO1xyXG4gIGNvbnN0IHRvcE9mZnNldCA9IHRvcnNvSGVpZ2h0ICsgcmFkaXVzQm90dG9tIC0gaGVpZ2h0IC8gMjtcclxuICBjb25zdCB0b3JPZmZzZXQgPSByYWRpdXNCb3R0b20gLSBoZWlnaHQgLyAyO1xyXG4gIGNvbnN0IGJvdHRvbU9mZnNldCA9IHJhZGl1c0JvdHRvbSAtIGhlaWdodCAvIDI7XHJcblxyXG4gIGNvbnN0IGFyYyA9IG9wdHMuYXJjIHx8IDIuMCAqIE1hdGguUEk7XHJcblxyXG4gIC8vIGNhbGN1bGF0ZSB2ZXJ0ZXggY291bnRcclxuICBjb25zdCBwb3NpdGlvbnM6IG51bWJlcltdID0gW107XHJcbiAgY29uc3Qgbm9ybWFsczogbnVtYmVyW10gPSBbXTtcclxuICBjb25zdCB1dnM6IG51bWJlcltdID0gW107XHJcbiAgY29uc3QgaW5kaWNlczogbnVtYmVyW10gPSBbXTtcclxuICBjb25zdCBtYXhSYWRpdXMgPSBNYXRoLm1heChyYWRpdXNUb3AsIHJhZGl1c0JvdHRvbSk7XHJcbiAgY29uc3QgbWluUG9zID0gbmV3IFZlYzMoLW1heFJhZGl1cywgLWhlaWdodCAvIDIsIC1tYXhSYWRpdXMpO1xyXG4gIGNvbnN0IG1heFBvcyA9IG5ldyBWZWMzKG1heFJhZGl1cywgaGVpZ2h0IC8gMiwgbWF4UmFkaXVzKTtcclxuICBjb25zdCBib3VuZGluZ1JhZGl1cyA9IGhlaWdodCAvIDI7XHJcblxyXG4gIGxldCBpbmRleCA9IDA7XHJcbiAgY29uc3QgaW5kZXhBcnJheTogbnVtYmVyW11bXSA9IFtdO1xyXG5cclxuICBnZW5lcmF0ZUJvdHRvbSgpO1xyXG5cclxuICBnZW5lcmF0ZVRvcnNvKCk7XHJcblxyXG4gIGdlbmVyYXRlVG9wKCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBwb3NpdGlvbnMsXHJcbiAgICBub3JtYWxzLFxyXG4gICAgdXZzLFxyXG4gICAgaW5kaWNlcyxcclxuICAgIG1pblBvcyxcclxuICAgIG1heFBvcyxcclxuICAgIGJvdW5kaW5nUmFkaXVzLFxyXG4gIH07XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8gaW50ZXJuYWwgZnVjbnRpb25zXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgZnVuY3Rpb24gZ2VuZXJhdGVUb3JzbyAoKSB7XHJcbiAgICAvLyB0aGlzIHdpbGwgYmUgdXNlZCB0byBjYWxjdWxhdGUgdGhlIG5vcm1hbFxyXG4gICAgY29uc3Qgc2xvcGUgPSAocmFkaXVzVG9wIC0gcmFkaXVzQm90dG9tKSAvIHRvcnNvSGVpZ2h0O1xyXG5cclxuICAgIC8vIGdlbmVyYXRlIHBvc2l0aW9ucywgbm9ybWFscyBhbmQgdXZzXHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8PSB0b3JTZWdtZW50czsgeSsrKSB7XHJcblxyXG4gICAgICBjb25zdCBpbmRleFJvdzogbnVtYmVyW10gPSBbXTtcclxuICAgICAgY29uc3QgbGF0ID0geSAvIHRvclNlZ21lbnRzO1xyXG4gICAgICBjb25zdCByYWRpdXMgPSBsYXQgKiAocmFkaXVzVG9wIC0gcmFkaXVzQm90dG9tKSArIHJhZGl1c0JvdHRvbTtcclxuXHJcbiAgICAgIGZvciAobGV0IHggPSAwOyB4IDw9IHNpZGVzOyArK3gpIHtcclxuICAgICAgICBjb25zdCB1ID0geCAvIHNpZGVzO1xyXG4gICAgICAgIGNvbnN0IHYgPSBsYXQgKiB0b3JQcm9wICsgYm90dG9tUHJvcDtcclxuICAgICAgICBjb25zdCB0aGV0YSA9IHUgKiBhcmMgLSAoYXJjIC8gNCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNpblRoZXRhID0gTWF0aC5zaW4odGhldGEpO1xyXG4gICAgICAgIGNvbnN0IGNvc1RoZXRhID0gTWF0aC5jb3ModGhldGEpO1xyXG5cclxuICAgICAgICAvLyB2ZXJ0ZXhcclxuICAgICAgICBwb3NpdGlvbnMucHVzaChyYWRpdXMgKiBzaW5UaGV0YSk7XHJcbiAgICAgICAgcG9zaXRpb25zLnB1c2gobGF0ICogdG9yc29IZWlnaHQgKyB0b3JPZmZzZXQpO1xyXG4gICAgICAgIHBvc2l0aW9ucy5wdXNoKHJhZGl1cyAqIGNvc1RoZXRhKTtcclxuXHJcbiAgICAgICAgLy8gbm9ybWFsXHJcbiAgICAgICAgVmVjMy5ub3JtYWxpemUodGVtcDEsIFZlYzMuc2V0KHRlbXAyLCBzaW5UaGV0YSwgLXNsb3BlLCBjb3NUaGV0YSkpO1xyXG4gICAgICAgIG5vcm1hbHMucHVzaCh0ZW1wMS54KTtcclxuICAgICAgICBub3JtYWxzLnB1c2godGVtcDEueSk7XHJcbiAgICAgICAgbm9ybWFscy5wdXNoKHRlbXAxLnopO1xyXG5cclxuICAgICAgICAvLyB1dlxyXG4gICAgICAgIHV2cy5wdXNoKHUsIHYpO1xyXG4gICAgICAgIC8vIHNhdmUgaW5kZXggb2YgdmVydGV4IGluIHJlc3BlY3RpdmUgcm93XHJcbiAgICAgICAgaW5kZXhSb3cucHVzaChpbmRleCk7XHJcblxyXG4gICAgICAgIC8vIGluY3JlYXNlIGluZGV4XHJcbiAgICAgICAgKytpbmRleDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gbm93IHNhdmUgcG9zaXRpb25zIG9mIHRoZSByb3cgaW4gb3VyIGluZGV4IGFycmF5XHJcbiAgICAgIGluZGV4QXJyYXkucHVzaChpbmRleFJvdyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2VuZXJhdGUgaW5kaWNlc1xyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0b3JTZWdtZW50czsgKyt5KSB7XHJcbiAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgc2lkZXM7ICsreCkge1xyXG4gICAgICAgIC8vIHdlIHVzZSB0aGUgaW5kZXggYXJyYXkgdG8gYWNjZXNzIHRoZSBjb3JyZWN0IGluZGljZXNcclxuICAgICAgICBjb25zdCBpMSA9IGluZGV4QXJyYXlbeV1beF07XHJcbiAgICAgICAgY29uc3QgaTIgPSBpbmRleEFycmF5W3kgKyAxXVt4XTtcclxuICAgICAgICBjb25zdCBpMyA9IGluZGV4QXJyYXlbeSArIDFdW3ggKyAxXTtcclxuICAgICAgICBjb25zdCBpNCA9IGluZGV4QXJyYXlbeV1beCArIDFdO1xyXG5cclxuICAgICAgICAvLyBmYWNlIG9uZVxyXG4gICAgICAgIGluZGljZXMucHVzaChpMSk7XHJcbiAgICAgICAgaW5kaWNlcy5wdXNoKGk0KTtcclxuICAgICAgICBpbmRpY2VzLnB1c2goaTIpO1xyXG5cclxuICAgICAgICAvLyBmYWNlIHR3b1xyXG4gICAgICAgIGluZGljZXMucHVzaChpNCk7XHJcbiAgICAgICAgaW5kaWNlcy5wdXNoKGkzKTtcclxuICAgICAgICBpbmRpY2VzLnB1c2goaTIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZW5lcmF0ZUJvdHRvbSAoKSB7XHJcbiAgICBmb3IgKGxldCBsYXQgPSAwOyBsYXQgPD0gYm90dG9tU2VnbWVudHM7ICsrbGF0KSB7XHJcbiAgICAgIGNvbnN0IHRoZXRhID0gbGF0ICogTWF0aC5QSSAvIGJvdHRvbVNlZ21lbnRzIC8gMjtcclxuICAgICAgY29uc3Qgc2luVGhldGEgPSBNYXRoLnNpbih0aGV0YSk7XHJcbiAgICAgIGNvbnN0IGNvc1RoZXRhID0gLU1hdGguY29zKHRoZXRhKTtcclxuXHJcbiAgICAgIGZvciAobGV0IGxvbiA9IDA7IGxvbiA8PSBzaWRlczsgKytsb24pIHtcclxuICAgICAgICBjb25zdCBwaGkgPSBsb24gKiAyICogTWF0aC5QSSAvIHNpZGVzIC0gTWF0aC5QSSAvIDIuMDtcclxuICAgICAgICBjb25zdCBzaW5QaGkgPSBNYXRoLnNpbihwaGkpO1xyXG4gICAgICAgIGNvbnN0IGNvc1BoaSA9IE1hdGguY29zKHBoaSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHggPSBzaW5QaGkgKiBzaW5UaGV0YTtcclxuICAgICAgICBjb25zdCB5ID0gY29zVGhldGE7XHJcbiAgICAgICAgY29uc3QgeiA9IGNvc1BoaSAqIHNpblRoZXRhO1xyXG4gICAgICAgIGNvbnN0IHUgPSBsb24gLyBzaWRlcztcclxuICAgICAgICBjb25zdCB2ID0gbGF0IC8gaGVpZ2h0U2VnbWVudHM7XHJcblxyXG4gICAgICAgIHBvc2l0aW9ucy5wdXNoKHggKiByYWRpdXNCb3R0b20sIHkgKiByYWRpdXNCb3R0b20gKyBib3R0b21PZmZzZXQsIHogKiByYWRpdXNCb3R0b20pO1xyXG4gICAgICAgIG5vcm1hbHMucHVzaCh4LCB5LCB6KTtcclxuICAgICAgICB1dnMucHVzaCh1LCB2KTtcclxuXHJcbiAgICAgICAgaWYgKChsYXQgPCBib3R0b21TZWdtZW50cykgJiYgKGxvbiA8IHNpZGVzKSkge1xyXG4gICAgICAgICAgY29uc3Qgc2VnMSA9IHNpZGVzICsgMTtcclxuICAgICAgICAgIGNvbnN0IGEgPSBzZWcxICogbGF0ICsgbG9uO1xyXG4gICAgICAgICAgY29uc3QgYiA9IHNlZzEgKiAobGF0ICsgMSkgKyBsb247XHJcbiAgICAgICAgICBjb25zdCBjID0gc2VnMSAqIChsYXQgKyAxKSArIGxvbiArIDE7XHJcbiAgICAgICAgICBjb25zdCBkID0gc2VnMSAqIGxhdCArIGxvbiArIDE7XHJcblxyXG4gICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGQsIGIpO1xyXG4gICAgICAgICAgaW5kaWNlcy5wdXNoKGQsIGMsIGIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgKytpbmRleDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2VuZXJhdGVUb3AgKCkge1xyXG4gICAgZm9yIChsZXQgbGF0ID0gMDsgbGF0IDw9IHRvcFNlZ21lbnRzOyArK2xhdCkge1xyXG4gICAgICBjb25zdCB0aGV0YSA9IGxhdCAqIE1hdGguUEkgLyB0b3BTZWdtZW50cyAvIDIgKyBNYXRoLlBJIC8gMjtcclxuICAgICAgY29uc3Qgc2luVGhldGEgPSBNYXRoLnNpbih0aGV0YSk7XHJcbiAgICAgIGNvbnN0IGNvc1RoZXRhID0gLU1hdGguY29zKHRoZXRhKTtcclxuXHJcbiAgICAgIGZvciAobGV0IGxvbiA9IDA7IGxvbiA8PSBzaWRlczsgKytsb24pIHtcclxuICAgICAgICBjb25zdCBwaGkgPSBsb24gKiAyICogTWF0aC5QSSAvIHNpZGVzIC0gTWF0aC5QSSAvIDIuMDtcclxuICAgICAgICBjb25zdCBzaW5QaGkgPSBNYXRoLnNpbihwaGkpO1xyXG4gICAgICAgIGNvbnN0IGNvc1BoaSA9IE1hdGguY29zKHBoaSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHggPSBzaW5QaGkgKiBzaW5UaGV0YTtcclxuICAgICAgICBjb25zdCB5ID0gY29zVGhldGE7XHJcbiAgICAgICAgY29uc3QgeiA9IGNvc1BoaSAqIHNpblRoZXRhO1xyXG4gICAgICAgIGNvbnN0IHUgPSBsb24gLyBzaWRlcztcclxuICAgICAgICBjb25zdCB2ID0gbGF0IC8gaGVpZ2h0U2VnbWVudHMgKyAoMSAtIHRvcFByb3ApO1xyXG5cclxuICAgICAgICBwb3NpdGlvbnMucHVzaCh4ICogcmFkaXVzVG9wLCB5ICogcmFkaXVzVG9wICsgdG9wT2Zmc2V0LCB6ICogcmFkaXVzVG9wKTtcclxuICAgICAgICBub3JtYWxzLnB1c2goeCwgeSwgeik7XHJcbiAgICAgICAgdXZzLnB1c2godSwgdik7XHJcblxyXG4gICAgICAgIGlmICgobGF0IDwgdG9wU2VnbWVudHMpICYmIChsb24gPCBzaWRlcykpIHtcclxuICAgICAgICAgIGNvbnN0IHNlZzEgPSBzaWRlcyArIDE7XHJcbiAgICAgICAgICBjb25zdCBhID0gc2VnMSAqIGxhdCArIGxvbiArIGluZGV4QXJyYXlbdG9yU2VnbWVudHNdW3NpZGVzXSArIDE7XHJcbiAgICAgICAgICBjb25zdCBiID0gc2VnMSAqIChsYXQgKyAxKSArIGxvbiArIGluZGV4QXJyYXlbdG9yU2VnbWVudHNdW3NpZGVzXSArIDE7XHJcbiAgICAgICAgICBjb25zdCBjID0gc2VnMSAqIChsYXQgKyAxKSArIGxvbiArIDEgKyBpbmRleEFycmF5W3RvclNlZ21lbnRzXVtzaWRlc10gKyAxO1xyXG4gICAgICAgICAgY29uc3QgZCA9IHNlZzEgKiBsYXQgKyBsb24gKyAxICsgaW5kZXhBcnJheVt0b3JTZWdtZW50c11bc2lkZXNdICsgMTtcclxuXHJcbiAgICAgICAgICBpbmRpY2VzLnB1c2goYSwgZCwgYik7XHJcbiAgICAgICAgICBpbmRpY2VzLnB1c2goZCwgYywgYik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==