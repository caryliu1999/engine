(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../gfx/define.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../gfx/define.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.define);
    global.transform = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _define) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.translate = translate;
  _exports.scale = scale;
  _exports.wireframed = wireframed;

  /**
   * @category 3d/primitive
   */

  /**
   * @en
   * Translate the geometry.
   * @zh
   * 平移几何体。
   * @param geometry 几何体信息。
   * @param offset 偏移量。
   */
  function translate(geometry, offset) {
    var x = offset.x || 0;
    var y = offset.y || 0;
    var z = offset.z || 0;
    var nVertex = Math.floor(geometry.positions.length / 3);

    for (var iVertex = 0; iVertex < nVertex; ++iVertex) {
      var iX = iVertex * 3;
      var iY = iVertex * 3 + 1;
      var iZ = iVertex * 3 + 2;
      geometry.positions[iX] = geometry.positions[iX] + x;
      geometry.positions[iY] = geometry.positions[iY] + y;
      geometry.positions[iZ] = geometry.positions[iZ] + z;
    }

    if (geometry.minPos) {
      geometry.minPos.x += x;
      geometry.minPos.y += y;
      geometry.minPos.z += z;
    }

    if (geometry.maxPos) {
      geometry.maxPos.x += x;
      geometry.maxPos.y += y;
      geometry.maxPos.z += z;
    }

    return geometry;
  }
  /**
   * @en
   * Scale the geometry.
   * @zh
   * 缩放几何体。
   * @param geometry 几何体信息。
   * @param value 缩放量。
   */


  function scale(geometry, value) {
    var x = value.x || 0;
    var y = value.y || 0;
    var z = value.z || 0;
    var nVertex = Math.floor(geometry.positions.length / 3);

    for (var iVertex = 0; iVertex < nVertex; ++iVertex) {
      var iX = iVertex * 3;
      var iY = iVertex * 3 + 1;
      var iZ = iVertex * 3 + 2;
      geometry.positions[iX] *= x;
      geometry.positions[iY] *= y;
      geometry.positions[iZ] *= z;
    }

    if (geometry.minPos) {
      geometry.minPos.x *= x;
      geometry.minPos.y *= y;
      geometry.minPos.z *= z;
    }

    if (geometry.maxPos) {
      geometry.maxPos.x *= x;
      geometry.maxPos.y *= y;
      geometry.maxPos.z *= z;
    }

    geometry.boundingRadius = Math.max(Math.max(x, y), z);
    return geometry;
  }
  /**
   * @en
   * Converts geometry to wireframe mode. Only geometry with triangle topology is supported.
   * @zh
   * 将几何体转换为线框模式，仅支持三角形拓扑的几何体。
   * @param geometry 几何体信息。
   */


  function wireframed(geometry) {
    var indices = geometry.indices;

    if (!indices) {
      return geometry;
    } // We only support triangles' wireframe.


    if (geometry.primitiveMode && geometry.primitiveMode !== _define.GFXPrimitiveMode.TRIANGLE_LIST) {
      return geometry;
    }

    var offsets = [[0, 1], [1, 2], [2, 0]];
    var lines = [];
    var lineIDs = {};

    for (var i = 0; i < indices.length; i += 3) {
      for (var k = 0; k < 3; ++k) {
        var i1 = indices[i + offsets[k][0]];
        var i2 = indices[i + offsets[k][1]]; // check if we already have the line in our lines

        var id = i1 > i2 ? i2 << 16 | i1 : i1 << 16 | i2;

        if (lineIDs[id] === undefined) {
          lineIDs[id] = 0;
          lines.push(i1, i2);
        }
      }
    }

    geometry.indices = lines;
    geometry.primitiveMode = _define.GFXPrimitiveMode.LINE_LIST;
    return geometry;
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL2NvcmUvcHJpbWl0aXZlL3RyYW5zZm9ybS50cyJdLCJuYW1lcyI6WyJ0cmFuc2xhdGUiLCJnZW9tZXRyeSIsIm9mZnNldCIsIngiLCJ5IiwieiIsIm5WZXJ0ZXgiLCJNYXRoIiwiZmxvb3IiLCJwb3NpdGlvbnMiLCJsZW5ndGgiLCJpVmVydGV4IiwiaVgiLCJpWSIsImlaIiwibWluUG9zIiwibWF4UG9zIiwic2NhbGUiLCJ2YWx1ZSIsImJvdW5kaW5nUmFkaXVzIiwibWF4Iiwid2lyZWZyYW1lZCIsImluZGljZXMiLCJwcmltaXRpdmVNb2RlIiwiR0ZYUHJpbWl0aXZlTW9kZSIsIlRSSUFOR0xFX0xJU1QiLCJvZmZzZXRzIiwibGluZXMiLCJsaW5lSURzIiwiaSIsImsiLCJpMSIsImkyIiwiaWQiLCJ1bmRlZmluZWQiLCJwdXNoIiwiTElORV9MSVNUIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFPQTs7Ozs7Ozs7QUFRTyxXQUFTQSxTQUFULENBQW9CQyxRQUFwQixFQUF5Q0MsTUFBekMsRUFBMEY7QUFDN0YsUUFBTUMsQ0FBQyxHQUFHRCxNQUFNLENBQUNDLENBQVAsSUFBWSxDQUF0QjtBQUNBLFFBQU1DLENBQUMsR0FBR0YsTUFBTSxDQUFDRSxDQUFQLElBQVksQ0FBdEI7QUFDQSxRQUFNQyxDQUFDLEdBQUdILE1BQU0sQ0FBQ0csQ0FBUCxJQUFZLENBQXRCO0FBQ0EsUUFBTUMsT0FBTyxHQUFHQyxJQUFJLENBQUNDLEtBQUwsQ0FBV1AsUUFBUSxDQUFDUSxTQUFULENBQW1CQyxNQUFuQixHQUE0QixDQUF2QyxDQUFoQjs7QUFDQSxTQUFLLElBQUlDLE9BQU8sR0FBRyxDQUFuQixFQUFzQkEsT0FBTyxHQUFHTCxPQUFoQyxFQUF5QyxFQUFFSyxPQUEzQyxFQUFvRDtBQUNoRCxVQUFNQyxFQUFFLEdBQUdELE9BQU8sR0FBRyxDQUFyQjtBQUNBLFVBQU1FLEVBQUUsR0FBR0YsT0FBTyxHQUFHLENBQVYsR0FBYyxDQUF6QjtBQUNBLFVBQU1HLEVBQUUsR0FBR0gsT0FBTyxHQUFHLENBQVYsR0FBYyxDQUF6QjtBQUNBVixNQUFBQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJHLEVBQW5CLElBQXlCWCxRQUFRLENBQUNRLFNBQVQsQ0FBbUJHLEVBQW5CLElBQXlCVCxDQUFsRDtBQUNBRixNQUFBQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJJLEVBQW5CLElBQXlCWixRQUFRLENBQUNRLFNBQVQsQ0FBbUJJLEVBQW5CLElBQXlCVCxDQUFsRDtBQUNBSCxNQUFBQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJLLEVBQW5CLElBQXlCYixRQUFRLENBQUNRLFNBQVQsQ0FBbUJLLEVBQW5CLElBQXlCVCxDQUFsRDtBQUNIOztBQUNELFFBQUlKLFFBQVEsQ0FBQ2MsTUFBYixFQUFxQjtBQUNqQmQsTUFBQUEsUUFBUSxDQUFDYyxNQUFULENBQWdCWixDQUFoQixJQUFxQkEsQ0FBckI7QUFDQUYsTUFBQUEsUUFBUSxDQUFDYyxNQUFULENBQWdCWCxDQUFoQixJQUFxQkEsQ0FBckI7QUFDQUgsTUFBQUEsUUFBUSxDQUFDYyxNQUFULENBQWdCVixDQUFoQixJQUFxQkEsQ0FBckI7QUFDSDs7QUFDRCxRQUFJSixRQUFRLENBQUNlLE1BQWIsRUFBcUI7QUFDakJmLE1BQUFBLFFBQVEsQ0FBQ2UsTUFBVCxDQUFnQmIsQ0FBaEIsSUFBcUJBLENBQXJCO0FBQ0FGLE1BQUFBLFFBQVEsQ0FBQ2UsTUFBVCxDQUFnQlosQ0FBaEIsSUFBcUJBLENBQXJCO0FBQ0FILE1BQUFBLFFBQVEsQ0FBQ2UsTUFBVCxDQUFnQlgsQ0FBaEIsSUFBcUJBLENBQXJCO0FBQ0g7O0FBQ0QsV0FBT0osUUFBUDtBQUNIO0FBRUQ7Ozs7Ozs7Ozs7QUFRTyxXQUFTZ0IsS0FBVCxDQUFnQmhCLFFBQWhCLEVBQXFDaUIsS0FBckMsRUFBb0Y7QUFDdkYsUUFBTWYsQ0FBQyxHQUFHZSxLQUFLLENBQUNmLENBQU4sSUFBVyxDQUFyQjtBQUNBLFFBQU1DLENBQUMsR0FBR2MsS0FBSyxDQUFDZCxDQUFOLElBQVcsQ0FBckI7QUFDQSxRQUFNQyxDQUFDLEdBQUdhLEtBQUssQ0FBQ2IsQ0FBTixJQUFXLENBQXJCO0FBQ0EsUUFBTUMsT0FBTyxHQUFHQyxJQUFJLENBQUNDLEtBQUwsQ0FBV1AsUUFBUSxDQUFDUSxTQUFULENBQW1CQyxNQUFuQixHQUE0QixDQUF2QyxDQUFoQjs7QUFDQSxTQUFLLElBQUlDLE9BQU8sR0FBRyxDQUFuQixFQUFzQkEsT0FBTyxHQUFHTCxPQUFoQyxFQUF5QyxFQUFFSyxPQUEzQyxFQUFvRDtBQUNoRCxVQUFNQyxFQUFFLEdBQUdELE9BQU8sR0FBRyxDQUFyQjtBQUNBLFVBQU1FLEVBQUUsR0FBR0YsT0FBTyxHQUFHLENBQVYsR0FBYyxDQUF6QjtBQUNBLFVBQU1HLEVBQUUsR0FBR0gsT0FBTyxHQUFHLENBQVYsR0FBYyxDQUF6QjtBQUNBVixNQUFBQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJHLEVBQW5CLEtBQTBCVCxDQUExQjtBQUNBRixNQUFBQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJJLEVBQW5CLEtBQTBCVCxDQUExQjtBQUNBSCxNQUFBQSxRQUFRLENBQUNRLFNBQVQsQ0FBbUJLLEVBQW5CLEtBQTBCVCxDQUExQjtBQUNIOztBQUNELFFBQUlKLFFBQVEsQ0FBQ2MsTUFBYixFQUFxQjtBQUNqQmQsTUFBQUEsUUFBUSxDQUFDYyxNQUFULENBQWdCWixDQUFoQixJQUFxQkEsQ0FBckI7QUFDQUYsTUFBQUEsUUFBUSxDQUFDYyxNQUFULENBQWdCWCxDQUFoQixJQUFxQkEsQ0FBckI7QUFDQUgsTUFBQUEsUUFBUSxDQUFDYyxNQUFULENBQWdCVixDQUFoQixJQUFxQkEsQ0FBckI7QUFDSDs7QUFDRCxRQUFJSixRQUFRLENBQUNlLE1BQWIsRUFBcUI7QUFDakJmLE1BQUFBLFFBQVEsQ0FBQ2UsTUFBVCxDQUFnQmIsQ0FBaEIsSUFBcUJBLENBQXJCO0FBQ0FGLE1BQUFBLFFBQVEsQ0FBQ2UsTUFBVCxDQUFnQlosQ0FBaEIsSUFBcUJBLENBQXJCO0FBQ0FILE1BQUFBLFFBQVEsQ0FBQ2UsTUFBVCxDQUFnQlgsQ0FBaEIsSUFBcUJBLENBQXJCO0FBQ0g7O0FBQ0RKLElBQUFBLFFBQVEsQ0FBQ2tCLGNBQVQsR0FBMEJaLElBQUksQ0FBQ2EsR0FBTCxDQUFTYixJQUFJLENBQUNhLEdBQUwsQ0FBU2pCLENBQVQsRUFBWUMsQ0FBWixDQUFULEVBQXlCQyxDQUF6QixDQUExQjtBQUNBLFdBQU9KLFFBQVA7QUFDSDtBQUVEOzs7Ozs7Ozs7QUFPTyxXQUFTb0IsVUFBVCxDQUFxQnBCLFFBQXJCLEVBQTBDO0FBQUEsUUFDckNxQixPQURxQyxHQUN6QnJCLFFBRHlCLENBQ3JDcUIsT0FEcUM7O0FBRTdDLFFBQUksQ0FBQ0EsT0FBTCxFQUFjO0FBQ1YsYUFBT3JCLFFBQVA7QUFDSCxLQUo0QyxDQU03Qzs7O0FBQ0EsUUFBSUEsUUFBUSxDQUFDc0IsYUFBVCxJQUEwQnRCLFFBQVEsQ0FBQ3NCLGFBQVQsS0FBMkJDLHlCQUFpQkMsYUFBMUUsRUFBeUY7QUFDckYsYUFBT3hCLFFBQVA7QUFDSDs7QUFFRCxRQUFNeUIsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFELEVBQVMsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFULEVBQWlCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBakIsQ0FBaEI7QUFDQSxRQUFNQyxLQUFlLEdBQUcsRUFBeEI7QUFDQSxRQUFNQyxPQUFPLEdBQUcsRUFBaEI7O0FBRUEsU0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHUCxPQUFPLENBQUNaLE1BQTVCLEVBQW9DbUIsQ0FBQyxJQUFJLENBQXpDLEVBQTRDO0FBQzFDLFdBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxDQUFwQixFQUF1QixFQUFFQSxDQUF6QixFQUE0QjtBQUMxQixZQUFNQyxFQUFFLEdBQUdULE9BQU8sQ0FBQ08sQ0FBQyxHQUFHSCxPQUFPLENBQUNJLENBQUQsQ0FBUCxDQUFXLENBQVgsQ0FBTCxDQUFsQjtBQUNBLFlBQU1FLEVBQUUsR0FBR1YsT0FBTyxDQUFDTyxDQUFDLEdBQUdILE9BQU8sQ0FBQ0ksQ0FBRCxDQUFQLENBQVcsQ0FBWCxDQUFMLENBQWxCLENBRjBCLENBSTFCOztBQUNBLFlBQU1HLEVBQUUsR0FBSUYsRUFBRSxHQUFHQyxFQUFOLEdBQWNBLEVBQUUsSUFBSSxFQUFQLEdBQWFELEVBQTFCLEdBQWtDQSxFQUFFLElBQUksRUFBUCxHQUFhQyxFQUF6RDs7QUFDQSxZQUFJSixPQUFPLENBQUNLLEVBQUQsQ0FBUCxLQUFnQkMsU0FBcEIsRUFBK0I7QUFDN0JOLFVBQUFBLE9BQU8sQ0FBQ0ssRUFBRCxDQUFQLEdBQWMsQ0FBZDtBQUNBTixVQUFBQSxLQUFLLENBQUNRLElBQU4sQ0FBV0osRUFBWCxFQUFlQyxFQUFmO0FBQ0Q7QUFDRjtBQUNGOztBQUVEL0IsSUFBQUEsUUFBUSxDQUFDcUIsT0FBVCxHQUFtQkssS0FBbkI7QUFDQTFCLElBQUFBLFFBQVEsQ0FBQ3NCLGFBQVQsR0FBeUJDLHlCQUFpQlksU0FBMUM7QUFDQSxXQUFPbkMsUUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBjYXRlZ29yeSAzZC9wcmltaXRpdmVcclxuICovXHJcblxyXG5pbXBvcnQgeyBHRlhQcmltaXRpdmVNb2RlIH0gZnJvbSAnLi4vZ2Z4L2RlZmluZSc7XHJcbmltcG9ydCB7IElHZW9tZXRyeSB9IGZyb20gJy4vZGVmaW5lJztcclxuXHJcbi8qKlxyXG4gKiBAZW5cclxuICogVHJhbnNsYXRlIHRoZSBnZW9tZXRyeS5cclxuICogQHpoXHJcbiAqIOW5s+enu+WHoOS9leS9k+OAglxyXG4gKiBAcGFyYW0gZ2VvbWV0cnkg5Yeg5L2V5L2T5L+h5oGv44CCXHJcbiAqIEBwYXJhbSBvZmZzZXQg5YGP56e76YeP44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNsYXRlIChnZW9tZXRyeTogSUdlb21ldHJ5LCBvZmZzZXQ6IHsgeD86IG51bWJlcjsgeT86IG51bWJlcjsgej86IG51bWJlcjsgfSkge1xyXG4gICAgY29uc3QgeCA9IG9mZnNldC54IHx8IDA7XHJcbiAgICBjb25zdCB5ID0gb2Zmc2V0LnkgfHwgMDtcclxuICAgIGNvbnN0IHogPSBvZmZzZXQueiB8fCAwO1xyXG4gICAgY29uc3QgblZlcnRleCA9IE1hdGguZmxvb3IoZ2VvbWV0cnkucG9zaXRpb25zLmxlbmd0aCAvIDMpO1xyXG4gICAgZm9yIChsZXQgaVZlcnRleCA9IDA7IGlWZXJ0ZXggPCBuVmVydGV4OyArK2lWZXJ0ZXgpIHtcclxuICAgICAgICBjb25zdCBpWCA9IGlWZXJ0ZXggKiAzO1xyXG4gICAgICAgIGNvbnN0IGlZID0gaVZlcnRleCAqIDMgKyAxO1xyXG4gICAgICAgIGNvbnN0IGlaID0gaVZlcnRleCAqIDMgKyAyO1xyXG4gICAgICAgIGdlb21ldHJ5LnBvc2l0aW9uc1tpWF0gPSBnZW9tZXRyeS5wb3NpdGlvbnNbaVhdICsgeDtcclxuICAgICAgICBnZW9tZXRyeS5wb3NpdGlvbnNbaVldID0gZ2VvbWV0cnkucG9zaXRpb25zW2lZXSArIHk7XHJcbiAgICAgICAgZ2VvbWV0cnkucG9zaXRpb25zW2laXSA9IGdlb21ldHJ5LnBvc2l0aW9uc1tpWl0gKyB6O1xyXG4gICAgfVxyXG4gICAgaWYgKGdlb21ldHJ5Lm1pblBvcykge1xyXG4gICAgICAgIGdlb21ldHJ5Lm1pblBvcy54ICs9IHg7XHJcbiAgICAgICAgZ2VvbWV0cnkubWluUG9zLnkgKz0geTtcclxuICAgICAgICBnZW9tZXRyeS5taW5Qb3MueiArPSB6O1xyXG4gICAgfVxyXG4gICAgaWYgKGdlb21ldHJ5Lm1heFBvcykge1xyXG4gICAgICAgIGdlb21ldHJ5Lm1heFBvcy54ICs9IHg7XHJcbiAgICAgICAgZ2VvbWV0cnkubWF4UG9zLnkgKz0geTtcclxuICAgICAgICBnZW9tZXRyeS5tYXhQb3MueiArPSB6O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGdlb21ldHJ5O1xyXG59XHJcblxyXG4vKipcclxuICogQGVuXHJcbiAqIFNjYWxlIHRoZSBnZW9tZXRyeS5cclxuICogQHpoXHJcbiAqIOe8qeaUvuWHoOS9leS9k+OAglxyXG4gKiBAcGFyYW0gZ2VvbWV0cnkg5Yeg5L2V5L2T5L+h5oGv44CCXHJcbiAqIEBwYXJhbSB2YWx1ZSDnvKnmlL7ph4/jgIJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzY2FsZSAoZ2VvbWV0cnk6IElHZW9tZXRyeSwgdmFsdWU6IHsgeD86IG51bWJlcjsgeT86IG51bWJlcjsgej86IG51bWJlciB9KSB7XHJcbiAgICBjb25zdCB4ID0gdmFsdWUueCB8fCAwO1xyXG4gICAgY29uc3QgeSA9IHZhbHVlLnkgfHwgMDtcclxuICAgIGNvbnN0IHogPSB2YWx1ZS56IHx8IDA7XHJcbiAgICBjb25zdCBuVmVydGV4ID0gTWF0aC5mbG9vcihnZW9tZXRyeS5wb3NpdGlvbnMubGVuZ3RoIC8gMyk7XHJcbiAgICBmb3IgKGxldCBpVmVydGV4ID0gMDsgaVZlcnRleCA8IG5WZXJ0ZXg7ICsraVZlcnRleCkge1xyXG4gICAgICAgIGNvbnN0IGlYID0gaVZlcnRleCAqIDM7XHJcbiAgICAgICAgY29uc3QgaVkgPSBpVmVydGV4ICogMyArIDE7XHJcbiAgICAgICAgY29uc3QgaVogPSBpVmVydGV4ICogMyArIDI7XHJcbiAgICAgICAgZ2VvbWV0cnkucG9zaXRpb25zW2lYXSAqPSB4O1xyXG4gICAgICAgIGdlb21ldHJ5LnBvc2l0aW9uc1tpWV0gKj0geTtcclxuICAgICAgICBnZW9tZXRyeS5wb3NpdGlvbnNbaVpdICo9IHo7XHJcbiAgICB9XHJcbiAgICBpZiAoZ2VvbWV0cnkubWluUG9zKSB7XHJcbiAgICAgICAgZ2VvbWV0cnkubWluUG9zLnggKj0geDtcclxuICAgICAgICBnZW9tZXRyeS5taW5Qb3MueSAqPSB5O1xyXG4gICAgICAgIGdlb21ldHJ5Lm1pblBvcy56ICo9IHo7XHJcbiAgICB9XHJcbiAgICBpZiAoZ2VvbWV0cnkubWF4UG9zKSB7XHJcbiAgICAgICAgZ2VvbWV0cnkubWF4UG9zLnggKj0geDtcclxuICAgICAgICBnZW9tZXRyeS5tYXhQb3MueSAqPSB5O1xyXG4gICAgICAgIGdlb21ldHJ5Lm1heFBvcy56ICo9IHo7XHJcbiAgICB9XHJcbiAgICBnZW9tZXRyeS5ib3VuZGluZ1JhZGl1cyA9IE1hdGgubWF4KE1hdGgubWF4KHgsIHkpLCB6KTtcclxuICAgIHJldHVybiBnZW9tZXRyeTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBlblxyXG4gKiBDb252ZXJ0cyBnZW9tZXRyeSB0byB3aXJlZnJhbWUgbW9kZS4gT25seSBnZW9tZXRyeSB3aXRoIHRyaWFuZ2xlIHRvcG9sb2d5IGlzIHN1cHBvcnRlZC5cclxuICogQHpoXHJcbiAqIOWwhuWHoOS9leS9k+i9rOaNouS4uue6v+ahhuaooeW8j++8jOS7heaUr+aMgeS4ieinkuW9ouaLk+aJkeeahOWHoOS9leS9k+OAglxyXG4gKiBAcGFyYW0gZ2VvbWV0cnkg5Yeg5L2V5L2T5L+h5oGv44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gd2lyZWZyYW1lZCAoZ2VvbWV0cnk6IElHZW9tZXRyeSkge1xyXG4gICAgY29uc3QgeyBpbmRpY2VzIH0gPSBnZW9tZXRyeTtcclxuICAgIGlmICghaW5kaWNlcykge1xyXG4gICAgICAgIHJldHVybiBnZW9tZXRyeTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBXZSBvbmx5IHN1cHBvcnQgdHJpYW5nbGVzJyB3aXJlZnJhbWUuXHJcbiAgICBpZiAoZ2VvbWV0cnkucHJpbWl0aXZlTW9kZSAmJiBnZW9tZXRyeS5wcmltaXRpdmVNb2RlICE9PSBHRlhQcmltaXRpdmVNb2RlLlRSSUFOR0xFX0xJU1QpIHtcclxuICAgICAgICByZXR1cm4gZ2VvbWV0cnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb2Zmc2V0cyA9IFtbMCwgMV0sIFsxLCAyXSwgWzIsIDBdXTtcclxuICAgIGNvbnN0IGxpbmVzOiBudW1iZXJbXSA9IFtdO1xyXG4gICAgY29uc3QgbGluZUlEcyA9IHt9O1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kaWNlcy5sZW5ndGg7IGkgKz0gMykge1xyXG4gICAgICBmb3IgKGxldCBrID0gMDsgayA8IDM7ICsraykge1xyXG4gICAgICAgIGNvbnN0IGkxID0gaW5kaWNlc1tpICsgb2Zmc2V0c1trXVswXV07XHJcbiAgICAgICAgY29uc3QgaTIgPSBpbmRpY2VzW2kgKyBvZmZzZXRzW2tdWzFdXTtcclxuXHJcbiAgICAgICAgLy8gY2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZlIHRoZSBsaW5lIGluIG91ciBsaW5lc1xyXG4gICAgICAgIGNvbnN0IGlkID0gKGkxID4gaTIpID8gKChpMiA8PCAxNikgfCBpMSkgOiAoKGkxIDw8IDE2KSB8IGkyKTtcclxuICAgICAgICBpZiAobGluZUlEc1tpZF0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgbGluZUlEc1tpZF0gPSAwO1xyXG4gICAgICAgICAgbGluZXMucHVzaChpMSwgaTIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdlb21ldHJ5LmluZGljZXMgPSBsaW5lcztcclxuICAgIGdlb21ldHJ5LnByaW1pdGl2ZU1vZGUgPSBHRlhQcmltaXRpdmVNb2RlLkxJTkVfTElTVDtcclxuICAgIHJldHVybiBnZW9tZXRyeTtcclxuICB9XHJcbiJdfQ==