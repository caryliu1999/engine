(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../platform/debug.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../platform/debug.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.debug);
    global.deprecated = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _debug) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.setDefaultLogTimes = setDefaultLogTimes;
  _exports.markAsWarning = _exports.removeProperty = _exports.replaceProperty = void 0;

  /**
   * @hidden
   */
  var defaultLogTimes = 10;

  function setDefaultLogTimes(times) {
    if (times > 0) {
      defaultLogTimes = times;
    }
  }

  ;
  var replaceProperty;
  _exports.replaceProperty = replaceProperty;
  var removeProperty;
  _exports.removeProperty = removeProperty;
  var markAsWarning;
  _exports.markAsWarning = markAsWarning;
  var replacePropertyLog;
  var markAsWarningLog;
  var removePropertyLog; // if (DEBUG) {

  var messageID = 0;
  var messageMap = new Map();

  replacePropertyLog = function replacePropertyLog(n, dp, n2, newp, f, id) {
    var item = messageMap.get(id);

    if (item && item.logTimes > item.count) {
      f('\'%s\' is deprecated, please use \'%s\' instead.', "".concat(n, ".").concat(dp), "".concat(n2, ".").concat(newp));
      item.count++;
    }
  };

  _exports.replaceProperty = replaceProperty = function replaceProperty(owner, ownerName, properties) {
    if (owner == null) return;
    properties.forEach(function (item) {
      var id = messageID++;
      messageMap.set(id, {
        id: id,
        count: 0,
        logTimes: item.logTimes !== undefined ? item.logTimes : defaultLogTimes
      });
      var target = item.target != null ? item.target : owner;
      var newName = item.newName != null ? item.newName : item.name;
      var targetName = item.targetName != null ? item.targetName : ownerName;
      var sameTarget = target == owner;

      if (item.customFunction != null) {
        owner[item.name] = function () {
          var _ref;

          replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);
          return (_ref = item.customFunction).call.apply(_ref, [this].concat(Array.prototype.slice.call(arguments)));
        };
      } else if (item.customSetter != null || item.customGetter != null) {
        var hasSetter = item.customSetter != null;
        var hasGetter = item.customGetter != null;

        if (hasSetter && hasGetter) {
          Object.defineProperty(owner, item.name, {
            get: function get() {
              replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);
              return item.customGetter.call(this);
            },
            set: function set(v) {
              replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);
              item.customSetter.call(this, v);
            }
          });
        } else if (hasSetter) {
          Object.defineProperty(owner, item.name, {
            set: function set(v) {
              replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);
              item.customSetter.call(this, v);
            }
          });
        } else if (hasGetter) {
          Object.defineProperty(owner, item.name, {
            get: function get() {
              replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);
              return item.customGetter.call(this);
            }
          });
        }
      } else {
        Object.defineProperty(owner, item.name, {
          get: function get() {
            replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);
            return sameTarget ? this[newName] : target[newName];
          },
          set: function set(v) {
            replacePropertyLog(ownerName, item.name, targetName, newName, _debug.warn, id);

            if (sameTarget) {
              this[newName] = v;
            } else {
              target[newName] = v;
            }
          }
        });
      }
    });
  };

  removePropertyLog = function removePropertyLog(n, dp, f, id, s) {
    var item = messageMap.get(id);
    var ss = s === undefined ? '' : '(' + s + ')';

    if (item && item.logTimes > item.count) {
      f('\'%s\' has been removed. ' + ss, "".concat(n, ".").concat(dp));
      item.count++;
    }
  };

  _exports.removeProperty = removeProperty = function removeProperty(owner, ownerName, properties) {
    if (owner == null) return;
    properties.forEach(function (item) {
      var id = messageID++;
      messageMap.set(id, {
        id: id,
        count: 0,
        logTimes: item.logTimes !== undefined ? item.logTimes : defaultLogTimes
      });
      Object.defineProperty(owner, item.name, {
        get: function get() {
          return removePropertyLog(ownerName, item.name, _debug.error, id, item.suggest);
        },
        set: function set() {
          removePropertyLog(ownerName, item.name, _debug.error, id, item.suggest);
        }
      });
    });
  };

  markAsWarningLog = function markAsWarningLog(n, dp, f, id, s) {
    var item = messageMap.get(id);
    var ss = s === undefined ? '' : '(' + s + ')';

    if (item && item.logTimes > item.count) {
      f('\'%s\' is deprecated. ' + ss, "".concat(n, ".").concat(dp));
      item.count++;
    }
  };

  _exports.markAsWarning = markAsWarning = function markAsWarning(owner, ownerName, properties) {
    if (owner == null) return;

    var _defaultGetSet = function _defaultGetSet(d, n, dp, f, id, s) {
      if (d.get) {
        var oldGet = d.get();

        d.get = function () {
          markAsWarningLog(n, dp, f, id, s);
          return oldGet.call(this);
        };
      }

      if (d.set) {
        var oldSet = Object.create(d.set);

        d.set = function (v) {
          markAsWarningLog(n, dp, f, id, s);
          oldSet.call(this, v);
        };
      }
    };

    properties.forEach(function (item) {
      var deprecatedProp = item.name;
      var descriptor = Object.getOwnPropertyDescriptor(owner, deprecatedProp);

      if (!descriptor) {
        return;
      }

      var id = messageID++;
      messageMap.set(id, {
        id: id,
        count: 0,
        logTimes: item.logTimes !== undefined ? item.logTimes : defaultLogTimes
      });

      if (descriptor.value != null) {
        if (typeof descriptor.value === 'function') {
          var oldValue = descriptor.value;

          owner[deprecatedProp] = function () {
            markAsWarningLog(ownerName, deprecatedProp, _debug.warn, id, item.suggest);
            return oldValue.call.apply(oldValue, [this].concat(Array.prototype.slice.call(arguments)));
          };
        } else {
          _defaultGetSet(descriptor, ownerName, deprecatedProp, _debug.warn, id, item.suggest);
        }
      } else {
        _defaultGetSet(descriptor, ownerName, deprecatedProp, _debug.warn, id, item.suggest);
      }
    });
  }; // } else {
  //     // for compatible
  //     replaceProperty = () => { };
  //     removeProperty = () => { };
  //     markAsWarning = () => { };
  //     replacePropertyLog = () => { };
  //     removePropertyLog = () => { };
  //     markAsWarningLog = () => { };
  // }

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL2NvcmUvdXRpbHMvZGVwcmVjYXRlZC50cyJdLCJuYW1lcyI6WyJkZWZhdWx0TG9nVGltZXMiLCJzZXREZWZhdWx0TG9nVGltZXMiLCJ0aW1lcyIsInJlcGxhY2VQcm9wZXJ0eSIsInJlbW92ZVByb3BlcnR5IiwibWFya0FzV2FybmluZyIsInJlcGxhY2VQcm9wZXJ0eUxvZyIsIm1hcmtBc1dhcm5pbmdMb2ciLCJyZW1vdmVQcm9wZXJ0eUxvZyIsIm1lc3NhZ2VJRCIsIm1lc3NhZ2VNYXAiLCJNYXAiLCJuIiwiZHAiLCJuMiIsIm5ld3AiLCJmIiwiaWQiLCJpdGVtIiwiZ2V0IiwibG9nVGltZXMiLCJjb3VudCIsIm93bmVyIiwib3duZXJOYW1lIiwicHJvcGVydGllcyIsImZvckVhY2giLCJzZXQiLCJ1bmRlZmluZWQiLCJ0YXJnZXQiLCJuZXdOYW1lIiwibmFtZSIsInRhcmdldE5hbWUiLCJzYW1lVGFyZ2V0IiwiY3VzdG9tRnVuY3Rpb24iLCJ3YXJuIiwiY2FsbCIsImFyZ3VtZW50cyIsImN1c3RvbVNldHRlciIsImN1c3RvbUdldHRlciIsImhhc1NldHRlciIsImhhc0dldHRlciIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwidiIsInMiLCJzcyIsImVycm9yIiwic3VnZ2VzdCIsIl9kZWZhdWx0R2V0U2V0IiwiZCIsIm9sZEdldCIsIm9sZFNldCIsImNyZWF0ZSIsImRlcHJlY2F0ZWRQcm9wIiwiZGVzY3JpcHRvciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInZhbHVlIiwib2xkVmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7QUFNQSxNQUFJQSxlQUFlLEdBQUcsRUFBdEI7O0FBRU8sV0FBU0Msa0JBQVQsQ0FBNkJDLEtBQTdCLEVBQWtEO0FBQ3JELFFBQUlBLEtBQUssR0FBRyxDQUFaLEVBQWU7QUFDWEYsTUFBQUEsZUFBZSxHQUFHRSxLQUFs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QGhpZGRlblxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGVycm9yLCB3YXJuIH0gZnJvbSAnLi4vcGxhdGZvcm0vZGVidWcnO1xyXG5cclxubGV0IGRlZmF1bHRMb2dUaW1lcyA9IDEwO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRMb2dUaW1lcyAodGltZXM6IG51bWJlcik6IHZvaWQge1xyXG4gICAgaWYgKHRpbWVzID4gMCkge1xyXG4gICAgICAgIGRlZmF1bHRMb2dUaW1lcyA9IHRpbWVzO1xyXG4gICAgfVxyXG59O1xyXG5cclxuaW50ZXJmYWNlIElSZXBsYWNlbWVudCB7XHJcbiAgICAvKiog5bqf5byD5bGe5oCn55qE5ZCN56ewICovXHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAvKiog6K2m5ZGK55qE5qyh5pWwICovXHJcbiAgICBsb2dUaW1lcz86IG51bWJlcjtcclxuICAgIC8qKiDmm7/mjaLlsZ7mgKfnmoTlkI3np7AgKi9cclxuICAgIG5ld05hbWU/OiBzdHJpbmc7XHJcbiAgICAvKiog5bqf5byD5bGe5oCn55qE5omA5bGe5a+56LGhICovXHJcbiAgICB0YXJnZXQ/OiBvYmplY3Q7XHJcbiAgICAvKiog5bqf5byD5bGe5oCn55qE5omA5bGe5a+56LGh55qE5ZCN56ewICovXHJcbiAgICB0YXJnZXROYW1lPzogc3RyaW5nO1xyXG4gICAgLyoqIOiHquWumuS5ieabv+aNouWxnuaAp++8iOWHveaVsO+8iSAqL1xyXG4gICAgY3VzdG9tRnVuY3Rpb24/OiBGdW5jdGlvbjtcclxuICAgIC8qKiDoh6rlrprkuYnmm7/mjaLlsZ7mgKfnmoQgc2V0dGVyICovXHJcbiAgICBjdXN0b21TZXR0ZXI/OiAodjogYW55KSA9PiB2b2lkO1xyXG4gICAgLyoqIOiHquWumuS5ieabv+aNouWxnuaAp+eahCBnZXR0ZXIgKi9cclxuICAgIGN1c3RvbUdldHRlcj86ICgpID0+IGFueTtcclxufVxyXG5cclxuaW50ZXJmYWNlIElSZW1vdmVJdGVtIHtcclxuICAgIC8qKiDlup/lvIPlsZ7mgKfnmoTlkI3np7AgKi9cclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIC8qKiDorablkYrnmoTmrKHmlbAgKi9cclxuICAgIGxvZ1RpbWVzPzogbnVtYmVyO1xyXG4gICAgLyoqIOmineWkluW7uuiuriAqL1xyXG4gICAgc3VnZ2VzdD86IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIElNYXJrSXRlbSB7XHJcbiAgICAvKiog5bqf5byD5bGe5oCn55qE5ZCN56ewICovXHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAvKiog6K2m5ZGK55qE5qyh5pWwICovXHJcbiAgICBsb2dUaW1lcz86IG51bWJlcjtcclxuICAgIC8qKiDpop3lpJblu7rorq4gKi9cclxuICAgIHN1Z2dlc3Q/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBsZXQgcmVwbGFjZVByb3BlcnR5OiAob3duZXI6IG9iamVjdCwgb3duZXJOYW1lOiBzdHJpbmcsIHByb3BlcnRpZXM6IElSZXBsYWNlbWVudFtdKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGxldCByZW1vdmVQcm9wZXJ0eTogKG93bmVyOiBvYmplY3QsIG93bmVyTmFtZTogc3RyaW5nLCBwcm9wZXJ0aWVzOiBJUmVtb3ZlSXRlbVtdKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGxldCBtYXJrQXNXYXJuaW5nOiAob3duZXI6IG9iamVjdCwgb3duZXJOYW1lOiBzdHJpbmcsIHByb3BlcnRpZXM6IElNYXJrSXRlbVtdKSA9PiB2b2lkO1xyXG5cclxubGV0IHJlcGxhY2VQcm9wZXJ0eUxvZzogKG46IHN0cmluZywgZHA6IHN0cmluZywgbjI6IHN0cmluZywgbmV3cDogc3RyaW5nLCBmOiBGdW5jdGlvbiwgaWQ6IG51bWJlcikgPT4gdm9pZDtcclxuXHJcbmxldCBtYXJrQXNXYXJuaW5nTG9nOiAobjogc3RyaW5nLCBkcDogc3RyaW5nLCBmOiBGdW5jdGlvbiwgaWQ6IG51bWJlciwgcz86IHN0cmluZykgPT4gdm9pZDtcclxuXHJcbmxldCByZW1vdmVQcm9wZXJ0eUxvZzogKG46IHN0cmluZywgZHA6IHN0cmluZywgZjogRnVuY3Rpb24sIGlkOiBudW1iZXIsIHM/OiBzdHJpbmcpID0+IHZvaWQ7XHJcblxyXG4vLyBpZiAoREVCVUcpIHtcclxuXHJcbmludGVyZmFjZSBJTWVlc3NhZ2VJdGVtIHtcclxuICAgIGlkOiBSZWFkb25seTxudW1iZXI+O1xyXG4gICAgbG9nVGltZXM6IFJlYWRvbmx5PG51bWJlcj47XHJcbiAgICBjb3VudDogbnVtYmVyO1xyXG59XHJcblxyXG5sZXQgbWVzc2FnZUlEID0gMDtcclxuY29uc3QgbWVzc2FnZU1hcDogTWFwPG51bWJlciwgSU1lZXNzYWdlSXRlbT4gPSBuZXcgTWFwPG51bWJlciwgSU1lZXNzYWdlSXRlbT4oKTtcclxuXHJcbnJlcGxhY2VQcm9wZXJ0eUxvZyA9IChuOiBzdHJpbmcsIGRwOiBzdHJpbmcsIG4yOiBzdHJpbmcsIG5ld3A6IHN0cmluZywgZjogRnVuY3Rpb24sIGlkOiBudW1iZXIpID0+IHtcclxuICAgIGNvbnN0IGl0ZW0gPSBtZXNzYWdlTWFwLmdldChpZCk7XHJcbiAgICBpZiAoaXRlbSAmJiBpdGVtLmxvZ1RpbWVzID4gaXRlbS5jb3VudCkge1xyXG4gICAgICAgIGYoJ1xcJyVzXFwnIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgXFwnJXNcXCcgaW5zdGVhZC4nLCBgJHtufS4ke2RwfWAsIGAke24yfS4ke25ld3B9YCk7XHJcbiAgICAgICAgaXRlbS5jb3VudCsrO1xyXG4gICAgfVxyXG59O1xyXG5cclxucmVwbGFjZVByb3BlcnR5ID0gKG93bmVyOiBvYmplY3QsIG93bmVyTmFtZTogc3RyaW5nLCBwcm9wZXJ0aWVzOiBJUmVwbGFjZW1lbnRbXSkgPT4ge1xyXG4gICAgaWYgKG93bmVyID09IG51bGwpIHJldHVybjtcclxuXHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goKGl0ZW06IElSZXBsYWNlbWVudCkgPT4ge1xyXG5cclxuICAgICAgICBjb25zdCBpZCA9IG1lc3NhZ2VJRCsrO1xyXG4gICAgICAgIG1lc3NhZ2VNYXAuc2V0KGlkLCB7IGlkLCBjb3VudDogMCwgbG9nVGltZXM6IGl0ZW0ubG9nVGltZXMgIT09IHVuZGVmaW5lZCA/IGl0ZW0ubG9nVGltZXMgOiBkZWZhdWx0TG9nVGltZXMsIH0pO1xyXG5cclxuICAgICAgICBjb25zdCB0YXJnZXQgPSBpdGVtLnRhcmdldCAhPSBudWxsID8gaXRlbS50YXJnZXQgOiBvd25lcjtcclxuICAgICAgICBjb25zdCBuZXdOYW1lID0gaXRlbS5uZXdOYW1lICE9IG51bGwgPyBpdGVtLm5ld05hbWUgOiBpdGVtLm5hbWU7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0TmFtZSA9IGl0ZW0udGFyZ2V0TmFtZSAhPSBudWxsID8gaXRlbS50YXJnZXROYW1lIDogb3duZXJOYW1lO1xyXG4gICAgICAgIGNvbnN0IHNhbWVUYXJnZXQgPSB0YXJnZXQgPT0gb3duZXI7XHJcblxyXG4gICAgICAgIGlmIChpdGVtLmN1c3RvbUZ1bmN0aW9uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgb3duZXJbaXRlbS5uYW1lXSA9IGZ1bmN0aW9uICh0aGlzOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHJlcGxhY2VQcm9wZXJ0eUxvZyhvd25lck5hbWUsIGl0ZW0ubmFtZSwgdGFyZ2V0TmFtZSwgbmV3TmFtZSwgd2FybiwgaWQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uY3VzdG9tRnVuY3Rpb24hLmNhbGwodGhpcywgLi4uYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uY3VzdG9tU2V0dGVyICE9IG51bGwgfHwgaXRlbS5jdXN0b21HZXR0ZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb25zdCBoYXNTZXR0ZXIgPSBpdGVtLmN1c3RvbVNldHRlciAhPSBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBoYXNHZXR0ZXIgPSBpdGVtLmN1c3RvbUdldHRlciAhPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoaGFzU2V0dGVyICYmIGhhc0dldHRlcikge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG93bmVyLCBpdGVtLm5hbWUsIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXQgKHRoaXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVByb3BlcnR5TG9nKG93bmVyTmFtZSwgaXRlbS5uYW1lLCB0YXJnZXROYW1lLCBuZXdOYW1lLCB3YXJuLCBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmN1c3RvbUdldHRlciEuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHNldCAodGhpcywgdjogYW55KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VQcm9wZXJ0eUxvZyhvd25lck5hbWUsIGl0ZW0ubmFtZSwgdGFyZ2V0TmFtZSwgbmV3TmFtZSwgd2FybiwgaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmN1c3RvbVNldHRlciEuY2FsbCh0aGlzLCB2KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNTZXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgaXRlbS5uYW1lLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0ICh0aGlzLCB2OiBhbnkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVByb3BlcnR5TG9nKG93bmVyTmFtZSwgaXRlbS5uYW1lLCB0YXJnZXROYW1lLCBuZXdOYW1lLCB3YXJuLCBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3VzdG9tU2V0dGVyIS5jYWxsKHRoaXMsIHYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0dldHRlcikge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG93bmVyLCBpdGVtLm5hbWUsIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXQgKHRoaXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVByb3BlcnR5TG9nKG93bmVyTmFtZSwgaXRlbS5uYW1lLCB0YXJnZXROYW1lLCBuZXdOYW1lLCB3YXJuLCBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmN1c3RvbUdldHRlciEuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgaXRlbS5uYW1lLCB7XHJcbiAgICAgICAgICAgICAgICBnZXQgKHRoaXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXBsYWNlUHJvcGVydHlMb2cob3duZXJOYW1lLCBpdGVtLm5hbWUsIHRhcmdldE5hbWUsIG5ld05hbWUsIHdhcm4sIGlkKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2FtZVRhcmdldCA/IHRoaXNbbmV3TmFtZV0gOiB0YXJnZXRbbmV3TmFtZV07XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2V0ICh0aGlzLCB2OiBhbnkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXBsYWNlUHJvcGVydHlMb2cob3duZXJOYW1lLCBpdGVtLm5hbWUsIHRhcmdldE5hbWUsIG5ld05hbWUsIHdhcm4sIGlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2FtZVRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW25ld05hbWVdID0gdjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRbbmV3TmFtZV0gPSB2O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG59O1xyXG5cclxucmVtb3ZlUHJvcGVydHlMb2cgPSAobjogc3RyaW5nLCBkcDogc3RyaW5nLCBmOiBGdW5jdGlvbiwgaWQ6IG51bWJlciwgcz86IHN0cmluZykgPT4ge1xyXG4gICAgY29uc3QgaXRlbSA9IG1lc3NhZ2VNYXAuZ2V0KGlkKTtcclxuICAgIGNvbnN0IHNzID0gcyA9PT0gdW5kZWZpbmVkID8gJycgOiAnKCcgKyBzICsgJyknO1xyXG4gICAgaWYgKGl0ZW0gJiYgaXRlbS5sb2dUaW1lcyA+IGl0ZW0uY291bnQpIHtcclxuICAgICAgICBmKCdcXCclc1xcJyBoYXMgYmVlbiByZW1vdmVkLiAnICsgc3MsIGAke259LiR7ZHB9YCk7XHJcbiAgICAgICAgaXRlbS5jb3VudCsrO1xyXG4gICAgfVxyXG59O1xyXG5cclxucmVtb3ZlUHJvcGVydHkgPSAob3duZXI6IG9iamVjdCwgb3duZXJOYW1lOiBzdHJpbmcsIHByb3BlcnRpZXM6IElSZW1vdmVJdGVtW10pID0+IHtcclxuICAgIGlmIChvd25lciA9PSBudWxsKSByZXR1cm47XHJcblxyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKChpdGVtOiBJUmVtb3ZlSXRlbSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlkID0gbWVzc2FnZUlEKys7XHJcbiAgICAgICAgbWVzc2FnZU1hcC5zZXQoaWQsIHsgaWQsIGNvdW50OiAwLCBsb2dUaW1lczogaXRlbS5sb2dUaW1lcyAhPT0gdW5kZWZpbmVkID8gaXRlbS5sb2dUaW1lcyA6IGRlZmF1bHRMb2dUaW1lcywgfSk7XHJcblxyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgaXRlbS5uYW1lLCB7XHJcbiAgICAgICAgICAgIGdldCAodGhpcykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlbW92ZVByb3BlcnR5TG9nKG93bmVyTmFtZSwgaXRlbS5uYW1lLCBlcnJvciwgaWQsIGl0ZW0uc3VnZ2VzdCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldCAodGhpcykge1xyXG4gICAgICAgICAgICAgICAgcmVtb3ZlUHJvcGVydHlMb2cob3duZXJOYW1lLCBpdGVtLm5hbWUsIGVycm9yLCBpZCwgaXRlbS5zdWdnZXN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5tYXJrQXNXYXJuaW5nTG9nID0gKG46IHN0cmluZywgZHA6IHN0cmluZywgZjogRnVuY3Rpb24sIGlkOiBudW1iZXIsIHM/OiBzdHJpbmcpID0+IHtcclxuICAgIGNvbnN0IGl0ZW0gPSBtZXNzYWdlTWFwLmdldChpZCk7XHJcbiAgICBjb25zdCBzcyA9IHMgPT09IHVuZGVmaW5lZCA/ICcnIDogJygnICsgcyArICcpJztcclxuICAgIGlmIChpdGVtICYmIGl0ZW0ubG9nVGltZXMgPiBpdGVtLmNvdW50KSB7XHJcbiAgICAgICAgZignXFwnJXNcXCcgaXMgZGVwcmVjYXRlZC4gJyArIHNzLCBgJHtufS4ke2RwfWApO1xyXG4gICAgICAgIGl0ZW0uY291bnQrKztcclxuICAgIH1cclxufTtcclxuXHJcbm1hcmtBc1dhcm5pbmcgPSAob3duZXI6IG9iamVjdCwgb3duZXJOYW1lOiBzdHJpbmcsIHByb3BlcnRpZXM6IElNYXJrSXRlbVtdKSA9PiB7XHJcbiAgICBpZiAob3duZXIgPT0gbnVsbCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IF9kZWZhdWx0R2V0U2V0ID0gKGQ6IFByb3BlcnR5RGVzY3JpcHRvciwgbjogc3RyaW5nLCBkcDogc3RyaW5nLCBmOiBGdW5jdGlvbiwgaWQ6IG51bWJlciwgcz86IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmIChkLmdldCkge1xyXG4gICAgICAgICAgICBjb25zdCBvbGRHZXQgPSBkLmdldCgpO1xyXG4gICAgICAgICAgICBkLmdldCA9IGZ1bmN0aW9uICh0aGlzKSB7XHJcbiAgICAgICAgICAgICAgICBtYXJrQXNXYXJuaW5nTG9nKG4sIGRwLCBmLCBpZCwgcyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2xkR2V0LmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkLnNldCkge1xyXG4gICAgICAgICAgICBjb25zdCBvbGRTZXQgPSBPYmplY3QuY3JlYXRlKGQuc2V0KTtcclxuICAgICAgICAgICAgZC5zZXQgPSBmdW5jdGlvbiAodGhpcywgdjogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBtYXJrQXNXYXJuaW5nTG9nKG4sIGRwLCBmLCBpZCwgcyk7XHJcbiAgICAgICAgICAgICAgICBvbGRTZXQuY2FsbCh0aGlzLCB2KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaCgoaXRlbTogSU1hcmtJdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGVwcmVjYXRlZFByb3AgPSBpdGVtLm5hbWU7XHJcbiAgICAgICAgY29uc3QgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob3duZXIsIGRlcHJlY2F0ZWRQcm9wKTtcclxuICAgICAgICBpZiAoIWRlc2NyaXB0b3IpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICAgIGNvbnN0IGlkID0gbWVzc2FnZUlEKys7XHJcbiAgICAgICAgbWVzc2FnZU1hcC5zZXQoaWQsIHsgaWQsIGNvdW50OiAwLCBsb2dUaW1lczogaXRlbS5sb2dUaW1lcyAhPT0gdW5kZWZpbmVkID8gaXRlbS5sb2dUaW1lcyA6IGRlZmF1bHRMb2dUaW1lcywgfSk7XHJcblxyXG4gICAgICAgIGlmIChkZXNjcmlwdG9yLnZhbHVlICE9IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdG9yLnZhbHVlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IGRlc2NyaXB0b3IudmFsdWUgYXMgRnVuY3Rpb247XHJcbiAgICAgICAgICAgICAgICBvd25lcltkZXByZWNhdGVkUHJvcF0gPSBmdW5jdGlvbiAodGhpcykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcmtBc1dhcm5pbmdMb2cob3duZXJOYW1lLCBkZXByZWNhdGVkUHJvcCwgd2FybiwgaWQsIGl0ZW0uc3VnZ2VzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sZFZhbHVlLmNhbGwodGhpcywgLi4uYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfZGVmYXVsdEdldFNldChkZXNjcmlwdG9yLCBvd25lck5hbWUsIGRlcHJlY2F0ZWRQcm9wLCB3YXJuLCBpZCwgaXRlbS5zdWdnZXN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIF9kZWZhdWx0R2V0U2V0KGRlc2NyaXB0b3IsIG93bmVyTmFtZSwgZGVwcmVjYXRlZFByb3AsIHdhcm4sIGlkLCBpdGVtLnN1Z2dlc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuLy8gfSBlbHNlIHtcclxuLy8gICAgIC8vIGZvciBjb21wYXRpYmxlXHJcblxyXG4vLyAgICAgcmVwbGFjZVByb3BlcnR5ID0gKCkgPT4geyB9O1xyXG4vLyAgICAgcmVtb3ZlUHJvcGVydHkgPSAoKSA9PiB7IH07XHJcbi8vICAgICBtYXJrQXNXYXJuaW5nID0gKCkgPT4geyB9O1xyXG5cclxuLy8gICAgIHJlcGxhY2VQcm9wZXJ0eUxvZyA9ICgpID0+IHsgfTtcclxuLy8gICAgIHJlbW92ZVByb3BlcnR5TG9nID0gKCkgPT4geyB9O1xyXG4vLyAgICAgbWFya0FzV2FybmluZ0xvZyA9ICgpID0+IHsgfTtcclxuLy8gfVxyXG4iXX0=