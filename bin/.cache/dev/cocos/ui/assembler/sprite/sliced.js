(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../../core/math/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../../core/math/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index);
    global.sliced = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.sliced = void 0;

  /*
   Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.
  
   http://www.cocos.com
  
   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated engine source code (the "Software"), a limited,
   worldwide, royalty-free, non-assignable, revocable and non-exclusive license
   to use Cocos Creator solely to develop games on your target platforms. You shall
   not use Cocos Creator software for developing other software or tools that's
   used for developing games. You are not granted to publish, distribute,
   sublicense, and/or sell copies of Cocos Creator.
  
   The software or tools in this License Agreement are licensed, not sold.
   Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.
  
   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
  */

  /**
   * @category ui-assembler
   */
  var vec3_temp = new _index.Vec3();
  var matrix = new _index.Mat4();
  /**
   * sliced 组装器
   * 可通过 `UI.sliced` 获取该组装器。
   */

  var sliced = {
    useModel: false,
    createData: function createData(sprite) {
      var renderData = sprite.requestRenderData(); // 0-4 for local vertex
      // 5-20 for world vertex

      renderData.dataLength = 20;
      renderData.vertexCount = 16;
      renderData.indicesCount = 54;
      return renderData;
    },
    updateRenderData: function updateRenderData(sprite) {
      var frame = sprite.spriteFrame; // TODO: Material API design and export from editor could affect the material activation process
      // need to update the logic here
      // if (frame) {
      //     if (!frame._original && dynamicAtlasManager) {
      //         dynamicAtlasManager.insertSpriteFrame(frame);
      //     }
      //     if (sprite._material._texture !== frame._texture) {
      //         sprite._activateMaterial();
      //     }
      // }

      var renderData = sprite.renderData;

      if (renderData && frame) {
        var vertDirty = renderData.vertDirty;

        if (vertDirty) {
          this.updateVertexData(sprite);
          this.updateWorldVertexData(sprite);
        }
      }
    },
    updateVertexData: function updateVertexData(sprite) {
      var renderData = sprite.renderData;
      var dataList = renderData.data;
      var uiTrans = sprite.node._uiProps.uiTransformComp;
      var width = uiTrans.width;
      var height = uiTrans.height;
      var appX = uiTrans.anchorX * width;
      var appY = uiTrans.anchorY * height;
      var frame = sprite.spriteFrame;
      var leftWidth = frame.insetLeft;
      var rightWidth = frame.insetRight;
      var topHeight = frame.insetTop;
      var bottomHeight = frame.insetBottom;
      var sizableWidth = width - leftWidth - rightWidth;
      var sizableHeight = height - topHeight - bottomHeight;
      var xScale = width / (leftWidth + rightWidth);
      var yScale = height / (topHeight + bottomHeight);
      xScale = isNaN(xScale) || xScale > 1 ? 1 : xScale;
      yScale = isNaN(yScale) || yScale > 1 ? 1 : yScale;
      sizableWidth = sizableWidth < 0 ? 0 : sizableWidth;
      sizableHeight = sizableHeight < 0 ? 0 : sizableHeight;
      dataList[0].x = -appX;
      dataList[0].y = -appY;
      dataList[1].x = leftWidth * xScale - appX;
      dataList[1].y = bottomHeight * yScale - appY;
      dataList[2].x = dataList[1].x + sizableWidth;
      dataList[2].y = dataList[1].y + sizableHeight;
      dataList[3].x = width - appX;
      dataList[3].y = height - appY;
      renderData.vertDirty = false;
    },
    fillBuffers: function fillBuffers(sprite, renderer) {
      if (sprite.node.hasChangedFlags) {
        this.updateWorldVertexData(sprite);
      }

      var buffer = renderer.currBufferBatch;
      var renderData = sprite.renderData; // const node: Node = sprite.node;
      // const color: Color = sprite.color;

      var dataList = renderData.data;
      var vertexOffset = buffer.byteOffset >> 2;
      var vertexCount = renderData.vertexCount;
      var indicesOffset = buffer.indicesOffset;
      var vertexId = buffer.vertexOffset;
      var uvSliced = sprite.spriteFrame.uvSliced;
      var isRecreate = buffer.request(vertexCount, renderData.indicesCount);

      if (!isRecreate) {
        buffer = renderer.currBufferBatch;
        vertexOffset = 0;
        indicesOffset = 0;
        vertexId = 0;
      } // buffer data may be realloc, need get reference after request.


      var vBuf = buffer.vData; // const  uintbuf = buffer._uintVData,

      var iBuf = buffer.iData;

      for (var i = 4; i < 20; ++i) {
        var vert = dataList[i];
        var uvs = uvSliced[i - 4];
        vBuf[vertexOffset++] = vert.x;
        vBuf[vertexOffset++] = vert.y;
        vBuf[vertexOffset++] = vert.z;
        vBuf[vertexOffset++] = uvs.u;
        vBuf[vertexOffset++] = uvs.v;

        _index.Color.toArray(vBuf, sprite.color, vertexOffset);

        vertexOffset += 4; // uintbuf[vertexOffset++] = color;
      }

      for (var r = 0; r < 3; ++r) {
        for (var c = 0; c < 3; ++c) {
          var start = vertexId + r * 4 + c;
          iBuf[indicesOffset++] = start;
          iBuf[indicesOffset++] = start + 1;
          iBuf[indicesOffset++] = start + 4;
          iBuf[indicesOffset++] = start + 1;
          iBuf[indicesOffset++] = start + 5;
          iBuf[indicesOffset++] = start + 4;
        }
      }
    },
    updateWorldVertexData: function updateWorldVertexData(sprite) {
      var node = sprite.node;
      var dataList = sprite.renderData.data;
      node.getWorldMatrix(matrix);

      for (var row = 0; row < 4; ++row) {
        var rowD = dataList[row];

        for (var col = 0; col < 4; ++col) {
          var colD = dataList[col];
          var world = dataList[4 + row * 4 + col];

          _index.Vec3.set(vec3_temp, colD.x, rowD.y, 0);

          _index.Vec3.transformMat4(world, vec3_temp, matrix);
        }
      }
    }
  };
  _exports.sliced = sliced;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL3VpL2Fzc2VtYmxlci9zcHJpdGUvc2xpY2VkLnRzIl0sIm5hbWVzIjpbInZlYzNfdGVtcCIsIlZlYzMiLCJtYXRyaXgiLCJNYXQ0Iiwic2xpY2VkIiwidXNlTW9kZWwiLCJjcmVhdGVEYXRhIiwic3ByaXRlIiwicmVuZGVyRGF0YSIsInJlcXVlc3RSZW5kZXJEYXRhIiwiZGF0YUxlbmd0aCIsInZlcnRleENvdW50IiwiaW5kaWNlc0NvdW50IiwidXBkYXRlUmVuZGVyRGF0YSIsImZyYW1lIiwic3ByaXRlRnJhbWUiLCJ2ZXJ0RGlydHkiLCJ1cGRhdGVWZXJ0ZXhEYXRhIiwidXBkYXRlV29ybGRWZXJ0ZXhEYXRhIiwiZGF0YUxpc3QiLCJkYXRhIiwidWlUcmFucyIsIm5vZGUiLCJfdWlQcm9wcyIsInVpVHJhbnNmb3JtQ29tcCIsIndpZHRoIiwiaGVpZ2h0IiwiYXBwWCIsImFuY2hvclgiLCJhcHBZIiwiYW5jaG9yWSIsImxlZnRXaWR0aCIsImluc2V0TGVmdCIsInJpZ2h0V2lkdGgiLCJpbnNldFJpZ2h0IiwidG9wSGVpZ2h0IiwiaW5zZXRUb3AiLCJib3R0b21IZWlnaHQiLCJpbnNldEJvdHRvbSIsInNpemFibGVXaWR0aCIsInNpemFibGVIZWlnaHQiLCJ4U2NhbGUiLCJ5U2NhbGUiLCJpc05hTiIsIngiLCJ5IiwiZmlsbEJ1ZmZlcnMiLCJyZW5kZXJlciIsImhhc0NoYW5nZWRGbGFncyIsImJ1ZmZlciIsImN1cnJCdWZmZXJCYXRjaCIsInZlcnRleE9mZnNldCIsImJ5dGVPZmZzZXQiLCJpbmRpY2VzT2Zmc2V0IiwidmVydGV4SWQiLCJ1dlNsaWNlZCIsImlzUmVjcmVhdGUiLCJyZXF1ZXN0IiwidkJ1ZiIsInZEYXRhIiwiaUJ1ZiIsImlEYXRhIiwiaSIsInZlcnQiLCJ1dnMiLCJ6IiwidSIsInYiLCJDb2xvciIsInRvQXJyYXkiLCJjb2xvciIsInIiLCJjIiwic3RhcnQiLCJnZXRXb3JsZE1h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Iiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxyXG5cclxuIGh0dHA6Ly93d3cuY29jb3MuY29tXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiovXHJcblxyXG4vKipcclxuICogQGNhdGVnb3J5IHVpLWFzc2VtYmxlclxyXG4gKi9cclxuXHJcbmltcG9ydCB7IElVViwgU3ByaXRlRnJhbWUgfSBmcm9tICcuLi8uLi8uLi9jb3JlL2Fzc2V0cyc7XHJcbmltcG9ydCB7IENvbG9yLCBNYXQ0LCBWZWMzIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tYXRoJztcclxuaW1wb3J0IHsgSVJlbmRlckRhdGEsIFJlbmRlckRhdGEgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3JlbmRlcmVyL3VpL3JlbmRlci1kYXRhJztcclxuaW1wb3J0IHsgVUkgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3JlbmRlcmVyL3VpL3VpJztcclxuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSAnLi4vLi4vY29tcG9uZW50cyc7XHJcbmltcG9ydCB7IElBc3NlbWJsZXIgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3JlbmRlcmVyL3VpL2Jhc2UnO1xyXG5cclxuY29uc3QgdmVjM190ZW1wID0gbmV3IFZlYzMoKTtcclxuY29uc3QgbWF0cml4ID0gbmV3IE1hdDQoKTtcclxuXHJcbi8qKlxyXG4gKiBzbGljZWQg57uE6KOF5ZmoXHJcbiAqIOWPr+mAmui/hyBgVUkuc2xpY2VkYCDojrflj5bor6Xnu4Too4XlmajjgIJcclxuICovXHJcbmV4cG9ydCBjb25zdCBzbGljZWQ6IElBc3NlbWJsZXIgPSB7XHJcbiAgICB1c2VNb2RlbDogZmFsc2UsXHJcblxyXG4gICAgY3JlYXRlRGF0YSAoc3ByaXRlOiBTcHJpdGUpIHtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhOiBSZW5kZXJEYXRhIHwgbnVsbCA9IHNwcml0ZS5yZXF1ZXN0UmVuZGVyRGF0YSgpO1xyXG4gICAgICAgIC8vIDAtNCBmb3IgbG9jYWwgdmVydGV4XHJcbiAgICAgICAgLy8gNS0yMCBmb3Igd29ybGQgdmVydGV4XHJcbiAgICAgICAgcmVuZGVyRGF0YSEuZGF0YUxlbmd0aCA9IDIwO1xyXG5cclxuICAgICAgICByZW5kZXJEYXRhIS52ZXJ0ZXhDb3VudCA9IDE2O1xyXG4gICAgICAgIHJlbmRlckRhdGEhLmluZGljZXNDb3VudCA9IDU0O1xyXG4gICAgICAgIHJldHVybiByZW5kZXJEYXRhIGFzIFJlbmRlckRhdGE7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZVJlbmRlckRhdGEgKHNwcml0ZTogU3ByaXRlKSB7XHJcbiAgICAgICAgY29uc3QgZnJhbWUgPSBzcHJpdGUuc3ByaXRlRnJhbWU7XHJcblxyXG4gICAgICAgIC8vIFRPRE86IE1hdGVyaWFsIEFQSSBkZXNpZ24gYW5kIGV4cG9ydCBmcm9tIGVkaXRvciBjb3VsZCBhZmZlY3QgdGhlIG1hdGVyaWFsIGFjdGl2YXRpb24gcHJvY2Vzc1xyXG4gICAgICAgIC8vIG5lZWQgdG8gdXBkYXRlIHRoZSBsb2dpYyBoZXJlXHJcbiAgICAgICAgLy8gaWYgKGZyYW1lKSB7XHJcbiAgICAgICAgLy8gICAgIGlmICghZnJhbWUuX29yaWdpbmFsICYmIGR5bmFtaWNBdGxhc01hbmFnZXIpIHtcclxuICAgICAgICAvLyAgICAgICAgIGR5bmFtaWNBdGxhc01hbmFnZXIuaW5zZXJ0U3ByaXRlRnJhbWUoZnJhbWUpO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gICAgIGlmIChzcHJpdGUuX21hdGVyaWFsLl90ZXh0dXJlICE9PSBmcmFtZS5fdGV4dHVyZSkge1xyXG4gICAgICAgIC8vICAgICAgICAgc3ByaXRlLl9hY3RpdmF0ZU1hdGVyaWFsKCk7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlbmRlckRhdGEgPSBzcHJpdGUucmVuZGVyRGF0YTtcclxuICAgICAgICBpZiAocmVuZGVyRGF0YSAmJiBmcmFtZSkge1xyXG4gICAgICAgICAgICBjb25zdCB2ZXJ0RGlydHkgPSByZW5kZXJEYXRhLnZlcnREaXJ0eTtcclxuICAgICAgICAgICAgaWYgKHZlcnREaXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVWZXJ0ZXhEYXRhIShzcHJpdGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JsZFZlcnRleERhdGEhKHNwcml0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZVZlcnRleERhdGEgKHNwcml0ZTogU3ByaXRlKSB7XHJcbiAgICAgICAgY29uc3QgcmVuZGVyRGF0YTogUmVuZGVyRGF0YSB8IG51bGwgPSBzcHJpdGUucmVuZGVyRGF0YTtcclxuICAgICAgICBjb25zdCBkYXRhTGlzdDogSVJlbmRlckRhdGFbXSA9IHJlbmRlckRhdGEhLmRhdGE7XHJcbiAgICAgICAgY29uc3QgdWlUcmFucyA9IHNwcml0ZS5ub2RlLl91aVByb3BzLnVpVHJhbnNmb3JtQ29tcCE7XHJcbiAgICAgICAgY29uc3Qgd2lkdGggPSB1aVRyYW5zLndpZHRoITtcclxuICAgICAgICBjb25zdCBoZWlnaHQgPSB1aVRyYW5zLmhlaWdodCE7XHJcbiAgICAgICAgY29uc3QgYXBwWCA9IHVpVHJhbnMuYW5jaG9yWCEgKiB3aWR0aDtcclxuICAgICAgICBjb25zdCBhcHBZID0gdWlUcmFucy5hbmNob3JZISAqIGhlaWdodDtcclxuXHJcbiAgICAgICAgY29uc3QgZnJhbWU6IFNwcml0ZUZyYW1lfG51bGwgPSBzcHJpdGUuc3ByaXRlRnJhbWU7XHJcbiAgICAgICAgY29uc3QgbGVmdFdpZHRoID0gZnJhbWUhLmluc2V0TGVmdDtcclxuICAgICAgICBjb25zdCByaWdodFdpZHRoID0gZnJhbWUhLmluc2V0UmlnaHQ7XHJcbiAgICAgICAgY29uc3QgdG9wSGVpZ2h0ID0gZnJhbWUhLmluc2V0VG9wO1xyXG4gICAgICAgIGNvbnN0IGJvdHRvbUhlaWdodCA9IGZyYW1lIS5pbnNldEJvdHRvbTtcclxuXHJcbiAgICAgICAgbGV0IHNpemFibGVXaWR0aCA9IHdpZHRoIC0gbGVmdFdpZHRoIC0gcmlnaHRXaWR0aDtcclxuICAgICAgICBsZXQgc2l6YWJsZUhlaWdodCA9IGhlaWdodCAtIHRvcEhlaWdodCAtIGJvdHRvbUhlaWdodDtcclxuICAgICAgICBsZXQgeFNjYWxlID0gd2lkdGggLyAobGVmdFdpZHRoICsgcmlnaHRXaWR0aCk7XHJcbiAgICAgICAgbGV0IHlTY2FsZSA9IGhlaWdodCAvICh0b3BIZWlnaHQgKyBib3R0b21IZWlnaHQpO1xyXG4gICAgICAgIHhTY2FsZSA9IChpc05hTih4U2NhbGUpIHx8IHhTY2FsZSA+IDEpID8gMSA6IHhTY2FsZTtcclxuICAgICAgICB5U2NhbGUgPSAoaXNOYU4oeVNjYWxlKSB8fCB5U2NhbGUgPiAxKSA/IDEgOiB5U2NhbGU7XHJcbiAgICAgICAgc2l6YWJsZVdpZHRoID0gc2l6YWJsZVdpZHRoIDwgMCA/IDAgOiBzaXphYmxlV2lkdGg7XHJcbiAgICAgICAgc2l6YWJsZUhlaWdodCA9IHNpemFibGVIZWlnaHQgPCAwID8gMCA6IHNpemFibGVIZWlnaHQ7XHJcblxyXG4gICAgICAgIGRhdGFMaXN0WzBdLnggPSAtYXBwWDtcclxuICAgICAgICBkYXRhTGlzdFswXS55ID0gLWFwcFk7XHJcbiAgICAgICAgZGF0YUxpc3RbMV0ueCA9IGxlZnRXaWR0aCAqIHhTY2FsZSAtIGFwcFg7XHJcbiAgICAgICAgZGF0YUxpc3RbMV0ueSA9IGJvdHRvbUhlaWdodCAqIHlTY2FsZSAtIGFwcFk7XHJcbiAgICAgICAgZGF0YUxpc3RbMl0ueCA9IGRhdGFMaXN0WzFdLnggKyBzaXphYmxlV2lkdGg7XHJcbiAgICAgICAgZGF0YUxpc3RbMl0ueSA9IGRhdGFMaXN0WzFdLnkgKyBzaXphYmxlSGVpZ2h0O1xyXG4gICAgICAgIGRhdGFMaXN0WzNdLnggPSB3aWR0aCAtIGFwcFg7XHJcbiAgICAgICAgZGF0YUxpc3RbM10ueSA9IGhlaWdodCAtIGFwcFk7XHJcblxyXG4gICAgICAgIHJlbmRlckRhdGEhLnZlcnREaXJ0eSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBmaWxsQnVmZmVycyAoc3ByaXRlOiBTcHJpdGUsIHJlbmRlcmVyOiBVSSkge1xyXG4gICAgICAgIGlmIChzcHJpdGUubm9kZS5oYXNDaGFuZ2VkRmxhZ3MpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JsZFZlcnRleERhdGEoc3ByaXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBidWZmZXIgPSByZW5kZXJlci5jdXJyQnVmZmVyQmF0Y2ghO1xyXG4gICAgICAgIGNvbnN0IHJlbmRlckRhdGE6IFJlbmRlckRhdGF8bnVsbCA9IHNwcml0ZS5yZW5kZXJEYXRhO1xyXG4gICAgICAgIC8vIGNvbnN0IG5vZGU6IE5vZGUgPSBzcHJpdGUubm9kZTtcclxuICAgICAgICAvLyBjb25zdCBjb2xvcjogQ29sb3IgPSBzcHJpdGUuY29sb3I7XHJcbiAgICAgICAgY29uc3QgZGF0YUxpc3Q6IElSZW5kZXJEYXRhW10gPSByZW5kZXJEYXRhIS5kYXRhO1xyXG5cclxuICAgICAgICBsZXQgdmVydGV4T2Zmc2V0ID0gYnVmZmVyLmJ5dGVPZmZzZXQgPj4gMjtcclxuICAgICAgICBjb25zdCB2ZXJ0ZXhDb3VudCA9IHJlbmRlckRhdGEhLnZlcnRleENvdW50O1xyXG4gICAgICAgIGxldCBpbmRpY2VzT2Zmc2V0OiBudW1iZXIgPSBidWZmZXIuaW5kaWNlc09mZnNldDtcclxuICAgICAgICBsZXQgdmVydGV4SWQ6IG51bWJlciA9IGJ1ZmZlci52ZXJ0ZXhPZmZzZXQ7XHJcblxyXG4gICAgICAgIGNvbnN0IHV2U2xpY2VkOiBJVVZbXSA9IHNwcml0ZSEuc3ByaXRlRnJhbWUhLnV2U2xpY2VkO1xyXG5cclxuICAgICAgICBjb25zdCBpc1JlY3JlYXRlID0gYnVmZmVyLnJlcXVlc3QodmVydGV4Q291bnQsIHJlbmRlckRhdGEhLmluZGljZXNDb3VudCk7XHJcbiAgICAgICAgaWYgKCFpc1JlY3JlYXRlKSB7XHJcbiAgICAgICAgICAgIGJ1ZmZlciA9IHJlbmRlcmVyLmN1cnJCdWZmZXJCYXRjaCE7XHJcbiAgICAgICAgICAgIHZlcnRleE9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIGluZGljZXNPZmZzZXQgPSAwO1xyXG4gICAgICAgICAgICB2ZXJ0ZXhJZCA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBidWZmZXIgZGF0YSBtYXkgYmUgcmVhbGxvYywgbmVlZCBnZXQgcmVmZXJlbmNlIGFmdGVyIHJlcXVlc3QuXHJcbiAgICAgICAgY29uc3QgdkJ1ZjogRmxvYXQzMkFycmF5fG51bGwgPSBidWZmZXIudkRhdGE7XHJcbiAgICAgICAgLy8gY29uc3QgIHVpbnRidWYgPSBidWZmZXIuX3VpbnRWRGF0YSxcclxuICAgICAgICBjb25zdCBpQnVmOiBVaW50MTZBcnJheXxudWxsID0gYnVmZmVyLmlEYXRhO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gNDsgaSA8IDIwOyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3QgdmVydCA9IGRhdGFMaXN0W2ldO1xyXG4gICAgICAgICAgICBjb25zdCB1dnMgPSB1dlNsaWNlZFtpIC0gNF07XHJcblxyXG4gICAgICAgICAgICB2QnVmIVt2ZXJ0ZXhPZmZzZXQrK10gPSB2ZXJ0Lng7XHJcbiAgICAgICAgICAgIHZCdWYhW3ZlcnRleE9mZnNldCsrXSA9IHZlcnQueTtcclxuICAgICAgICAgICAgdkJ1ZiFbdmVydGV4T2Zmc2V0KytdID0gdmVydC56O1xyXG4gICAgICAgICAgICB2QnVmIVt2ZXJ0ZXhPZmZzZXQrK10gPSB1dnMudTtcclxuICAgICAgICAgICAgdkJ1ZiFbdmVydGV4T2Zmc2V0KytdID0gdXZzLnY7XHJcbiAgICAgICAgICAgIENvbG9yLnRvQXJyYXkodkJ1ZiEsIHNwcml0ZS5jb2xvciwgdmVydGV4T2Zmc2V0KTtcclxuICAgICAgICAgICAgdmVydGV4T2Zmc2V0ICs9IDQ7XHJcbiAgICAgICAgICAgIC8vIHVpbnRidWZbdmVydGV4T2Zmc2V0KytdID0gY29sb3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IDM7ICsrcikge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IDM7ICsrYykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSB2ZXJ0ZXhJZCArIHIgKiA0ICsgYztcclxuICAgICAgICAgICAgICAgIGlCdWYhW2luZGljZXNPZmZzZXQrK10gPSBzdGFydDtcclxuICAgICAgICAgICAgICAgIGlCdWYhW2luZGljZXNPZmZzZXQrK10gPSBzdGFydCArIDE7XHJcbiAgICAgICAgICAgICAgICBpQnVmIVtpbmRpY2VzT2Zmc2V0KytdID0gc3RhcnQgKyA0O1xyXG4gICAgICAgICAgICAgICAgaUJ1ZiFbaW5kaWNlc09mZnNldCsrXSA9IHN0YXJ0ICsgMTtcclxuICAgICAgICAgICAgICAgIGlCdWYhW2luZGljZXNPZmZzZXQrK10gPSBzdGFydCArIDU7XHJcbiAgICAgICAgICAgICAgICBpQnVmIVtpbmRpY2VzT2Zmc2V0KytdID0gc3RhcnQgKyA0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVXb3JsZFZlcnRleERhdGEgKHNwcml0ZTogU3ByaXRlKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IHNwcml0ZS5ub2RlO1xyXG4gICAgICAgIGNvbnN0IGRhdGFMaXN0OiBJUmVuZGVyRGF0YVtdID0gc3ByaXRlIS5yZW5kZXJEYXRhIS5kYXRhO1xyXG4gICAgICAgIG5vZGUuZ2V0V29ybGRNYXRyaXgobWF0cml4KTtcclxuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCA0OyArK3Jvdykge1xyXG4gICAgICAgICAgICBjb25zdCByb3dEID0gZGF0YUxpc3Rbcm93XTtcclxuICAgICAgICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgNDsgKytjb2wpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbEQgPSBkYXRhTGlzdFtjb2xdO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd29ybGQgPSBkYXRhTGlzdFs0ICsgcm93ICogNCArIGNvbF07XHJcblxyXG4gICAgICAgICAgICAgICAgVmVjMy5zZXQodmVjM190ZW1wLCBjb2xELngsIHJvd0QueSwgMCk7XHJcbiAgICAgICAgICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQod29ybGQsIHZlYzNfdGVtcCwgbWF0cml4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcbiJdfQ==