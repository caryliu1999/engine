(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../global-exports.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../global-exports.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.globalExports);
    global.bezier = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _globalExports) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.bezier = bezier;
  _exports.bezierByTime = bezierByTime;

  /**
   * @category animation
   */
  function bezier(C1, C2, C3, C4, t) {
    var t1 = 1 - t;
    return C1 * t1 * t1 * t1 + C2 * 3 * t1 * t1 * t + C3 * 3 * t1 * t * t + C4 * t * t * t;
  }

  _globalExports.legacyCC.bezier = bezier; // var sin = Math.sin;

  var cos = Math.cos;
  var acos = Math.acos;
  var max = Math.max; // var atan2 = Math.atan2;

  var pi = Math.PI;
  var tau = 2 * pi;
  var sqrt = Math.sqrt;

  function crt(v) {
    if (v < 0) {
      return -Math.pow(-v, 1 / 3);
    } else {
      return Math.pow(v, 1 / 3);
    }
  } // Modified from http://jsbin.com/yibipofeqi/1/edit, optimized for animations.
  // The origin Cardano's algorithm is based on http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm


  function cardano(curve, x) {
    // align curve with the intersecting line:
    // var line = {p1: {x: x, y: 0}, p2: {x: x, y: 1}};
    // var aligned = align(curve, line);
    //// and rewrite from [a(1-t)^3 + 3bt(1-t)^2 + 3c(1-t)t^2 + dt^3] form
    //    pa = aligned[0].y,
    //    pb = aligned[1].y,
    //    pc = aligned[2].y,
    //    pd = aligned[3].y;
    ////// curve = [{x:0, y:1}, {x: curve[0], y: 1-curve[1]}, {x: curve[2], y: 1-curve[3]}, {x:1, y:0}];
    var pa = x - 0;
    var pb = x - curve[0];
    var pc = x - curve[2];
    var pd = x - 1; // to [t^3 + at^2 + bt + c] form:

    var pa3 = pa * 3;
    var pb3 = pb * 3;
    var pc3 = pc * 3;
    var d = -pa + pb3 - pc3 + pd;
    var rd = 1 / d;
    var r3 = 1 / 3;
    var a = (pa3 - 6 * pb + pc3) * rd;
    var a3 = a * r3;
    var b = (-pa3 + pb3) * rd;
    var c = pa * rd; // then, determine p and q:

    var p = (3 * b - a * a) * r3;
    var p3 = p * r3;
    var q = (2 * a * a * a - 9 * a * b + 27 * c) / 27;
    var q2 = q / 2; // and determine the discriminant:

    var discriminant = q2 * q2 + p3 * p3 * p3; // and some reserved variables

    var u1;
    var v1;
    var x1;
    var x2;
    var x3; // If the discriminant is negative, use polar coordinates
    // to get around square roots of negative numbers

    if (discriminant < 0) {
      var mp3 = -p * r3;
      var mp33 = mp3 * mp3 * mp3;
      var r = sqrt(mp33); // compute cosphi corrected for IEEE float rounding:

      var t = -q / (2 * r);
      var cosphi = t < -1 ? -1 : t > 1 ? 1 : t;
      var phi = acos(cosphi);
      var crtr = crt(r);
      var t1 = 2 * crtr;
      x1 = t1 * cos(phi * r3) - a3;
      x2 = t1 * cos((phi + tau) * r3) - a3;
      x3 = t1 * cos((phi + 2 * tau) * r3) - a3; // choose best percentage

      if (0 <= x1 && x1 <= 1) {
        if (0 <= x2 && x2 <= 1) {
          if (0 <= x3 && x3 <= 1) {
            return max(x1, x2, x3);
          } else {
            return max(x1, x2);
          }
        } else if (0 <= x3 && x3 <= 1) {
          return max(x1, x3);
        } else {
          return x1;
        }
      } else {
        if (0 <= x2 && x2 <= 1) {
          if (0 <= x3 && x3 <= 1) {
            return max(x2, x3);
          } else {
            return x2;
          }
        } else {
          return x3;
        }
      }
    } else if (discriminant === 0) {
      u1 = q2 < 0 ? crt(-q2) : -crt(q2);
      x1 = 2 * u1 - a3;
      x2 = -u1 - a3; // choose best percentage

      if (0 <= x1 && x1 <= 1) {
        if (0 <= x2 && x2 <= 1) {
          return max(x1, x2);
        } else {
          return x1;
        }
      } else {
        return x2;
      }
    } // one real root, and two imaginary roots
    else {
        var sd = sqrt(discriminant);
        u1 = crt(-q2 + sd);
        v1 = crt(q2 + sd);
        x1 = u1 - v1 - a3;
        return x1;
      }
  }

  function bezierByTime(controlPoints, x) {
    var percent = cardano(controlPoints, x); // t

    var p0y = 0; // a

    var p1y = controlPoints[1]; // b

    var p2y = controlPoints[3]; // c

    var p3y = 1; // d

    var t1 = 1 - percent;
    return p0y * t1 * t1 * t1 + p1y * 3 * percent * t1 * t1 + p2y * 3 * percent * percent * t1 + p3y * percent * percent * percent;
  }

  _globalExports.legacyCC.bezierByTime = bezierByTime;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL2NvcmUvYW5pbWF0aW9uL2Jlemllci50cyJdLCJuYW1lcyI6WyJiZXppZXIiLCJDMSIsIkMyIiwiQzMiLCJDNCIsInQiLCJ0MSIsImxlZ2FjeUNDIiwiY29zIiwiTWF0aCIsImFjb3MiLCJtYXgiLCJwaSIsIlBJIiwidGF1Iiwic3FydCIsImNydCIsInYiLCJwb3ciLCJjYXJkYW5vIiwiY3VydmUiLCJ4IiwicGEiLCJwYiIsInBjIiwicGQiLCJwYTMiLCJwYjMiLCJwYzMiLCJkIiwicmQiLCJyMyIsImEiLCJhMyIsImIiLCJjIiwicCIsInAzIiwicSIsInEyIiwiZGlzY3JpbWluYW50IiwidTEiLCJ2MSIsIngxIiwieDIiLCJ4MyIsIm1wMyIsIm1wMzMiLCJyIiwiY29zcGhpIiwicGhpIiwiY3J0ciIsInNkIiwiYmV6aWVyQnlUaW1lIiwiY29udHJvbFBvaW50cyIsInBlcmNlbnQiLCJwMHkiLCJwMXkiLCJwMnkiLCJwM3kiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBOzs7QUFRTyxXQUFTQSxNQUFULENBQWlCQyxFQUFqQixFQUE2QkMsRUFBN0IsRUFBeUNDLEVBQXpDLEVBQXFEQyxFQUFyRCxFQUFpRUMsQ0FBakUsRUFBNEU7QUFDL0UsUUFBTUMsRUFBRSxHQUFHLElBQUlELENBQWY7QUFDQSxXQUFPSixFQUFFLEdBQUdLLEVBQUwsR0FBVUEsRUFBVixHQUFlQSxFQUFmLEdBQ0FKLEVBQUUsR0FBRyxDQUFMLEdBQVNJLEVBQVQsR0FBY0EsRUFBZCxHQUFtQkQsQ0FEbkIsR0FFQUYsRUFBRSxHQUFHLENBQUwsR0FBU0csRUFBVCxHQUFjRCxDQUFkLEdBQWtCQSxDQUZsQixHQUdBRCxFQUFFLEdBQUdDLENBQUwsR0FBU0EsQ0FBVCxHQUFhQSxDQUhwQjtBQUlIOztBQUNERSwwQkFBU1AsTUFBVCxHQUFrQkEsTUFBbEIsQyxDQUVBOztBQUNBLE1BQU1RLEdBQUcsR0FBR0Ms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YW5pbWF0aW9uXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgbGVnYWN5Q0MgfSBmcm9tICcuLi9nbG9iYWwtZXhwb3J0cyc7XHJcblxyXG5leHBvcnQgdHlwZSBCZXppZXJDb250cm9sUG9pbnRzID0gWyBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIgXTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBiZXppZXIgKEMxOiBudW1iZXIsIEMyOiBudW1iZXIsIEMzOiBudW1iZXIsIEM0OiBudW1iZXIsIHQ6IG51bWJlcikge1xyXG4gICAgY29uc3QgdDEgPSAxIC0gdDtcclxuICAgIHJldHVybiBDMSAqIHQxICogdDEgKiB0MSArXHJcbiAgICAgICAgICAgQzIgKiAzICogdDEgKiB0MSAqIHQgK1xyXG4gICAgICAgICAgIEMzICogMyAqIHQxICogdCAqIHQgK1xyXG4gICAgICAgICAgIEM0ICogdCAqIHQgKiB0O1xyXG59XHJcbmxlZ2FjeUNDLmJlemllciA9IGJlemllcjtcclxuXHJcbi8vIHZhciBzaW4gPSBNYXRoLnNpbjtcclxuY29uc3QgY29zID0gTWF0aC5jb3M7XHJcbmNvbnN0IGFjb3MgPSBNYXRoLmFjb3M7XHJcbmNvbnN0IG1heCA9IE1hdGgubWF4O1xyXG4vLyB2YXIgYXRhbjIgPSBNYXRoLmF0YW4yO1xyXG5jb25zdCBwaSA9IE1hdGguUEk7XHJcbmNvbnN0IHRhdSA9IDIgKiBwaTtcclxuY29uc3Qgc3FydCA9IE1hdGguc3FydDtcclxuXHJcbmZ1bmN0aW9uIGNydCAodjogbnVtYmVyKSB7XHJcbiAgICBpZiAodiA8IDApIHtcclxuICAgICAgICByZXR1cm4gLU1hdGgucG93KC12LCAxIC8gMyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5wb3codiwgMSAvIDMpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vLyBNb2RpZmllZCBmcm9tIGh0dHA6Ly9qc2Jpbi5jb20veWliaXBvZmVxaS8xL2VkaXQsIG9wdGltaXplZCBmb3IgYW5pbWF0aW9ucy5cclxuLy8gVGhlIG9yaWdpbiBDYXJkYW5vJ3MgYWxnb3JpdGhtIGlzIGJhc2VkIG9uIGh0dHA6Ly93d3cudHJhbnM0bWluZC5jb20vcGVyc29uYWxfZGV2ZWxvcG1lbnQvbWF0aGVtYXRpY3MvcG9seW5vbWlhbHMvY3ViaWNBbGdlYnJhLmh0bVxyXG5mdW5jdGlvbiBjYXJkYW5vIChjdXJ2ZTogQmV6aWVyQ29udHJvbFBvaW50cywgeDogbnVtYmVyKSB7XHJcbiAgICAvLyBhbGlnbiBjdXJ2ZSB3aXRoIHRoZSBpbnRlcnNlY3RpbmcgbGluZTpcclxuICAgICAgICAvLyB2YXIgbGluZSA9IHtwMToge3g6IHgsIHk6IDB9LCBwMjoge3g6IHgsIHk6IDF9fTtcclxuICAgICAgICAvLyB2YXIgYWxpZ25lZCA9IGFsaWduKGN1cnZlLCBsaW5lKTtcclxuICAgICAgICAvLy8vIGFuZCByZXdyaXRlIGZyb20gW2EoMS10KV4zICsgM2J0KDEtdCleMiArIDNjKDEtdCl0XjIgKyBkdF4zXSBmb3JtXHJcbiAgICAgICAgLy8gICAgcGEgPSBhbGlnbmVkWzBdLnksXHJcbiAgICAgICAgLy8gICAgcGIgPSBhbGlnbmVkWzFdLnksXHJcbiAgICAgICAgLy8gICAgcGMgPSBhbGlnbmVkWzJdLnksXHJcbiAgICAgICAgLy8gICAgcGQgPSBhbGlnbmVkWzNdLnk7XHJcbiAgICAgICAgLy8vLy8vIGN1cnZlID0gW3t4OjAsIHk6MX0sIHt4OiBjdXJ2ZVswXSwgeTogMS1jdXJ2ZVsxXX0sIHt4OiBjdXJ2ZVsyXSwgeTogMS1jdXJ2ZVszXX0sIHt4OjEsIHk6MH1dO1xyXG4gICAgY29uc3QgcGEgPSB4IC0gMDtcclxuICAgIGNvbnN0IHBiID0geCAtIGN1cnZlWzBdO1xyXG4gICAgY29uc3QgcGMgPSB4IC0gY3VydmVbMl07XHJcbiAgICBjb25zdCBwZCA9IHggLSAxO1xyXG5cclxuICAgIC8vIHRvIFt0XjMgKyBhdF4yICsgYnQgKyBjXSBmb3JtOlxyXG4gICAgY29uc3QgcGEzID0gcGEgKiAzO1xyXG4gICAgY29uc3QgcGIzID0gcGIgKiAzO1xyXG4gICAgY29uc3QgcGMzID0gcGMgKiAzO1xyXG4gICAgY29uc3QgZCA9ICgtcGEgKyBwYjMgLSBwYzMgKyBwZCk7XHJcbiAgICBjb25zdCByZCA9IDEgLyBkO1xyXG4gICAgY29uc3QgcjMgPSAxIC8gMztcclxuICAgIGNvbnN0IGEgPSAocGEzIC0gNiAqIHBiICsgcGMzKSAqIHJkO1xyXG4gICAgY29uc3QgYTMgPSBhICogcjM7XHJcbiAgICBjb25zdCBiID0gKC1wYTMgKyBwYjMpICogcmQ7XHJcbiAgICBjb25zdCBjID0gcGEgKiByZDtcclxuICAgIC8vIHRoZW4sIGRldGVybWluZSBwIGFuZCBxOlxyXG4gICAgY29uc3QgcCA9ICgzICogYiAtIGEgKiBhKSAqIHIzO1xyXG4gICAgY29uc3QgcDMgPSBwICogcjM7XHJcbiAgICBjb25zdCBxID0gKDIgKiBhICogYSAqIGEgLSA5ICogYSAqIGIgKyAyNyAqIGMpIC8gMjc7XHJcbiAgICBjb25zdCBxMiA9IHEgLyAyO1xyXG4gICAgLy8gYW5kIGRldGVybWluZSB0aGUgZGlzY3JpbWluYW50OlxyXG4gICAgY29uc3QgZGlzY3JpbWluYW50ID0gcTIgKiBxMiArIHAzICogcDMgKiBwMztcclxuICAgIC8vIGFuZCBzb21lIHJlc2VydmVkIHZhcmlhYmxlc1xyXG4gICAgbGV0IHUxO1xyXG4gICAgbGV0IHYxO1xyXG4gICAgbGV0IHgxO1xyXG4gICAgbGV0IHgyO1xyXG4gICAgbGV0IHgzO1xyXG5cclxuICAgIC8vIElmIHRoZSBkaXNjcmltaW5hbnQgaXMgbmVnYXRpdmUsIHVzZSBwb2xhciBjb29yZGluYXRlc1xyXG4gICAgLy8gdG8gZ2V0IGFyb3VuZCBzcXVhcmUgcm9vdHMgb2YgbmVnYXRpdmUgbnVtYmVyc1xyXG4gICAgaWYgKGRpc2NyaW1pbmFudCA8IDApIHtcclxuICAgICAgICBjb25zdCBtcDMgPSAtcCAqIHIzO1xyXG4gICAgICAgIGNvbnN0IG1wMzMgPSBtcDMgKiBtcDMgKiBtcDM7XHJcbiAgICAgICAgY29uc3QgciA9IHNxcnQobXAzMyk7XHJcbiAgICAgICAgLy8gY29tcHV0ZSBjb3NwaGkgY29ycmVjdGVkIGZvciBJRUVFIGZsb2F0IHJvdW5kaW5nOlxyXG4gICAgICAgIGNvbnN0IHQgPSAtcSAvICgyICogcik7XHJcbiAgICAgICAgY29uc3QgY29zcGhpID0gdCA8IC0xID8gLTEgOiB0ID4gMSA/IDEgOiB0O1xyXG4gICAgICAgIGNvbnN0IHBoaSA9IGFjb3MoY29zcGhpKTtcclxuICAgICAgICBjb25zdCBjcnRyID0gY3J0KHIpO1xyXG4gICAgICAgIGNvbnN0IHQxID0gMiAqIGNydHI7XHJcbiAgICAgICAgeDEgPSB0MSAqIGNvcyhwaGkgKiByMykgLSBhMztcclxuICAgICAgICB4MiA9IHQxICogY29zKChwaGkgKyB0YXUpICogcjMpIC0gYTM7XHJcbiAgICAgICAgeDMgPSB0MSAqIGNvcygocGhpICsgMiAqIHRhdSkgKiByMykgLSBhMztcclxuXHJcbiAgICAgICAgLy8gY2hvb3NlIGJlc3QgcGVyY2VudGFnZVxyXG4gICAgICAgIGlmICgwIDw9IHgxICYmIHgxIDw9IDEpIHtcclxuICAgICAgICAgICAgaWYgKDAgPD0geDIgJiYgeDIgPD0gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKDAgPD0geDMgJiYgeDMgPD0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXgoeDEsIHgyLCB4Myk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF4KHgxLCB4Mik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoMCA8PSB4MyAmJiB4MyA8PSAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF4KHgxLCB4Myk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICgwIDw9IHgyICYmIHgyIDw9IDEpIHtcclxuICAgICAgICAgICAgICAgIGlmICgwIDw9IHgzICYmIHgzIDw9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF4KHgyLCB4Myk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChkaXNjcmltaW5hbnQgPT09IDApIHtcclxuICAgICAgICB1MSA9IHEyIDwgMCA/IGNydCgtcTIpIDogLWNydChxMik7XHJcbiAgICAgICAgeDEgPSAyICogdTEgLSBhMztcclxuICAgICAgICB4MiA9IC11MSAtIGEzO1xyXG5cclxuICAgICAgICAvLyBjaG9vc2UgYmVzdCBwZXJjZW50YWdlXHJcbiAgICAgICAgaWYgKDAgPD0geDEgJiYgeDEgPD0gMSkge1xyXG4gICAgICAgICAgICBpZiAoMCA8PSB4MiAmJiB4MiA8PSAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF4KHgxLCB4Mik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB4MjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBvbmUgcmVhbCByb290LCBhbmQgdHdvIGltYWdpbmFyeSByb290c1xyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3Qgc2QgPSBzcXJ0KGRpc2NyaW1pbmFudCk7XHJcbiAgICAgICAgdTEgPSBjcnQoLXEyICsgc2QpO1xyXG4gICAgICAgIHYxID0gY3J0KHEyICsgc2QpO1xyXG4gICAgICAgIHgxID0gdTEgLSB2MSAtIGEzO1xyXG4gICAgICAgIHJldHVybiB4MTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJlemllckJ5VGltZSAoY29udHJvbFBvaW50czogQmV6aWVyQ29udHJvbFBvaW50cywgeDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBwZXJjZW50ID0gY2FyZGFubyhjb250cm9sUG9pbnRzLCB4KTsgICAgLy8gdFxyXG4gICAgY29uc3QgcDB5ID0gMDsgICAgICAgICAgICAgICAgLy8gYVxyXG4gICAgY29uc3QgcDF5ID0gY29udHJvbFBvaW50c1sxXTsgLy8gYlxyXG4gICAgY29uc3QgcDJ5ID0gY29udHJvbFBvaW50c1szXTsgLy8gY1xyXG4gICAgY29uc3QgcDN5ID0gMTsgICAgICAgICAgICAgICAgLy8gZFxyXG4gICAgY29uc3QgdDEgPSAxIC0gcGVyY2VudDtcclxuICAgIHJldHVybiBwMHkgKiB0MSAqIHQxICogdDEgK1xyXG4gICAgICAgICAgIHAxeSAqIDMgKiBwZXJjZW50ICogdDEgKiB0MSArXHJcbiAgICAgICAgICAgcDJ5ICogMyAqIHBlcmNlbnQgKiBwZXJjZW50ICogdDEgK1xyXG4gICAgICAgICAgIHAzeSAqIHBlcmNlbnQgKiBwZXJjZW50ICogcGVyY2VudDtcclxufVxyXG5sZWdhY3lDQy5iZXppZXJCeVRpbWUgPSBiZXppZXJCeVRpbWU7XHJcbiJdfQ==