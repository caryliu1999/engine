(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../math/index.js", "./enums.js", "./plane.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../math/index.js"), require("./enums.js"), require("./plane.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index, global.enums, global.plane);
    global.frustum = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index, _enums, _plane) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.frustum = void 0;
  _enums = _interopRequireDefault(_enums);
  _plane = _interopRequireDefault(_plane);

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  var _v = new Array(8);

  _v[0] = new _index.Vec3(1, 1, 1);
  _v[1] = new _index.Vec3(-1, 1, 1);
  _v[2] = new _index.Vec3(-1, -1, 1);
  _v[3] = new _index.Vec3(1, -1, 1);
  _v[4] = new _index.Vec3(1, 1, -1);
  _v[5] = new _index.Vec3(-1, 1, -1);
  _v[6] = new _index.Vec3(-1, -1, -1);
  _v[7] = new _index.Vec3(1, -1, -1);
  /**
   * @en
   * Basic Geometry: frustum.
   * @zh
   * 基础几何 截头锥体。
   */
  // tslint:disable-next-line: class-name

  var frustum = /*#__PURE__*/function () {
    _createClass(frustum, [{
      key: "accurate",

      /**
       * @en
       * Set whether to use accurate intersection testing function on this frustum.
       * @zh
       * 设置是否在此截锥体上使用精确的相交测试函数。
       */
      set: function set(b) {
        this._type = b ? _enums.default.SHAPE_FRUSTUM_ACCURATE : _enums.default.SHAPE_FRUSTUM;
      }
      /**
       * @en
       * Create a ortho frustum.
       * @zh
       * 创建一个正交视锥体。
       * @param out 正交视锥体。
       * @param width 正交视锥体的宽度。
       * @param height 正交视锥体的高度。
       * @param near 正交视锥体的近平面值。
       * @param far 正交视锥体的远平面值。
       * @param transform 正交视锥体的变换矩阵。
       * @return {frustum} frustum.
       */

    }, {
      key: "type",

      /**
       * @en
       * Gets the type of the shape.
       * @zh
       * 获取形状的类型。
       */
      get: function get() {
        return this._type;
      }
    }], [{
      key: "create",

      /**
       * @en
       * create a new frustum.
       * @zh
       * 创建一个新的截锥体。
       * @return {frustum} frustum.
       */
      value: function create() {
        return new frustum();
      }
      /**
       * @en
       * Clone a frustum.
       * @zh
       * 克隆一个截锥体。
       */

    }, {
      key: "clone",
      value: function clone(f) {
        return frustum.copy(new frustum(), f);
      }
      /**
       * @en
       * Copy the values from one frustum to another.
       * @zh
       * 从一个截锥体拷贝到另一个截锥体。
       */

    }, {
      key: "copy",
      value: function copy(out, f) {
        out._type = f._type;

        for (var i = 0; i < 6; ++i) {
          _plane.default.copy(out.planes[i], f.planes[i]);
        }

        for (var _i = 0; _i < 8; ++_i) {
          _index.Vec3.copy(out.vertices[_i], f.vertices[_i]);
        }

        return out;
      }
    }]);

    function frustum() {
      _classCallCheck(this, frustum);

      this._type = void 0;
      this.planes = void 0;
      this.vertices = void 0;
      this._type = _enums.default.SHAPE_FRUSTUM;
      this.planes = new Array(6);

      for (var i = 0; i < 6; ++i) {
        this.planes[i] = _plane.default.create(0, 0, 0, 0);
      }

      this.vertices = new Array(8);

      for (var _i2 = 0; _i2 < 8; ++_i2) {
        this.vertices[_i2] = new _index.Vec3();
      }
    }
    /**
     * @en
     * Update the frustum information according to the given transform matrix.
     * Note that the resulting planes are not normalized under normal mode.
     * @zh
     * 根据给定的变换矩阵更新截锥体信息，注意得到的平面不是在标准模式下归一化的。
     * @param {Mat4} m the view-projection matrix
     * @param {Mat4} inv the inverse view-projection matrix
     */


    _createClass(frustum, [{
      key: "update",
      value: function update(m, inv) {
        // RTR4, ch. 22.14.1, p. 983
        // extract frustum planes from view-proj matrix.
        // left plane
        _index.Vec3.set(this.planes[0].n, m.m03 + m.m00, m.m07 + m.m04, m.m11 + m.m08);

        this.planes[0].d = -(m.m15 + m.m12); // right plane

        _index.Vec3.set(this.planes[1].n, m.m03 - m.m00, m.m07 - m.m04, m.m11 - m.m08);

        this.planes[1].d = -(m.m15 - m.m12); // bottom plane

        _index.Vec3.set(this.planes[2].n, m.m03 + m.m01, m.m07 + m.m05, m.m11 + m.m09);

        this.planes[2].d = -(m.m15 + m.m13); // top plane

        _index.Vec3.set(this.planes[3].n, m.m03 - m.m01, m.m07 - m.m05, m.m11 - m.m09);

        this.planes[3].d = -(m.m15 - m.m13); // near plane

        _index.Vec3.set(this.planes[4].n, m.m03 + m.m02, m.m07 + m.m06, m.m11 + m.m10);

        this.planes[4].d = -(m.m15 + m.m14); // far plane

        _index.Vec3.set(this.planes[5].n, m.m03 - m.m02, m.m07 - m.m06, m.m11 - m.m10);

        this.planes[5].d = -(m.m15 - m.m14);

        if (this._type !== _enums.default.SHAPE_FRUSTUM_ACCURATE) {
          return;
        } // normalize planes


        for (var i = 0; i < 6; i++) {
          var pl = this.planes[i];
          var invDist = 1 / pl.n.length();

          _index.Vec3.multiplyScalar(pl.n, pl.n, invDist);

          pl.d *= invDist;
        } // update frustum vertices


        for (var _i3 = 0; _i3 < 8; _i3++) {
          _index.Vec3.transformMat4(this.vertices[_i3], _v[_i3], inv);
        }
      }
      /**
       * @en
       * Transform this frustum.
       * @zh
       * 变换此截锥体。
       * @param mat 变换矩阵。
       */

    }, {
      key: "transform",
      value: function transform(mat) {
        if (this._type !== _enums.default.SHAPE_FRUSTUM_ACCURATE) {
          return;
        }

        for (var i = 0; i < 8; i++) {
          _index.Vec3.transformMat4(this.vertices[i], this.vertices[i], mat);
        }

        _plane.default.fromPoints(this.planes[0], this.vertices[1], this.vertices[5], this.vertices[6]);

        _plane.default.fromPoints(this.planes[1], this.vertices[3], this.vertices[7], this.vertices[4]);

        _plane.default.fromPoints(this.planes[2], this.vertices[6], this.vertices[7], this.vertices[3]);

        _plane.default.fromPoints(this.planes[3], this.vertices[0], this.vertices[4], this.vertices[5]);

        _plane.default.fromPoints(this.planes[4], this.vertices[2], this.vertices[3], this.vertices[0]);

        _plane.default.fromPoints(this.planes[0], this.vertices[7], this.vertices[6], this.vertices[5]);
      }
    }]);

    return frustum;
  }();

  _exports.frustum = frustum;

  frustum.createOrtho = function () {
    var _temp_v3 = new _index.Vec3();

    return function (out, width, height, near, far, transform) {
      var halfWidth = width / 2;
      var halfHeight = height / 2;

      _index.Vec3.set(_temp_v3, halfWidth, halfHeight, near);

      _index.Vec3.transformMat4(out.vertices[0], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, -halfWidth, halfHeight, near);

      _index.Vec3.transformMat4(out.vertices[1], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, -halfWidth, -halfHeight, near);

      _index.Vec3.transformMat4(out.vertices[2], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, halfWidth, -halfHeight, near);

      _index.Vec3.transformMat4(out.vertices[3], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, halfWidth, halfHeight, far);

      _index.Vec3.transformMat4(out.vertices[4], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, -halfWidth, halfHeight, far);

      _index.Vec3.transformMat4(out.vertices[5], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, -halfWidth, -halfHeight, far);

      _index.Vec3.transformMat4(out.vertices[6], _temp_v3, transform);

      _index.Vec3.set(_temp_v3, halfWidth, -halfHeight, far);

      _index.Vec3.transformMat4(out.vertices[7], _temp_v3, transform);

      _plane.default.fromPoints(out.planes[0], out.vertices[1], out.vertices[6], out.vertices[5]);

      _plane.default.fromPoints(out.planes[1], out.vertices[3], out.vertices[4], out.vertices[7]);

      _plane.default.fromPoints(out.planes[2], out.vertices[6], out.vertices[3], out.vertices[7]);

      _plane.default.fromPoints(out.planes[3], out.vertices[0], out.vertices[5], out.vertices[4]);

      _plane.default.fromPoints(out.planes[4], out.vertices[2], out.vertices[0], out.vertices[3]);

      _plane.default.fromPoints(out.planes[0], out.vertices[7], out.vertices[5], out.vertices[6]);
    };
  }();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL2NvcmUvZ2VvbWV0cnkvZnJ1c3R1bS50cyJdLCJuYW1lcyI6WyJfdiIsIkFycmF5IiwiVmVjMyIsImZydXN0dW0iLCJiIiwiX3R5cGUiLCJlbnVtcyIsIlNIQVBFX0ZSVVNUVU1fQUNDVVJBVEUiLCJTSEFQRV9GUlVTVFVNIiwiZiIsImNvcHkiLCJvdXQiLCJpIiwicGxhbmUiLCJwbGFuZXMiLCJ2ZXJ0aWNlcyIsImNyZWF0ZSIsIm0iLCJpbnYiLCJzZXQiLCJuIiwibTAzIiwibTAwIiwibTA3IiwibTA0IiwibTExIiwibTA4IiwiZCIsIm0xNSIsIm0xMiIsIm0wMSIsIm0wNSIsIm0wOSIsIm0xMyIsIm0wMiIsIm0wNiIsIm0xMCIsIm0xNCIsInBsIiwiaW52RGlzdCIsImxlbmd0aCIsIm11bHRpcGx5U2NhbGFyIiwidHJhbnNmb3JtTWF0NCIsIm1hdCIsImZyb21Qb2ludHMiLCJjcmVhdGVPcnRobyIsIl90ZW1wX3YzIiwid2lkdGgiLCJoZWlnaHQiLCJuZWFyIiwiZmFyIiwidHJhbnNmb3JtIiwiaGFsZldpZHRoIiwiaGFsZkhlaWdodCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUUEsTUFBTUEsRUFBRSxHQUFHLElBQUlDLEtBQUosQ0FBVSxDQUFWLENBQVg7O0FBQ0FELEVBQUFBLEVBQUUsQ0FBQyxDQUFELENBQUYsR0FBUSxJQUFJRSxXQUFKLENBQVMsQ0FBVCxFQUFZLENBQVosRUFBZSxDQUFmLENBQVI7QUFDQUYsRUFBQUEsRUFBRSxDQUFDLENBQUQsQ0FBRixHQUFRLElBQUlFLFdBQUosQ0FBUyxDQUFDLENBQVYsRUFBYSxDQUFiLEVBQWdCLENBQWhCLENBQVI7QUFDQUYsRUFBQUEsRUFBRSxDQUFDLENBQUQsQ0FBRixHQUFRLElBQUlFLFdBQUosQ0FBUyxDQUFDLENBQVYsRUFBYSxDQUFDLENBQWQsRUFBaUIsQ0FBakIsQ0FBUjtBQUNBRixFQUFB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LEtBQUtHLFFBQUwsQ0FBY0gsQ0FBZCxDQUFyQyxFQUF1RCtCLEdBQXZEO0FBQ0g7O0FBQ0Q5Qix1QkFBTStCLFVBQU4sQ0FBaUIsS0FBSzlCLE1BQUwsQ0FBWSxDQUFaLENBQWpCLEVBQWlDLEtBQUtDLFFBQUwsQ0FBYyxDQUFkLENBQWpDLEVBQW1ELEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQW5ELEVBQXFFLEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQXJFOztBQUNBRix1QkFBTStCLFVBQU4sQ0FBaUIsS0FBSzlCLE1BQUwsQ0FBWSxDQUFaLENBQWpCLEVBQWlDLEtBQUtDLFFBQUwsQ0FBYyxDQUFkLENBQWpDLEVBQW1ELEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQW5ELEVBQXFFLEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQXJFOztBQUNBRix1QkFBTStCLFVBQU4sQ0FBaUIsS0FBSzlCLE1BQUwsQ0FBWSxDQUFaLENBQWpCLEVBQWlDLEtBQUtDLFFBQUwsQ0FBYyxDQUFkLENBQWpDLEVBQW1ELEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQW5ELEVBQXFFLEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQXJFOztBQUNBRix1QkFBTStCLFVBQU4sQ0FBaUIsS0FBSzlCLE1BQUwsQ0FBWSxDQUFaLENBQWpCLEVBQWlDLEtBQUtDLFFBQUwsQ0FBYyxDQUFkLENBQWpDLEVBQW1ELEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQW5ELEVBQXFFLEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQXJFOztBQUNBRix1QkFBTStCLFVBQU4sQ0FBaUIsS0FBSzlCLE1BQUwsQ0FBWSxDQUFaLENBQWpCLEVBQWlDLEtBQUtDLFFBQUwsQ0FBYyxDQUFkLENBQWpDLEVBQW1ELEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQW5ELEVBQXFFLEtBQUtBLFFBQUwsQ0FBYyxDQUFkLENBQXJFOztBQUNBRix1QkFBTStCLFVBQU4sQ0FBaUIsS0FBSzlCLE1BQUwsQ0FBWSxDQUFaLENBQWpCLEVBQWlDLEtBQUtDLFFBQUwsQ0FBYyxDQUFkLENBQWpD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UUFBSixDQUFhLENBQWIsQ0FBbEU7O0FBQ0FGLHFCQUFNK0IsVUFBTixDQUFpQmpDLEdBQUcsQ0FBQ0csTUFBSixDQUFXLENBQVgsQ0FBakIsRUFBZ0NILEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBaEMsRUFBaURKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBakQsRUFBa0VKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBbEU7O0FBQ0FGLHFCQUFNK0IsVUFBTixDQUFpQmpDLEdBQUcsQ0FBQ0csTUFBSixDQUFXLENBQVgsQ0FBakIsRUFBZ0NILEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBaEMsRUFBaURKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBakQsRUFBa0VKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBbEU7O0FBQ0FGLHFCQUFNK0IsVUFBTixDQUFpQmpDLEdBQUcsQ0FBQ0csTUFBSixDQUFXLENBQVgsQ0FBakIsRUFBZ0NILEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBaEMsRUFBaURKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBakQsRUFBa0VKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBbEU7O0FBQ0FGLHFCQUFNK0IsVUFBTixDQUFpQmpDLEdBQUcsQ0FBQ0csTUFBSixDQUFXLENBQVgsQ0FBakIsRUFBZ0NILEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBaEMsRUFBaURKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBakQsRUFBa0VKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBbEU7O0FBQ0FGLHFCQUFNK0IsVUFBTixDQUFpQmpDLEdBQUcsQ0FBQ0csTUFBSixDQUFXLENBQVgsQ0FBakIsRUFBZ0NILEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBaEMsRUFBaURKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBakQsRUFBa0VKLEdBQUcsQ0FBQ0ksUUFBSixDQUFhLENBQWIsQ0FBbEU7QUFDSCxLQTFCRDtBQTJCSCxHQTdCMkIsRSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAY2F0ZWdvcnkgZ2VvbWV0cnlcclxuICovXHJcblxyXG5pbXBvcnQgeyBNYXQ0LCBWZWMzIH0gZnJvbSAnLi4vbWF0aCc7XHJcbmltcG9ydCBlbnVtcyBmcm9tICcuL2VudW1zJztcclxuaW1wb3J0IHBsYW5lIGZyb20gJy4vcGxhbmUnO1xyXG5cclxuY29uc3QgX3YgPSBuZXcgQXJyYXkoOCk7XHJcbl92WzBdID0gbmV3IFZlYzMoMSwgMSwgMSk7XHJcbl92WzFdID0gbmV3IFZlYzMoLTEsIDEsIDEpO1xyXG5fdlsyXSA9IG5ldyBWZWMzKC0xLCAtMSwgMSk7XHJcbl92WzNdID0gbmV3IFZlYzMoMSwgLTEsIDEpO1xyXG5fdls0XSA9IG5ldyBWZWMzKDEsIDEsIC0xKTtcclxuX3ZbNV0gPSBuZXcgVmVjMygtMSwgMSwgLTEpO1xyXG5fdls2XSA9IG5ldyBWZWMzKC0xLCAtMSwgLTEpO1xyXG5fdls3XSA9IG5ldyBWZWMzKDEsIC0xLCAtMSk7XHJcblxyXG4vKipcclxuICogQGVuXHJcbiAqIEJhc2ljIEdlb21ldHJ5OiBmcnVzdHVtLlxyXG4gKiBAemhcclxuICog5Z+656GA5Yeg5L2VIOaIquWktOmUpeS9k+OAglxyXG4gKi9cclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBjbGFzcy1uYW1lXHJcbmV4cG9ydCBjbGFzcyBmcnVzdHVtIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogU2V0IHdoZXRoZXIgdG8gdXNlIGFjY3VyYXRlIGludGVyc2VjdGlvbiB0ZXN0aW5nIGZ1bmN0aW9uIG9uIHRoaXMgZnJ1c3R1bS5cclxuICAgICAqIEB6aFxyXG4gICAgICog6K6+572u5piv5ZCm5Zyo5q2k5oiq6ZSl5L2T5LiK5L2/55So57K+56Gu55qE55u45Lqk5rWL6K+V5Ye95pWw44CCXHJcbiAgICAgKi9cclxuICAgIHNldCBhY2N1cmF0ZSAoYjogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3R5cGUgPSBiID8gZW51bXMuU0hBUEVfRlJVU1RVTV9BQ0NVUkFURSA6IGVudW1zLlNIQVBFX0ZSVVNUVU07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZW5cclxuICAgICAqIENyZWF0ZSBhIG9ydGhvIGZydXN0dW0uXHJcbiAgICAgKiBAemhcclxuICAgICAqIOWIm+W7uuS4gOS4quato+S6pOinhumUpeS9k+OAglxyXG4gICAgICogQHBhcmFtIG91dCDmraPkuqTop4bplKXkvZPjgIJcclxuICAgICAqIEBwYXJhbSB3aWR0aCDmraPkuqTop4bplKXkvZPnmoTlrr3luqbjgIJcclxuICAgICAqIEBwYXJhbSBoZWlnaHQg5q2j5Lqk6KeG6ZSl5L2T55qE6auY5bqm44CCXHJcbiAgICAgKiBAcGFyYW0gbmVhciDmraPkuqTop4bplKXkvZPnmoTov5HlubPpnaLlgLzjgIJcclxuICAgICAqIEBwYXJhbSBmYXIg5q2j5Lqk6KeG6ZSl5L2T55qE6L+c5bmz6Z2i5YC844CCXHJcbiAgICAgKiBAcGFyYW0gdHJhbnNmb3JtIOato+S6pOinhumUpeS9k+eahOWPmOaNouefqemYteOAglxyXG4gICAgICogQHJldHVybiB7ZnJ1c3R1bX0gZnJ1c3R1bS5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVPcnRobyA9ICgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgX3RlbXBfdjMgPSBuZXcgVmVjMygpO1xyXG4gICAgICAgIHJldHVybiAob3V0OiBmcnVzdHVtLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgbmVhcjogbnVtYmVyLCBmYXI6IG51bWJlciwgdHJhbnNmb3JtOiBNYXQ0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhbGZXaWR0aCA9IHdpZHRoIC8gMjtcclxuICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IGhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIFZlYzMuc2V0KF90ZW1wX3YzLCBoYWxmV2lkdGgsIGhhbGZIZWlnaHQsIG5lYXIpO1xyXG4gICAgICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQob3V0LnZlcnRpY2VzWzBdLCBfdGVtcF92MywgdHJhbnNmb3JtKTtcclxuICAgICAgICAgICAgVmVjMy5zZXQoX3RlbXBfdjMsIC1oYWxmV2lkdGgsIGhhbGZIZWlnaHQsIG5lYXIpO1xyXG4gICAgICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQob3V0LnZlcnRpY2VzWzFdLCBfdGVtcF92MywgdHJhbnNmb3JtKTtcclxuICAgICAgICAgICAgVmVjMy5zZXQoX3RlbXBfdjMsIC1oYWxmV2lkdGgsIC1oYWxmSGVpZ2h0LCBuZWFyKTtcclxuICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KG91dC52ZXJ0aWNlc1syXSwgX3RlbXBfdjMsIHRyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgIFZlYzMuc2V0KF90ZW1wX3YzLCBoYWxmV2lkdGgsIC1oYWxmSGVpZ2h0LCBuZWFyKTtcclxuICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KG91dC52ZXJ0aWNlc1szXSwgX3RlbXBfdjMsIHRyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgIFZlYzMuc2V0KF90ZW1wX3YzLCBoYWxmV2lkdGgsIGhhbGZIZWlnaHQsIGZhcik7XHJcbiAgICAgICAgICAgIFZlYzMudHJhbnNmb3JtTWF0NChvdXQudmVydGljZXNbNF0sIF90ZW1wX3YzLCB0cmFuc2Zvcm0pO1xyXG4gICAgICAgICAgICBWZWMzLnNldChfdGVtcF92MywgLWhhbGZXaWR0aCwgaGFsZkhlaWdodCwgZmFyKTtcclxuICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KG91dC52ZXJ0aWNlc1s1XSwgX3RlbXBfdjMsIHRyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgIFZlYzMuc2V0KF90ZW1wX3YzLCAtaGFsZldpZHRoLCAtaGFsZkhlaWdodCwgZmFyKTtcclxuICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KG91dC52ZXJ0aWNlc1s2XSwgX3RlbXBfdjMsIHRyYW5zZm9ybSk7XHJcbiAgICAgICAgICAgIFZlYzMuc2V0KF90ZW1wX3YzLCBoYWxmV2lkdGgsIC1oYWxmSGVpZ2h0LCBmYXIpO1xyXG4gICAgICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQob3V0LnZlcnRpY2VzWzddLCBfdGVtcF92MywgdHJhbnNmb3JtKTtcclxuXHJcbiAgICAgICAgICAgIHBsYW5lLmZyb21Qb2ludHMob3V0LnBsYW5lc1swXSwgb3V0LnZlcnRpY2VzWzFdLCBvdXQudmVydGljZXNbNl0sIG91dC52ZXJ0aWNlc1s1XSk7XHJcbiAgICAgICAgICAgIHBsYW5lLmZyb21Qb2ludHMob3V0LnBsYW5lc1sxXSwgb3V0LnZlcnRpY2VzWzNdLCBvdXQudmVydGljZXNbNF0sIG91dC52ZXJ0aWNlc1s3XSk7XHJcbiAgICAgICAgICAgIHBsYW5lLmZyb21Qb2ludHMob3V0LnBsYW5lc1syXSwgb3V0LnZlcnRpY2VzWzZdLCBvdXQudmVydGljZXNbM10sIG91dC52ZXJ0aWNlc1s3XSk7XHJcbiAgICAgICAgICAgIHBsYW5lLmZyb21Qb2ludHMob3V0LnBsYW5lc1szXSwgb3V0LnZlcnRpY2VzWzBdLCBvdXQudmVydGljZXNbNV0sIG91dC52ZXJ0aWNlc1s0XSk7XHJcbiAgICAgICAgICAgIHBsYW5lLmZyb21Qb2ludHMob3V0LnBsYW5lc1s0XSwgb3V0LnZlcnRpY2VzWzJdLCBvdXQudmVydGljZXNbMF0sIG91dC52ZXJ0aWNlc1szXSk7XHJcbiAgICAgICAgICAgIHBsYW5lLmZyb21Qb2ludHMob3V0LnBsYW5lc1swXSwgb3V0LnZlcnRpY2VzWzddLCBvdXQudmVydGljZXNbNV0sIG91dC52ZXJ0aWNlc1s2XSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pKCk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZW5cclxuICAgICAqIGNyZWF0ZSBhIG5ldyBmcnVzdHVtLlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDliJvlu7rkuIDkuKrmlrDnmoTmiKrplKXkvZPjgIJcclxuICAgICAqIEByZXR1cm4ge2ZydXN0dW19IGZydXN0dW0uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlICgpOiBmcnVzdHVtIHtcclxuICAgICAgICByZXR1cm4gbmV3IGZydXN0dW0oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogQ2xvbmUgYSBmcnVzdHVtLlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDlhYvpmobkuIDkuKrmiKrplKXkvZPjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBjbG9uZSAoZjogZnJ1c3R1bSk6IGZydXN0dW0ge1xyXG4gICAgICAgIHJldHVybiBmcnVzdHVtLmNvcHkobmV3IGZydXN0dW0oKSwgZik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZW5cclxuICAgICAqIENvcHkgdGhlIHZhbHVlcyBmcm9tIG9uZSBmcnVzdHVtIHRvIGFub3RoZXIuXHJcbiAgICAgKiBAemhcclxuICAgICAqIOS7juS4gOS4quaIqumUpeS9k+aLt+i0neWIsOWPpuS4gOS4quaIqumUpeS9k+OAglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGNvcHkgKG91dDogZnJ1c3R1bSwgZjogZnJ1c3R1bSk6IGZydXN0dW0ge1xyXG4gICAgICAgIG91dC5fdHlwZSA9IGYuX3R5cGU7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyArK2kpIHtcclxuICAgICAgICAgICAgcGxhbmUuY29weShvdXQucGxhbmVzW2ldLCBmLnBsYW5lc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgKytpKSB7XHJcbiAgICAgICAgICAgIFZlYzMuY29weShvdXQudmVydGljZXNbaV0sIGYudmVydGljZXNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gb3V0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBHZXRzIHRoZSB0eXBlIG9mIHRoZSBzaGFwZS5cclxuICAgICAqIEB6aFxyXG4gICAgICog6I635Y+W5b2i54q255qE57G75Z6L44CCXHJcbiAgICAgKi9cclxuICAgIGdldCB0eXBlICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX3R5cGU6IG51bWJlcjtcclxuXHJcbiAgICBwdWJsaWMgcGxhbmVzOiBwbGFuZVtdO1xyXG4gICAgcHVibGljIHZlcnRpY2VzOiBWZWMzW107XHJcblxyXG4gICAgY29uc3RydWN0b3IgKCkge1xyXG4gICAgICAgIHRoaXMuX3R5cGUgPSBlbnVtcy5TSEFQRV9GUlVTVFVNO1xyXG4gICAgICAgIHRoaXMucGxhbmVzID0gbmV3IEFycmF5KDYpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgKytpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGxhbmVzW2ldID0gcGxhbmUuY3JlYXRlKDAsIDAsIDAsIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZlcnRpY2VzID0gbmV3IEFycmF5KDgpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgKytpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmVydGljZXNbaV0gPSBuZXcgVmVjMygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBlblxyXG4gICAgICogVXBkYXRlIHRoZSBmcnVzdHVtIGluZm9ybWF0aW9uIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gdHJhbnNmb3JtIG1hdHJpeC5cclxuICAgICAqIE5vdGUgdGhhdCB0aGUgcmVzdWx0aW5nIHBsYW5lcyBhcmUgbm90IG5vcm1hbGl6ZWQgdW5kZXIgbm9ybWFsIG1vZGUuXHJcbiAgICAgKiBAemhcclxuICAgICAqIOagueaNrue7meWumueahOWPmOaNouefqemYteabtOaWsOaIqumUpeS9k+S/oeaBr++8jOazqOaEj+W+l+WIsOeahOW5s+mdouS4jeaYr+WcqOagh+WHhuaooeW8j+S4i+W9kuS4gOWMlueahOOAglxyXG4gICAgICogQHBhcmFtIHtNYXQ0fSBtIHRoZSB2aWV3LXByb2plY3Rpb24gbWF0cml4XHJcbiAgICAgKiBAcGFyYW0ge01hdDR9IGludiB0aGUgaW52ZXJzZSB2aWV3LXByb2plY3Rpb24gbWF0cml4XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB1cGRhdGUgKG06IE1hdDQsIGludjogTWF0NCkge1xyXG4gICAgICAgIC8vIFJUUjQsIGNoLiAyMi4xNC4xLCBwLiA5ODNcclxuICAgICAgICAvLyBleHRyYWN0IGZydXN0dW0gcGxhbmVzIGZyb20gdmlldy1wcm9qIG1hdHJpeC5cclxuXHJcbiAgICAgICAgLy8gbGVmdCBwbGFuZVxyXG4gICAgICAgIFZlYzMuc2V0KHRoaXMucGxhbmVzWzBdLm4sIG0ubTAzICsgbS5tMDAsIG0ubTA3ICsgbS5tMDQsIG0ubTExICsgbS5tMDgpO1xyXG4gICAgICAgIHRoaXMucGxhbmVzWzBdLmQgPSAtKG0ubTE1ICsgbS5tMTIpO1xyXG4gICAgICAgIC8vIHJpZ2h0IHBsYW5lXHJcbiAgICAgICAgVmVjMy5zZXQodGhpcy5wbGFuZXNbMV0ubiwgbS5tMDMgLSBtLm0wMCwgbS5tMDcgLSBtLm0wNCwgbS5tMTEgLSBtLm0wOCk7XHJcbiAgICAgICAgdGhpcy5wbGFuZXNbMV0uZCA9IC0obS5tMTUgLSBtLm0xMik7XHJcbiAgICAgICAgLy8gYm90dG9tIHBsYW5lXHJcbiAgICAgICAgVmVjMy5zZXQodGhpcy5wbGFuZXNbMl0ubiwgbS5tMDMgKyBtLm0wMSwgbS5tMDcgKyBtLm0wNSwgbS5tMTEgKyBtLm0wOSk7XHJcbiAgICAgICAgdGhpcy5wbGFuZXNbMl0uZCA9IC0obS5tMTUgKyBtLm0xMyk7XHJcbiAgICAgICAgLy8gdG9wIHBsYW5lXHJcbiAgICAgICAgVmVjMy5zZXQodGhpcy5wbGFuZXNbM10ubiwgbS5tMDMgLSBtLm0wMSwgbS5tMDcgLSBtLm0wNSwgbS5tMTEgLSBtLm0wOSk7XHJcbiAgICAgICAgdGhpcy5wbGFuZXNbM10uZCA9IC0obS5tMTUgLSBtLm0xMyk7XHJcbiAgICAgICAgLy8gbmVhciBwbGFuZVxyXG4gICAgICAgIFZlYzMuc2V0KHRoaXMucGxhbmVzWzRdLm4sIG0ubTAzICsgbS5tMDIsIG0ubTA3ICsgbS5tMDYsIG0ubTExICsgbS5tMTApO1xyXG4gICAgICAgIHRoaXMucGxhbmVzWzRdLmQgPSAtKG0ubTE1ICsgbS5tMTQpO1xyXG4gICAgICAgIC8vIGZhciBwbGFuZVxyXG4gICAgICAgIFZlYzMuc2V0KHRoaXMucGxhbmVzWzVdLm4sIG0ubTAzIC0gbS5tMDIsIG0ubTA3IC0gbS5tMDYsIG0ubTExIC0gbS5tMTApO1xyXG4gICAgICAgIHRoaXMucGxhbmVzWzVdLmQgPSAtKG0ubTE1IC0gbS5tMTQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fdHlwZSAhPT0gZW51bXMuU0hBUEVfRlJVU1RVTV9BQ0NVUkFURSkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgLy8gbm9ybWFsaXplIHBsYW5lc1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBsID0gdGhpcy5wbGFuZXNbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IGludkRpc3QgPSAxIC8gcGwubi5sZW5ndGgoKTtcclxuICAgICAgICAgICAgVmVjMy5tdWx0aXBseVNjYWxhcihwbC5uLCBwbC5uLCBpbnZEaXN0KTtcclxuICAgICAgICAgICAgcGwuZCAqPSBpbnZEaXN0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdXBkYXRlIGZydXN0dW0gdmVydGljZXNcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykge1xyXG4gICAgICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQodGhpcy52ZXJ0aWNlc1tpXSwgX3ZbaV0sIGludik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGVuXHJcbiAgICAgKiBUcmFuc2Zvcm0gdGhpcyBmcnVzdHVtLlxyXG4gICAgICogQHpoXHJcbiAgICAgKiDlj5jmjaLmraTmiKrplKXkvZPjgIJcclxuICAgICAqIEBwYXJhbSBtYXQg5Y+Y5o2i55+p6Zi144CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0cmFuc2Zvcm0gKG1hdDogTWF0NCkge1xyXG4gICAgICAgIGlmICh0aGlzLl90eXBlICE9PSBlbnVtcy5TSEFQRV9GUlVTVFVNX0FDQ1VSQVRFKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHtcclxuICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KHRoaXMudmVydGljZXNbaV0sIHRoaXMudmVydGljZXNbaV0sIG1hdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBsYW5lLmZyb21Qb2ludHModGhpcy5wbGFuZXNbMF0sIHRoaXMudmVydGljZXNbMV0sIHRoaXMudmVydGljZXNbNV0sIHRoaXMudmVydGljZXNbNl0pO1xyXG4gICAgICAgIHBsYW5lLmZyb21Qb2ludHModGhpcy5wbGFuZXNbMV0sIHRoaXMudmVydGljZXNbM10sIHRoaXMudmVydGljZXNbN10sIHRoaXMudmVydGljZXNbNF0pO1xyXG4gICAgICAgIHBsYW5lLmZyb21Qb2ludHModGhpcy5wbGFuZXNbMl0sIHRoaXMudmVydGljZXNbNl0sIHRoaXMudmVydGljZXNbN10sIHRoaXMudmVydGljZXNbM10pO1xyXG4gICAgICAgIHBsYW5lLmZyb21Qb2ludHModGhpcy5wbGFuZXNbM10sIHRoaXMudmVydGljZXNbMF0sIHRoaXMudmVydGljZXNbNF0sIHRoaXMudmVydGljZXNbNV0pO1xyXG4gICAgICAgIHBsYW5lLmZyb21Qb2ludHModGhpcy5wbGFuZXNbNF0sIHRoaXMudmVydGljZXNbMl0sIHRoaXMudmVydGljZXNbM10sIHRoaXMudmVydGljZXNbMF0pO1xyXG4gICAgICAgIHBsYW5lLmZyb21Qb2ludHModGhpcy5wbGFuZXNbMF0sIHRoaXMudmVydGljZXNbN10sIHRoaXMudmVydGljZXNbNl0sIHRoaXMudmVydGljZXNbNV0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==