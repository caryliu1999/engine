(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "./ammo-instantiated.js", "../../core/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("./ammo-instantiated.js"), require("../../core/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.ammoInstantiated, global.index);
    global.ammoUtil = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _ammoInstantiated, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.cocos2AmmoVec3 = cocos2AmmoVec3;
  _exports.ammo2CocosVec3 = ammo2CocosVec3;
  _exports.cocos2AmmoQuat = cocos2AmmoQuat;
  _exports.ammo2CocosQuat = ammo2CocosQuat;
  _exports.ammoDeletePtr = ammoDeletePtr;
  _exports.cocos2AmmoTriMesh = cocos2AmmoTriMesh;
  _ammoInstantiated = _interopRequireDefault(_ammoInstantiated);

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

  function cocos2AmmoVec3(out, v) {
    out.setValue(v.x, v.y, v.z);
    return out;
  }

  function ammo2CocosVec3(out, v) {
    out.x = v.x();
    out.y = v.y();
    out.z = v.z();
    return out;
  }

  function cocos2AmmoQuat(out, q) {
    out.setValue(q.x, q.y, q.z, q.w);
    return out;
  }

  function ammo2CocosQuat(out, q) {
    out.x = q.x();
    out.y = q.y();
    out.z = q.z();
    out.w = q.w();
    return out;
  }

  function ammoDeletePtr(obj, klass) {
    delete klass.__cache__[obj.ptr];
  } // TODO : Ammo['deletePtr'] = deletePtr;


  function cocos2AmmoTriMesh(out, mesh) {
    var len = mesh.renderingSubMeshes.length;

    for (var i = 0; i < len; i++) {
      var subMesh = mesh.renderingSubMeshes[i];
      var geoInfo = subMesh.geometricInfo;

      if (geoInfo) {
        var primitiveMode = subMesh.primitiveMode;
        var vb = geoInfo.positions;
        var ib = geoInfo.indices;

        if (primitiveMode == _index.GFXPrimitiveMode.TRIANGLE_LIST) {
          var cnt = ib.length;

          for (var j = 0; j < cnt; j += 3) {
            var i0 = ib[j] * 3;
            var i1 = ib[j + 1] * 3;
            var i2 = ib[j + 2] * 3;
            var v0 = new _ammoInstantiated.default.btVector3(vb[i0], vb[i0 + 1], vb[i0 + 2]);
            var v1 = new _ammoInstantiated.default.btVector3(vb[i1], vb[i1 + 1], vb[i1 + 2]);
            var v2 = new _ammoInstantiated.default.btVector3(vb[i2], vb[i2 + 1], vb[i2 + 2]);
            out.addTriangle(v0, v1, v2);

            _ammoInstantiated.default.destroy(v0);

            _ammoInstantiated.default.destroy(v1);

            _ammoInstantiated.default.destroy(v2);
          }
        } else if (primitiveMode == _index.GFXPrimitiveMode.TRIANGLE_STRIP) {
          var _cnt = ib.length - 2;

          var rev = 0;

          for (var _j = 0; _j < _cnt; _j += 1) {
            var _i = ib[_j - rev] * 3;

            var _i2 = ib[_j + rev + 1] * 3;

            var _i3 = ib[_j + 2] * 3;

            var _v = new _ammoInstantiated.default.btVector3(vb[_i], vb[_i + 1], vb[_i + 2]);

            var _v2 = new _ammoInstantiated.default.btVector3(vb[_i2], vb[_i2 + 1], vb[_i2 + 2]);

            var _v3 = new _ammoInstantiated.default.btVector3(vb[_i3], vb[_i3 + 1], vb[_i3 + 2]);

            out.addTriangle(_v, _v2, _v3);

            _ammoInstantiated.default.destroy(_v);

            _ammoInstantiated.default.destroy(_v2);

            _ammoInstantiated.default.destroy(_v3);
          }
        } else if (primitiveMode == _index.GFXPrimitiveMode.TRIANGLE_FAN) {
          var _cnt2 = ib.length - 1;

          var _i4 = ib[0] * 3;

          var _v4 = new _ammoInstantiated.default.btVector3(vb[_i4], vb[_i4 + 1], vb[_i4 + 2]);

          for (var _j2 = 1; _j2 < _cnt2; _j2 += 1) {
            var _i5 = ib[_j2] * 3;

            var _i6 = ib[_j2 + 1] * 3;

            var _v5 = new _ammoInstantiated.default.btVector3(vb[_i5], vb[_i5 + 1], vb[_i5 + 2]);

            var _v6 = new _ammoInstantiated.default.btVector3(vb[_i6], vb[_i6 + 1], vb[_i6 + 2]);

            out.addTriangle(_v4, _v5, _v6);

            _ammoInstantiated.default.destroy(_v4);

            _ammoInstantiated.default.destroy(_v5);

            _ammoInstantiated.default.destroy(_v6);
          }
        }
      }
    }

    return out;
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL3BoeXNpY3MvYW1tby9hbW1vLXV0aWwudHMiXSwibmFtZXMiOlsiY29jb3MyQW1tb1ZlYzMiLCJvdXQiLCJ2Iiwic2V0VmFsdWUiLCJ4IiwieSIsInoiLCJhbW1vMkNvY29zVmVjMyIsImNvY29zMkFtbW9RdWF0IiwicSIsInciLCJhbW1vMkNvY29zUXVhdCIsImFtbW9EZWxldGVQdHIiLCJvYmoiLCJrbGFzcyIsIl9fY2FjaGVfXyIsInB0ciIsImNvY29zMkFtbW9UcmlNZXNoIiwibWVzaCIsImxlbiIsInJlbmRlcmluZ1N1Yk1lc2hlcyIsImxlbmd0aCIsImkiLCJzdWJNZXNoIiwiZ2VvSW5mbyIsImdlb21ldHJpY0luZm8iLCJwcmltaXRpdmVNb2RlIiwidmIiLCJwb3NpdGlvbnMiLCJpYiIsImluZGljZXMiLCJHRlhQcmltaXRpdmVNb2RlIiwiVFJJQU5HTEVfTElTVCIsImNudCIsImoiLCJpMCIsImkxIiwiaTIiLCJ2MCIsIkFtbW8iLCJidFZlY3RvcjMiLCJ2MSIsInYyIiwiYWRkVHJpYW5nbGUiLCJkZXN0cm95IiwiVFJJQU5HTEVfU1RSSVAiLCJyZXYiLCJUUklBTkdMRV9GQU4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJTyxXQUFTQSxjQUFULENBQXlCQyxHQUF6QixFQUE4Q0MsQ0FBOUMsRUFBNEU7QUFDL0VELElBQUFBLEdBQUcsQ0FBQ0UsUUFBSixDQUFhRCxDQUFDLENBQUNFLENBQWYsRUFBa0JGLENBQUMsQ0FBQ0csQ0FBcEIsRUFBdUJILENBQUMsQ0FBQ0ksQ0FBekI7QUFDQSxXQUFPTCxHQUFQO0FBQ0g7O0FBRU0sV0FBU00sY0FBVCxDQUE4Q04sR0FBOUMsRUFBc0RDLENBQXRELEVBQTRFO0FBQy9FRCxJQUFBQSxHQUFHLENBQUNHLENBQUosR0FBUUYsQ0FBQyxDQUFDRSxDQUFGLEVBQVI7QUFDQUgsSUFBQUEsR0FBRyxDQUFDSSxDQUFK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QUFRLENBQW5COztBQUNBLGdCQUFNRyxHQUFFLEdBQUdSLEVBQUUsQ0FBQ0ssR0FBQyxHQUFHLENBQUwsQ0FBRixHQUFZLENBQXZCOztBQUNBLGdCQUFNTyxHQUFFLEdBQUcsSUFBSUYsMEJBQUtDLFNBQVQsQ0FBbUJiLEVBQUUsQ0FBQ1MsR0FBRCxDQUFyQixFQUEyQlQsRUFBRSxDQUFDUyxHQUFFLEdBQUcsQ0FBTixDQUE3QixFQUF1Q1QsRUFBRSxDQUFDUyxHQUFFLEdBQUcsQ0FBTixDQUF6QyxDQUFYOztBQUNBLGdCQUFNTSxHQUFFLEdBQUcsSUFBSUgsMEJBQUtDLFNBQVQsQ0FBbUJiLEVBQUUsQ0FBQ1UsR0FBRCxDQUFyQixFQUEyQlYsRUFBRSxDQUFDVSxHQUFFLEdBQUcsQ0FBTixDQUE3QixFQUF1Q1YsRUFBRSxDQUFDVSxHQUFFLEdBQUcsQ0FBTixDQUF6QyxDQUFYOztBQUNBcEMsWUFBQUEsR0FBRyxDQUFDMEMsV0FBSixDQUFnQkwsR0FBaEIsRUFBb0JHLEdBQXBCLEVBQXdCQyxHQUF4Qjs7QUFDQUgsc0NBQUtLLE9BQUwsQ0FBYU4sR0FBYjs7QUFBa0JDLHNDQUFLSyxPQUFMLENBQWFILEdBQWI7O0FBQWtCRixzQ0FBS0ssT0FBTCxDQUFhRixHQUFiO0FBQ3ZDO0FBRUo7QUFDSjtBQUNKOztBQUNELFdBQU96QyxHQUFQO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQW1tbyBmcm9tICcuL2FtbW8taW5zdGFudGlhdGVkJztcclxuaW1wb3J0IHsgSVZlYzNMaWtlLCBJUXVhdExpa2UgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdHlwZS1kZWZpbmUnO1xyXG5pbXBvcnQgeyBNZXNoLCBHRlhQcmltaXRpdmVNb2RlIH0gZnJvbSAnLi4vLi4vY29yZSc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY29jb3MyQW1tb1ZlYzMgKG91dDogQW1tby5idFZlY3RvcjMsIHY6IElWZWMzTGlrZSk6IEFtbW8uYnRWZWN0b3IzIHtcclxuICAgIG91dC5zZXRWYWx1ZSh2LngsIHYueSwgdi56KTtcclxuICAgIHJldHVybiBvdXQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhbW1vMkNvY29zVmVjMzxUIGV4dGVuZHMgSVZlYzNMaWtlPiAob3V0OiBULCB2OiBBbW1vLmJ0VmVjdG9yMyk6IFQge1xyXG4gICAgb3V0LnggPSB2LngoKTtcclxuICAgIG91dC55ID0gdi55KCk7XHJcbiAgICBvdXQueiA9IHYueigpO1xyXG4gICAgcmV0dXJuIG91dDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvY29zMkFtbW9RdWF0IChvdXQ6IEFtbW8uYnRRdWF0ZXJuaW9uLCBxOiBJUXVhdExpa2UpOiBBbW1vLmJ0UXVhdGVybmlvbiB7XHJcbiAgICBvdXQuc2V0VmFsdWUocS54LCBxLnksIHEueiwgcS53KTtcclxuICAgIHJldHVybiBvdXQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhbW1vMkNvY29zUXVhdDxUIGV4dGVuZHMgSVF1YXRMaWtlPiAob3V0OiBULCBxOiBBbW1vLmJ0UXVhdGVybmlvbik6IFQge1xyXG4gICAgb3V0LnggPSBxLngoKTtcclxuICAgIG91dC55ID0gcS55KCk7XHJcbiAgICBvdXQueiA9IHEueigpO1xyXG4gICAgb3V0LncgPSBxLncoKTtcclxuICAgIHJldHVybiBvdXQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhbW1vRGVsZXRlUHRyIChvYmo6IEFtbW8uVHlwZSwga2xhc3M6IENvbnN0cnVjdG9yPEFtbW8uVHlwZT4pOiB2b2lkIHtcclxuICAgIGRlbGV0ZSAoa2xhc3MgYXMgYW55KS5fX2NhY2hlX19bKG9iaiBhcyBhbnkpLnB0cl07XHJcbn1cclxuLy8gVE9ETyA6IEFtbW9bJ2RlbGV0ZVB0ciddID0gZGVsZXRlUHRyO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvY29zMkFtbW9UcmlNZXNoIChvdXQ6IEFtbW8uYnRUcmlhbmdsZU1lc2gsIG1lc2g6IE1lc2gpOiBBbW1vLmJ0VHJpYW5nbGVNZXNoIHtcclxuICAgIGNvbnN0IGxlbiA9IG1lc2gucmVuZGVyaW5nU3ViTWVzaGVzLmxlbmd0aDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICBjb25zdCBzdWJNZXNoID0gbWVzaC5yZW5kZXJpbmdTdWJNZXNoZXNbaV07XHJcbiAgICAgICAgY29uc3QgZ2VvSW5mbyA9IHN1Yk1lc2guZ2VvbWV0cmljSW5mbztcclxuICAgICAgICBpZiAoZ2VvSW5mbykge1xyXG4gICAgICAgICAgICBjb25zdCBwcmltaXRpdmVNb2RlID0gc3ViTWVzaC5wcmltaXRpdmVNb2RlO1xyXG4gICAgICAgICAgICBjb25zdCB2YiA9IGdlb0luZm8ucG9zaXRpb25zO1xyXG4gICAgICAgICAgICBjb25zdCBpYiA9IGdlb0luZm8uaW5kaWNlcyBhcyBhbnk7XHJcbiAgICAgICAgICAgIGlmIChwcmltaXRpdmVNb2RlID09IEdGWFByaW1pdGl2ZU1vZGUuVFJJQU5HTEVfTElTVCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY250ID0gaWIubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjbnQ7IGogKz0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpMCA9IGliW2pdICogMztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaTEgPSBpYltqICsgMV0gKiAzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpMiA9IGliW2ogKyAyXSAqIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdjAgPSBuZXcgQW1tby5idFZlY3RvcjModmJbaTBdLCB2YltpMCArIDFdLCB2YltpMCArIDJdKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2MSA9IG5ldyBBbW1vLmJ0VmVjdG9yMyh2YltpMV0sIHZiW2kxICsgMV0sIHZiW2kxICsgMl0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHYyID0gbmV3IEFtbW8uYnRWZWN0b3IzKHZiW2kyXSwgdmJbaTIgKyAxXSwgdmJbaTIgKyAyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0LmFkZFRyaWFuZ2xlKHYwLCB2MSwgdjIpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFtbW8uZGVzdHJveSh2MCk7IEFtbW8uZGVzdHJveSh2MSk7IEFtbW8uZGVzdHJveSh2Mik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJpbWl0aXZlTW9kZSA9PSBHRlhQcmltaXRpdmVNb2RlLlRSSUFOR0xFX1NUUklQKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjbnQgPSBpYi5sZW5ndGggLSAyO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJldiA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNudDsgaiArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaTAgPSBpYltqIC0gcmV2XSAqIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaTEgPSBpYltqICsgcmV2ICsgMV0gKiAzO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGkyID0gaWJbaiArIDJdICogMztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2MCA9IG5ldyBBbW1vLmJ0VmVjdG9yMyh2YltpMF0sIHZiW2kwICsgMV0sIHZiW2kwICsgMl0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHYxID0gbmV3IEFtbW8uYnRWZWN0b3IzKHZiW2kxXSwgdmJbaTEgKyAxXSwgdmJbaTEgKyAyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdjIgPSBuZXcgQW1tby5idFZlY3RvcjModmJbaTJdLCB2YltpMiArIDFdLCB2YltpMiArIDJdKTtcclxuICAgICAgICAgICAgICAgICAgICBvdXQuYWRkVHJpYW5nbGUodjAsIHYxLCB2Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgQW1tby5kZXN0cm95KHYwKTsgQW1tby5kZXN0cm95KHYxKTsgQW1tby5kZXN0cm95KHYyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJpbWl0aXZlTW9kZSA9PSBHRlhQcmltaXRpdmVNb2RlLlRSSUFOR0xFX0ZBTikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY250ID0gaWIubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGkwID0gaWJbMF0gKiAzO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdjAgPSBuZXcgQW1tby5idFZlY3RvcjModmJbaTBdLCB2YltpMCArIDFdLCB2YltpMCArIDJdKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgY250OyBqICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpMSA9IGliW2pdICogMztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpMiA9IGliW2ogKyAxXSAqIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdjEgPSBuZXcgQW1tby5idFZlY3RvcjModmJbaTFdLCB2YltpMSArIDFdLCB2YltpMSArIDJdKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2MiA9IG5ldyBBbW1vLmJ0VmVjdG9yMyh2YltpMl0sIHZiW2kyICsgMV0sIHZiW2kyICsgMl0pO1xyXG4gICAgICAgICAgICAgICAgICAgIG91dC5hZGRUcmlhbmdsZSh2MCwgdjEsIHYyKTtcclxuICAgICAgICAgICAgICAgICAgICBBbW1vLmRlc3Ryb3kodjApOyBBbW1vLmRlc3Ryb3kodjEpOyBBbW1vLmRlc3Ryb3kodjIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBvdXQ7XHJcbn1cclxuIl19