(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(["exports", "../../../core/math/index.js"], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports, require("../../../core/math/index.js"));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, global.index);
    global.simple = mod.exports;
  }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (_exports, _index) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.simple = void 0;

  /*
   Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.
  
   https://www.cocos.com/
  
   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated engine source code (the "Software"), a limited,
   worldwide, royalty-free, non-assignable, revocable and non-exclusive license
   to use Cocos Creator solely to develop games on your target platforms. You shall
   not use Cocos Creator software for developing other software or tools that's
   used for developing games. You are not granted to publish, distribute,
   sublicense, and/or sell copies of Cocos Creator.
  
   The software or tools in this License Agreement are licensed, not sold.
   Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.
  
   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
  */

  /**
   * UI 组装器
   * @category ui-assembler
   */
  var vec3_temps = [];

  for (var i = 0; i < 4; i++) {
    vec3_temps.push(new _index.Vec3());
  }
  /**
   * simple 组装器
   * 可通过 `UI.simple` 获取该组装器。
   */


  var simple = {
    createData: function createData(sprite) {
      var renderData = sprite.requestRenderData();
      renderData.dataLength = 4;
      renderData.vertexCount = 4;
      renderData.indicesCount = 6;
      renderData.vData = new Float32Array(4 * 9);
      return renderData;
    },
    updateRenderData: function updateRenderData(sprite) {
      var frame = sprite.spriteFrame; // TODO: Material API design and export from editor could affect the material activation process
      // need to update the logic here
      // if (frame) {
      //     if (!frame._original && dynamicAtlasManager) {
      //         dynamicAtlasManager.insertSpriteFrame(frame);
      //     }
      //     if (sprite._material._texture !== frame._texture) {
      //         sprite._activateMaterial();
      //     }
      // }

      var renderData = sprite.renderData;

      if (renderData && frame) {
        if (renderData.vertDirty) {
          this.updateVertexData(sprite);
        }

        if (renderData.uvDirty) {
          this.updateUvs(sprite);
        }
      }
    },
    fillBuffers: function fillBuffers(sprite, renderer) {
      if (sprite === null) {
        return;
      } // const buffer: MeshBuffer = renderer.createBuffer(
      //     sprite.renderData!.vertexCount,
      //     sprite.renderData!.indicesCount,
      // );
      // const commitBuffer: IUIRenderData = renderer.createUIRenderData();


      var dataList = sprite.renderData.data;
      var node = sprite.node;
      var buffer = renderer.currBufferBatch;
      var vertexOffset = buffer.byteOffset >> 2;
      var indicesOffset = buffer.indicesOffset;
      var vertexId = buffer.vertexOffset;
      var isRecreate = buffer.request();

      if (!isRecreate) {
        buffer = renderer.currBufferBatch;
        vertexOffset = 0;
        indicesOffset = 0;
        vertexId = 0;
      } // buffer data may be reallocated, need get reference after request.


      var vBuf = buffer.vData;
      var iBuf = buffer.iData;
      var vData = sprite.renderData.vData;
      var data0 = dataList[0];
      var data3 = dataList[3];
      var matrix = node.worldMatrix;
      var a = matrix.m00;
      var b = matrix.m01;
      var c = matrix.m04;
      var d = matrix.m05;
      var tx = matrix.m12;
      var ty = matrix.m13;
      var vl = data0.x;
      var vr = data3.x;
      var vb = data0.y;
      var vt = data3.y;
      var al = a * vl;
      var ar = a * vr;
      var bl = b * vl;
      var br = b * vr;
      var cb = c * vb;
      var ct = c * vt;
      var db = d * vb;
      var dt = d * vt; // left bottom

      vData[0] = al + cb + tx;
      vData[1] = bl + db + ty; // right bottom

      vData[9] = ar + cb + tx;
      vData[10] = br + db + ty; // left top

      vData[18] = al + ct + tx;
      vData[19] = bl + dt + ty; // right top

      vData[27] = ar + ct + tx;
      vData[28] = br + dt + ty;
      vBuf.set(vData, vertexOffset); // fill index data

      iBuf[indicesOffset++] = vertexId;
      iBuf[indicesOffset++] = vertexId + 1;
      iBuf[indicesOffset++] = vertexId + 2;
      iBuf[indicesOffset++] = vertexId + 2;
      iBuf[indicesOffset++] = vertexId + 1;
      iBuf[indicesOffset++] = vertexId + 3;
    },
    updateVertexData: function updateVertexData(sprite) {
      var renderData = sprite.renderData;

      if (!renderData) {
        return;
      }

      var uiTrans = sprite.node._uiProps.uiTransformComp;
      var dataList = renderData.data;
      var cw = uiTrans.width;
      var ch = uiTrans.height;
      var appX = uiTrans.anchorX * cw;
      var appY = uiTrans.anchorY * ch;
      var l = 0;
      var b = 0;
      var r = 0;
      var t = 0;

      if (sprite.trim) {
        l = -appX;
        b = -appY;
        r = cw - appX;
        t = ch - appY;
      } else {
        var frame = sprite.spriteFrame;
        var originSize = frame.getOriginalSize();
        var rect = frame.getRect();
        var ow = originSize.width;
        var oh = originSize.height;
        var rw = rect.width;
        var rh = rect.height;
        var offset = frame.getOffset();
        var scaleX = cw / ow;
        var scaleY = ch / oh;
        var trimLeft = offset.x + (ow - rw) / 2;
        var trimRight = offset.x - (ow - rw) / 2;
        var trimBottom = offset.y + (oh - rh) / 2;
        var trimTop = offset.y - (oh - rh) / 2;
        l = trimLeft * scaleX - appX;
        b = trimBottom * scaleY - appY;
        r = cw + trimRight * scaleX - appX;
        t = ch + trimTop * scaleY - appY;
      }

      dataList[0].x = l;
      dataList[0].y = b;
      dataList[0].z = 0;
      dataList[3].x = r;
      dataList[3].y = t;
      dataList[3].z = 0;
      renderData.vertDirty = false;
    },
    updateUvs: function updateUvs(sprite) {
      var renderData = sprite.renderData;
      var vData = renderData.vData;
      var uv = sprite.spriteFrame.uv;
      vData[3] = uv[0];
      vData[4] = uv[1];
      vData[12] = uv[2];
      vData[13] = uv[3];
      vData[21] = uv[4];
      vData[22] = uv[5];
      vData[30] = uv[6];
      vData[31] = uv[7];
      renderData.uvDirty = false;
    },
    updateColor: function updateColor(sprite) {
      var vData = sprite.renderData.vData;
      var colorOffset = 5;
      var color = sprite.color;
      var colorR = color.r / 255;
      var colorG = color.g / 255;
      var colorB = color.b / 255;
      var colorA = color.a / 255;

      for (var _i = 0; _i < 4; _i++) {
        vData[colorOffset] = colorR;
        vData[colorOffset + 1] = colorG;
        vData[colorOffset + 2] = colorB;
        vData[colorOffset + 3] = colorA;
        colorOffset += 9;
      }
    }
  };
  _exports.simple = simple;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImU6L2QwMDQ1MjUyMC9HaXRodWIvZW5naW5lL2NvY29zL3VpL2Fzc2VtYmxlci9zcHJpdGUvc2ltcGxlLnRzIl0sIm5hbWVzIjpbInZlYzNfdGVtcHMiLCJpIiwicHVzaCIsIlZlYzMiLCJzaW1wbGUiLCJjcmVhdGVEYXRhIiwic3ByaXRlIiwicmVuZGVyRGF0YSIsInJlcXVlc3RSZW5kZXJEYXRhIiwiZGF0YUxlbmd0aCIsInZlcnRleENvdW50IiwiaW5kaWNlc0NvdW50IiwidkRhdGEiLCJGbG9hdDMyQXJyYXkiLCJ1cGRhdGVSZW5kZXJEYXRhIiwiZnJhbWUiLCJzcHJpdGVGcmFtZSIsInZlcnREaXJ0eSIsInVwZGF0ZVZlcnRleERhdGEiLCJ1dkRpcnR5IiwidXBkYXRlVXZzIiwiZmlsbEJ1ZmZlcnMiLCJyZW5kZXJlciIsImRhdGFMaXN0IiwiZGF0YSIsIm5vZGUiLCJidWZmZXIiLCJjdXJyQnVmZmVyQmF0Y2giLCJ2ZXJ0ZXhPZmZzZXQiLCJieXRlT2Zmc2V0IiwiaW5kaWNlc09mZnNldCIsInZlcnRleElkIiwiaXNSZWNyZWF0ZSIsInJlcXVlc3QiLCJ2QnVmIiwiaUJ1ZiIsImlEYXRhIiwiZGF0YTAiLCJkYXRhMyIsIm1hdHJpeCIsIndvcmxkTWF0cml4IiwiYSIsIm0wMCIsImIiLCJtMDEiLCJjIiwibTA0IiwiZCIsIm0wNSIsInR4IiwibTEyIiwidHkiLCJtMTMiLCJ2bCIsIngiLCJ2ciIsInZiIiwieSIsInZ0IiwiYWwiLCJhciIsImJsIiwiYnIiLCJjYiIsImN0IiwiZGIiLCJkdCIsInNldCIsInVpVHJhbnMiLCJfdWlQcm9wcyIsInVpVHJhbnNmb3JtQ29tcCIsImN3Iiwid2lkdGgiLCJjaCIsImhlaWdodCIsImFwcFgiLCJhbmNob3JYIiwiYXBwWSIsImFuY2hvclkiLCJsIiwiciIsInQiLCJ0cmltIiwib3JpZ2luU2l6ZSIsImdldE9yaWdpbmFsU2l6ZSIsInJlY3QiLCJnZXRSZWN0Iiwib3ciLCJvaCIsInJ3IiwicmgiLCJvZmZzZXQiLCJnZXRPZmZzZXQiLCJzY2FsZVgiLCJzY2FsZVkiLCJ0cmltTGVmdCIsInRyaW1SaWdodCIsInRyaW1Cb3R0b20iLCJ0cmltVG9wIiwieiIsInV2IiwidXBkYXRlQ29sb3IiLCJjb2xvck9mZnNldCIsImNvbG9yIiwiY29sb3JSIiwiY29sb3JHIiwiZyIsImNvbG9yQiIsImNvbG9yQSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTs7OztBQVdBLE1BQU1BLFVBQWtCLEdBQUcsRUFBM0I7O0FBQ0EsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLENBQXBCLEVBQXVCQSxDQUFDLEVBQXhCLEVBQTRCO0FBQ3hCRCxJQUFBQSxVQUFVLENBQUNFLElBQVgsQ0FBZ0IsSUFBSUMsV0FBSixFQUFoQjtBQUNIO0FBRUQ7Ozs7OztBQUlPLE1BQU1DLE1BQWtCLEdBQUc7QUFDOUJDLElBQUFBLFVBRDhCLHNCQUNsQkMsTUFEa0IsRUFDRjtBQUN4QixVQUFNQyxVQUFVLEdBQUdELE1BQU0sQ0FBQ0UsaUJBQVAsRUFBbkI7QUFDQUQsTUFBQUEsVUFBVSxDQUFFRSxVQUFaLEdBQXlCLENBQXpCO0FBQ0FGLE1BQUFBLFVBQVUsQ0FBRUcsV0FBWixHQUEwQixDQUExQjtBQUNBSCxNQUFBQSxVQUFVLENBQUVJLFlBQVosR0FBMkIsQ0FBM0I7QUFFQUosTUFBQUEsVUFBVSxDQUFDSyxLQUFYLEdBQW1CLElBQUlDLFlBQUosQ0FBaUIsSUFBSSxDQUFyQixDQUFuQjtBQUVBLGFBQU9OLFVBQVA7QUFDSCxLQVY2QjtBQVk5Qk8sSUFBQUEsZ0JBWjhCLDRCQVlaUixNQVpZLEVBWUk7QUFDOUIsVUFBTVMsS0FBSyxHQUFHVCxNQUFNLENBQUNVLFdBQXJCLENBRDhCLENBRzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU1ULFVBQVUsR0FBR0QsTUFBTSxDQUFDQyxVQUEx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TUFBMUI7QUFFQU4sUUFBQUEsV0FBVyxJQUFJLENBQWY7QUFDSDtBQUNKO0FBOUw2QixHQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiovXHJcblxyXG4vKipcclxuICogVUkg57uE6KOF5ZmoXHJcbiAqIEBjYXRlZ29yeSB1aS1hc3NlbWJsZXJcclxuICovXHJcblxyXG5pbXBvcnQgeyBWZWMzIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tYXRoJztcclxuaW1wb3J0IHsgSUFzc2VtYmxlciB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcmVuZGVyZXIvdWkvYmFzZSc7XHJcbmltcG9ydCB7IElSZW5kZXJEYXRhLCBSZW5kZXJEYXRhIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS9yZW5kZXItZGF0YSc7XHJcbmltcG9ydCB7IFVJIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9yZW5kZXJlci91aS91aSc7XHJcbmltcG9ydCB7IFNwcml0ZSB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMnO1xyXG5cclxuY29uc3QgdmVjM190ZW1wczogVmVjM1tdID0gW107XHJcbmZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7XHJcbiAgICB2ZWMzX3RlbXBzLnB1c2gobmV3IFZlYzMoKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBzaW1wbGUg57uE6KOF5ZmoXHJcbiAqIOWPr+mAmui/hyBgVUkuc2ltcGxlYCDojrflj5bor6Xnu4Too4XlmajjgIJcclxuICovXHJcbmV4cG9ydCBjb25zdCBzaW1wbGU6IElBc3NlbWJsZXIgPSB7XHJcbiAgICBjcmVhdGVEYXRhIChzcHJpdGU6IFNwcml0ZSkge1xyXG4gICAgICAgIGNvbnN0IHJlbmRlckRhdGEgPSBzcHJpdGUucmVxdWVzdFJlbmRlckRhdGEoKTtcclxuICAgICAgICByZW5kZXJEYXRhIS5kYXRhTGVuZ3RoID0gNDtcclxuICAgICAgICByZW5kZXJEYXRhIS52ZXJ0ZXhDb3VudCA9IDQ7XHJcbiAgICAgICAgcmVuZGVyRGF0YSEuaW5kaWNlc0NvdW50ID0gNjtcclxuXHJcbiAgICAgICAgcmVuZGVyRGF0YS52RGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoNCAqIDkpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVuZGVyRGF0YSBhcyBSZW5kZXJEYXRhO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVSZW5kZXJEYXRhIChzcHJpdGU6IFNwcml0ZSkge1xyXG4gICAgICAgIGNvbnN0IGZyYW1lID0gc3ByaXRlLnNwcml0ZUZyYW1lO1xyXG5cclxuICAgICAgICAvLyBUT0RPOiBNYXRlcmlhbCBBUEkgZGVzaWduIGFuZCBleHBvcnQgZnJvbSBlZGl0b3IgY291bGQgYWZmZWN0IHRoZSBtYXRlcmlhbCBhY3RpdmF0aW9uIHByb2Nlc3NcclxuICAgICAgICAvLyBuZWVkIHRvIHVwZGF0ZSB0aGUgbG9naWMgaGVyZVxyXG4gICAgICAgIC8vIGlmIChmcmFtZSkge1xyXG4gICAgICAgIC8vICAgICBpZiAoIWZyYW1lLl9vcmlnaW5hbCAmJiBkeW5hbWljQXRsYXNNYW5hZ2VyKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBkeW5hbWljQXRsYXNNYW5hZ2VyLmluc2VydFNwcml0ZUZyYW1lKGZyYW1lKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vICAgICBpZiAoc3ByaXRlLl9tYXRlcmlhbC5fdGV4dHVyZSAhPT0gZnJhbWUuX3RleHR1cmUpIHtcclxuICAgICAgICAvLyAgICAgICAgIHNwcml0ZS5fYWN0aXZhdGVNYXRlcmlhbCgpO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlbmRlckRhdGE7XHJcbiAgICAgICAgaWYgKHJlbmRlckRhdGEgJiYgZnJhbWUpIHtcclxuICAgICAgICAgICAgaWYgKHJlbmRlckRhdGEudmVydERpcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZlcnRleERhdGEoc3ByaXRlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVuZGVyRGF0YS51dkRpcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVV2cyhzcHJpdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBmaWxsQnVmZmVycyAoc3ByaXRlOiBTcHJpdGUsIHJlbmRlcmVyOiBVSSkge1xyXG4gICAgICAgIGlmIChzcHJpdGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gY29uc3QgYnVmZmVyOiBNZXNoQnVmZmVyID0gcmVuZGVyZXIuY3JlYXRlQnVmZmVyKFxyXG4gICAgICAgIC8vICAgICBzcHJpdGUucmVuZGVyRGF0YSEudmVydGV4Q291bnQsXHJcbiAgICAgICAgLy8gICAgIHNwcml0ZS5yZW5kZXJEYXRhIS5pbmRpY2VzQ291bnQsXHJcbiAgICAgICAgLy8gKTtcclxuICAgICAgICAvLyBjb25zdCBjb21taXRCdWZmZXI6IElVSVJlbmRlckRhdGEgPSByZW5kZXJlci5jcmVhdGVVSVJlbmRlckRhdGEoKTtcclxuICAgICAgICBjb25zdCBkYXRhTGlzdDogSVJlbmRlckRhdGFbXSA9IHNwcml0ZSEucmVuZGVyRGF0YSEuZGF0YTtcclxuICAgICAgICBjb25zdCBub2RlID0gc3ByaXRlLm5vZGU7XHJcblxyXG4gICAgICAgIGxldCBidWZmZXIgPSByZW5kZXJlci5jdXJyQnVmZmVyQmF0Y2ghO1xyXG4gICAgICAgIGxldCB2ZXJ0ZXhPZmZzZXQgPSBidWZmZXIuYnl0ZU9mZnNldCA+PiAyO1xyXG4gICAgICAgIGxldCBpbmRpY2VzT2Zmc2V0ID0gYnVmZmVyLmluZGljZXNPZmZzZXQ7XHJcbiAgICAgICAgbGV0IHZlcnRleElkID0gYnVmZmVyLnZlcnRleE9mZnNldDtcclxuXHJcbiAgICAgICAgY29uc3QgaXNSZWNyZWF0ZSA9IGJ1ZmZlci5yZXF1ZXN0KCk7XHJcbiAgICAgICAgaWYgKCFpc1JlY3JlYXRlKSB7XHJcbiAgICAgICAgICAgIGJ1ZmZlciA9IHJlbmRlcmVyLmN1cnJCdWZmZXJCYXRjaCE7XHJcbiAgICAgICAgICAgIHZlcnRleE9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgIGluZGljZXNPZmZzZXQgPSAwO1xyXG4gICAgICAgICAgICB2ZXJ0ZXhJZCA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBidWZmZXIgZGF0YSBtYXkgYmUgcmVhbGxvY2F0ZWQsIG5lZWQgZ2V0IHJlZmVyZW5jZSBhZnRlciByZXF1ZXN0LlxyXG4gICAgICAgIGNvbnN0IHZCdWYgPSBidWZmZXIudkRhdGEhO1xyXG4gICAgICAgIGNvbnN0IGlCdWYgPSBidWZmZXIuaURhdGEhO1xyXG4gICAgICAgIGNvbnN0IHZEYXRhID0gc3ByaXRlIS5yZW5kZXJEYXRhIS52RGF0YSE7XHJcbiAgICAgICAgY29uc3QgZGF0YTAgPSBkYXRhTGlzdFswXTtcclxuICAgICAgICBjb25zdCBkYXRhMyA9IGRhdGFMaXN0WzNdO1xyXG4gICAgICAgIGNvbnN0IG1hdHJpeCA9IG5vZGUud29ybGRNYXRyaXg7XHJcbiAgICAgICAgY29uc3QgYSA9IG1hdHJpeC5tMDA7IGNvbnN0IGIgPSBtYXRyaXgubTAxO1xyXG4gICAgICAgIGNvbnN0IGMgPSBtYXRyaXgubTA0OyBjb25zdCBkID0gbWF0cml4Lm0wNTtcclxuICAgICAgICBjb25zdCB0eCA9IG1hdHJpeC5tMTI7IGNvbnN0IHR5ID0gbWF0cml4Lm0xMztcclxuICAgICAgICBjb25zdCB2bCA9IGRhdGEwLng7IGNvbnN0IHZyID0gZGF0YTMueDtcclxuICAgICAgICBjb25zdCB2YiA9IGRhdGEwLnk7IGNvbnN0IHZ0ID0gZGF0YTMueTtcclxuICAgICAgICBjb25zdCBhbCA9IGEgKiB2bDsgY29uc3QgYXIgPSBhICogdnI7XHJcbiAgICAgICAgY29uc3QgYmwgPSBiICogdmw7IGNvbnN0IGJyID0gYiAqIHZyO1xyXG4gICAgICAgIGNvbnN0IGNiID0gYyAqIHZiOyBjb25zdCBjdCA9IGMgKiB2dDtcclxuICAgICAgICBjb25zdCBkYiA9IGQgKiB2YjsgY29uc3QgZHQgPSBkICogdnQ7XHJcbiAgICAgICAgLy8gbGVmdCBib3R0b21cclxuICAgICAgICB2RGF0YVswXSA9IGFsICsgY2IgKyB0eDtcclxuICAgICAgICB2RGF0YVsxXSA9IGJsICsgZGIgKyB0eTtcclxuICAgICAgICAvLyByaWdodCBib3R0b21cclxuICAgICAgICB2RGF0YVs5XSA9IGFyICsgY2IgKyB0eDtcclxuICAgICAgICB2RGF0YVsxMF0gPSBiciArIGRiICsgdHk7XHJcbiAgICAgICAgLy8gbGVmdCB0b3BcclxuICAgICAgICB2RGF0YVsxOF0gPSBhbCArIGN0ICsgdHg7XHJcbiAgICAgICAgdkRhdGFbMTldID0gYmwgKyBkdCArIHR5O1xyXG4gICAgICAgIC8vIHJpZ2h0IHRvcFxyXG4gICAgICAgIHZEYXRhWzI3XSA9IGFyICsgY3QgKyB0eDtcclxuICAgICAgICB2RGF0YVsyOF0gPSBiciArIGR0ICsgdHk7XHJcblxyXG4gICAgICAgIHZCdWYuc2V0KHZEYXRhLCB2ZXJ0ZXhPZmZzZXQpO1xyXG5cclxuICAgICAgICAvLyBmaWxsIGluZGV4IGRhdGFcclxuICAgICAgICBpQnVmW2luZGljZXNPZmZzZXQrK10gPSB2ZXJ0ZXhJZDtcclxuICAgICAgICBpQnVmW2luZGljZXNPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIDE7XHJcbiAgICAgICAgaUJ1ZltpbmRpY2VzT2Zmc2V0KytdID0gdmVydGV4SWQgKyAyO1xyXG4gICAgICAgIGlCdWZbaW5kaWNlc09mZnNldCsrXSA9IHZlcnRleElkICsgMjtcclxuICAgICAgICBpQnVmW2luZGljZXNPZmZzZXQrK10gPSB2ZXJ0ZXhJZCArIDE7XHJcbiAgICAgICAgaUJ1ZltpbmRpY2VzT2Zmc2V0KytdID0gdmVydGV4SWQgKyAzO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVWZXJ0ZXhEYXRhIChzcHJpdGU6IFNwcml0ZSkge1xyXG4gICAgICAgIGNvbnN0IHJlbmRlckRhdGE6IFJlbmRlckRhdGEgfCBudWxsID0gc3ByaXRlLnJlbmRlckRhdGE7XHJcbiAgICAgICAgaWYgKCFyZW5kZXJEYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHVpVHJhbnMgPSBzcHJpdGUubm9kZS5fdWlQcm9wcy51aVRyYW5zZm9ybUNvbXAhO1xyXG4gICAgICAgIGNvbnN0IGRhdGFMaXN0OiBJUmVuZGVyRGF0YVtdID0gcmVuZGVyRGF0YS5kYXRhO1xyXG4gICAgICAgIGNvbnN0IGN3ID0gdWlUcmFucy53aWR0aDtcclxuICAgICAgICBjb25zdCBjaCA9IHVpVHJhbnMuaGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IGFwcFggPSB1aVRyYW5zLmFuY2hvclggKiBjdztcclxuICAgICAgICBjb25zdCBhcHBZID0gdWlUcmFucy5hbmNob3JZICogY2g7XHJcbiAgICAgICAgbGV0IGwgPSAwO1xyXG4gICAgICAgIGxldCBiID0gMDtcclxuICAgICAgICBsZXQgciA9IDA7XHJcbiAgICAgICAgbGV0IHQgPSAwO1xyXG4gICAgICAgIGlmIChzcHJpdGUudHJpbSkge1xyXG4gICAgICAgICAgICBsID0gLWFwcFg7XHJcbiAgICAgICAgICAgIGIgPSAtYXBwWTtcclxuICAgICAgICAgICAgciA9IGN3IC0gYXBwWDtcclxuICAgICAgICAgICAgdCA9IGNoIC0gYXBwWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gc3ByaXRlLnNwcml0ZUZyYW1lITtcclxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luU2l6ZSA9IGZyYW1lLmdldE9yaWdpbmFsU2l6ZSgpO1xyXG4gICAgICAgICAgICBjb25zdCByZWN0ID0gZnJhbWUuZ2V0UmVjdCgpO1xyXG4gICAgICAgICAgICBjb25zdCBvdyA9IG9yaWdpblNpemUud2lkdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IG9oID0gb3JpZ2luU2l6ZS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ3ID0gcmVjdC53aWR0aDtcclxuICAgICAgICAgICAgY29uc3QgcmggPSByZWN0LmhlaWdodDtcclxuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZnJhbWUuZ2V0T2Zmc2V0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjYWxlWCA9IGN3IC8gb3c7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjYWxlWSA9IGNoIC8gb2g7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyaW1MZWZ0ID0gb2Zmc2V0LnggKyAob3cgLSBydykgLyAyO1xyXG4gICAgICAgICAgICBjb25zdCB0cmltUmlnaHQgPSBvZmZzZXQueCAtIChvdyAtIHJ3KSAvIDI7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyaW1Cb3R0b20gPSBvZmZzZXQueSArIChvaCAtIHJoKSAvIDI7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyaW1Ub3AgPSBvZmZzZXQueSAtIChvaCAtIHJoKSAvIDI7XHJcbiAgICAgICAgICAgIGwgPSB0cmltTGVmdCAqIHNjYWxlWCAtIGFwcFg7XHJcbiAgICAgICAgICAgIGIgPSB0cmltQm90dG9tICogc2NhbGVZIC0gYXBwWTtcclxuICAgICAgICAgICAgciA9IGN3ICsgdHJpbVJpZ2h0ICogc2NhbGVYIC0gYXBwWDtcclxuICAgICAgICAgICAgdCA9IGNoICsgdHJpbVRvcCAqIHNjYWxlWSAtIGFwcFk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkYXRhTGlzdFswXS54ID0gbDtcclxuICAgICAgICBkYXRhTGlzdFswXS55ID0gYjtcclxuICAgICAgICBkYXRhTGlzdFswXS56ID0gMDtcclxuXHJcbiAgICAgICAgZGF0YUxpc3RbM10ueCA9IHI7XHJcbiAgICAgICAgZGF0YUxpc3RbM10ueSA9IHQ7XHJcbiAgICAgICAgZGF0YUxpc3RbM10ueiA9IDA7XHJcblxyXG4gICAgICAgIHJlbmRlckRhdGEudmVydERpcnR5ID0gZmFsc2U7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZVV2cyAoc3ByaXRlOiBTcHJpdGUpIHtcclxuICAgICAgICBjb25zdCByZW5kZXJEYXRhID0gc3ByaXRlLnJlbmRlckRhdGEhO1xyXG4gICAgICAgIGNvbnN0IHZEYXRhID0gcmVuZGVyRGF0YS52RGF0YSE7XHJcbiAgICAgICAgY29uc3QgdXYgPSBzcHJpdGUhLnNwcml0ZUZyYW1lIS51djtcclxuICAgICAgICB2RGF0YVszXSA9IHV2WzBdO1xyXG4gICAgICAgIHZEYXRhWzRdID0gdXZbMV07XHJcbiAgICAgICAgdkRhdGFbMTJdID0gdXZbMl07XHJcbiAgICAgICAgdkRhdGFbMTNdID0gdXZbM107XHJcbiAgICAgICAgdkRhdGFbMjFdID0gdXZbNF07XHJcbiAgICAgICAgdkRhdGFbMjJdID0gdXZbNV07XHJcbiAgICAgICAgdkRhdGFbMzBdID0gdXZbNl07XHJcbiAgICAgICAgdkRhdGFbMzFdID0gdXZbN107XHJcblxyXG4gICAgICAgIHJlbmRlckRhdGEudXZEaXJ0eSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGVDb2xvciAoc3ByaXRlOiBTcHJpdGUpIHtcclxuICAgICAgICBjb25zdCB2RGF0YSA9IHNwcml0ZS5yZW5kZXJEYXRhIS52RGF0YTtcclxuXHJcbiAgICAgICAgbGV0IGNvbG9yT2Zmc2V0ID0gNTtcclxuICAgICAgICBjb25zdCBjb2xvciA9IHNwcml0ZS5jb2xvcjtcclxuICAgICAgICBjb25zdCBjb2xvclIgPSBjb2xvci5yIC8gMjU1O1xyXG4gICAgICAgIGNvbnN0IGNvbG9yRyA9IGNvbG9yLmcgLyAyNTU7XHJcbiAgICAgICAgY29uc3QgY29sb3JCID0gY29sb3IuYiAvIDI1NTtcclxuICAgICAgICBjb25zdCBjb2xvckEgPSBjb2xvci5hIC8gMjU1O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZEYXRhIVtjb2xvck9mZnNldF0gPSBjb2xvclI7XHJcbiAgICAgICAgICAgIHZEYXRhIVtjb2xvck9mZnNldCArIDFdID0gY29sb3JHO1xyXG4gICAgICAgICAgICB2RGF0YSFbY29sb3JPZmZzZXQgKyAyXSA9IGNvbG9yQjtcclxuICAgICAgICAgICAgdkRhdGEhW2NvbG9yT2Zmc2V0ICsgM10gPSBjb2xvckE7XHJcblxyXG4gICAgICAgICAgICBjb2xvck9mZnNldCArPSA5O1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcbiJdfQ==